{% extends 'layout.html' %}

{% block title %}ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: {{ vehicle.plate_number }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">
            <i class="fas fa-car ms-2"></i>
            ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: {{ vehicle.plate_number }}
        </h2>
        <div>
            <a href="{{ url_for('vehicles.edit', id=vehicle.id) }}" class="btn btn-warning">
                <i class="fas fa-edit ms-1"></i>
                ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
            </a>
            <a href="{{ url_for('vehicles.view_documents', id=vehicle.id) }}" class="btn btn-primary me-2">
                <i class="fas fa-id-card ms-1"></i>
                ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
            </a>
            <a href="{{ url_for('vehicles.confirm_delete', id=vehicle.id) }}" class="btn btn-danger me-2">
                <i class="fas fa-trash ms-1"></i>
                Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©
            </a>
            <a href="{{ url_for('vehicles.generate_vehicle_report', id=vehicle.id) }}" class="btn btn-info me-2"
                target="_blank">
                <i class="fas fa-file-excel ms-1"></i>
                Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ (Excel)
            </a>
            <a href="{{ url_for('vehicles.index') }}" class="btn btn-outline-secondary me-2">
                <i class="fas fa-arrow-right ms-1"></i>
                Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
            </a>
        </div>
    </div>

    {% if inspection_warnings %}
    <div class="alert alert-warning mb-4">
        <i class="fas fa-exclamation-triangle ms-2"></i>
        {% for warning in inspection_warnings %}
        <span>{{ warning }}</span>{% if not loop.last %} | {% endif %}
        {% endfor %}
    </div>
    {% endif %}

    <!-- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div class="row mb-4">
        <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header ">
                    <h5 class="mb-0">
                        <i class="fas fa-info-circle ms-2"></i>
                        Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©:</div>
                        <div class="col-sm-8">{{ vehicle.plate_number }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø§Ù„Ù†ÙˆØ¹:</div>
                        <div class="col-sm-8">{{ vehicle.make }} {{ vehicle.model }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹:</div>
                        <div class="col-sm-8">{{ vehicle.year }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø§Ù„Ù„ÙˆÙ†:</div>
                        <div class="col-sm-8">
                            <span class="badge rounded-pill"
                                style="background-color: {{ vehicle.color }}; color: {{ '#000' if vehicle.color in ['white', 'yellow', 'silver'] else '#fff' }};">
                                {{ vehicle.color }}
                            </span>
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø§Ù„Ø­Ø§Ù„Ø©:</div>
                        <div class="col-sm-8">
                            {% if vehicle.status == 'available' %}
                            <span class="badge bg-success">Ù…ØªØ§Ø­Ø©</span>
                            {% elif vehicle.status == 'rented' %}
                            <span class="badge bg-primary">Ù…Ø¤Ø¬Ø±Ø©</span>
                            {% elif vehicle.status == 'in_project' %}
                            <span class="badge bg-info">ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</span>
                            {% elif vehicle.status == 'in_workshop' %}
                            <span class="badge bg-warning text-dark">ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©</span>
                            {% elif vehicle.status == 'accident' %}
                            <span class="badge bg-danger">Ø­Ø§Ø¯Ø«</span>
                            {% else %}
                            <span class="badge bg-secondary">{{ vehicle.status }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</div>
                        <div class="col-sm-8">{{ vehicle.created_at.strftime('%Y-%m-%d') if vehicle.created_at else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</div>
                        <div class="col-sm-8">{{ vehicle.updated_at.strftime('%Y-%m-%d') if vehicle.updated_at else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
                        <div class="col-sm-8">
                            {% if current_driver %}
                            <span class="text-success fw-bold">{{ current_driver.name }}</span>
                            <small class="text-muted d-block">Ù…Ù†Ø° {{ current_driver.formatted_date }}</small>
                            <div class="mt-2">
                                <a href="{{ url_for('vehicles.view_handover', id=current_driver.handover_id) }}"
                                    class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-eye ms-1"></i>
                                    Ù…Ø´Ø§Ù‡Ø¯Ø© Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ…
                                </a>
                                {% if current_driver.mobile %}
                                <a href="https://wa.me/{{ current_driver.mobile.replace('+', '').replace(' ', '').replace('-', '') }}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ current_driver.name }}%0A%0AğŸš— Ø¨Ø®ØµÙˆØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø±Ù‚Ù…: {{ vehicle.plate_number }}%0AğŸ“… ØªØ§Ø±ÙŠØ® {{ current_driver.handover_type_ar }}: {{ current_driver.formatted_date }}%0A%0AğŸ“‹ Ù…Ù„Ù PDF Ù„Ù„ØªØ³Ù„ÙŠÙ…/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:%0A{{ url_for('vehicles.handover_pdf_public', id=current_driver.handover_id, _external=True) }}%0A%0AğŸ™ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚"
                                    class="btn btn-sm btn-success ms-1" target="_blank" title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                                    <i class="fab fa-whatsapp ms-1"></i>
                                    ÙˆØ§ØªØ³Ø§Ø¨
                                </a>
                                {% endif %}
                            </div>
                            {% else %}
                            <span class="text-muted">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                            {% endif %}
                        </div>
                    </div>
                    {% if vehicle.notes %}
                    <div class="row mb-2">
                        <div class="col-12 fw-bold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</div>
                        <div class="col-12 mt-2">
                            <div class="alert alert-secondary">{{ vehicle.notes }}</div>
                        </div>
                    </div>
                    {% endif %}

                    <!-- Ù…Ù„ÙØ§Øª Google Drive Ø¯Ø§Ø®Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                    <hr class="my-3">
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">
                            <i class="fab fa-google-drive text-info ms-1"></i>
                          Ù…Ù„ÙØ§Øª Google Drive:
                        </div>
                        <div class="col-sm-8">
                            {% if vehicle.drive_folder_link %}
                            <div class="d-flex align-items-center">
                                <span class="badge bg-success me-2">Ù…Ø±ØªØ¨Ø·</span>
                                <a href="{{ vehicle.drive_folder_link }}" target="_blank" class="btn btn-sm btn-success me-2">
                                    <i class="fab fa-google-drive me-1"></i>
                                    ÙØªØ­ Ø§Ù„Ù…Ø¬Ù„Ø¯
                                </a>
                                <a href="{{ url_for('vehicles.drive_management', vehicle_id=vehicle.id) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-cog me-1"></i>
                                    Ø¥Ø¯Ø§Ø±Ø©
                                </a>
                            </div>
                            <small class="text-muted d-block mt-1">ØªÙ… Ø±Ø¨Ø· Ù…Ø¬Ù„Ø¯ Ù„ØªÙ†Ø¸ÙŠÙ… Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</small>
                            {% else %}
                            <div class="d-flex align-items-center">
                                <span class="badge bg-warning text-dark me-2">ØºÙŠØ± Ù…Ø±ØªØ¨Ø·</span>
                                <a href="{{ url_for('vehicles.drive_management', vehicle_id=vehicle.id) }}" class="btn btn-sm btn-info">
                                    <i class="fas fa-link me-1"></i>
                                    Ø±Ø¨Ø· Ù…Ø¬Ù„Ø¯
                                </a>
                            </div>
                            <small class="text-muted d-block mt-1">Ù„Ù… ÙŠØªÙ… Ø±Ø¨Ø· Ù…Ø¬Ù„Ø¯ Google Drive Ø¨Ø¹Ø¯</small>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØµÙˆØ±Ø© Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-id-card ms-2"></i>
                        ØµÙˆØ±Ø© Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                    </h5>
                    <a href="{{ url_for('vehicles.vehicle_license_image', vehicle_id=vehicle.id) }}" class="btn btn-sm btn-primary">
                        {% if vehicle.license_image %}ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø©{% else %}Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©{% endif %}
                    </a>
                </div>
                <div class="card-body">
                    {% if vehicle.license_image %}
                    <div class="text-center">
                        <div class="license-image-container mb-3">
                            <img src="{{ url_for('static', filename='uploads/vehicles/' + vehicle.license_image) }}" 
                                 class="img-fluid rounded border" 
                                 style="max-height: 300px; max-width: 100%; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" 
                                 alt="ØµÙˆØ±Ø© Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©"
                                 onclick="showLicenseModal()">
                        </div>
                        <div class="license-actions d-flex gap-2 justify-content-center flex-wrap">
                            <button onclick="showLicenseModal()" class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-search-plus ms-1"></i>
                                Ø¹Ø±Ø¶ ÙƒØ¨ÙŠØ±
                            </button>
                            <a href="{{ url_for('static', filename='uploads/vehicles/' + vehicle.license_image) }}" 
                               target="_blank" class="btn btn-sm btn-outline-success">
                                <i class="fas fa-download ms-1"></i>
                                ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                            </a>
                            <a href="{{ url_for('vehicles.vehicle_license_image', vehicle_id=vehicle.id) }}" 
                               class="btn btn-sm btn-warning">
                                <i class="fas fa-edit ms-1"></i>
                                ØªØ­Ø¯ÙŠØ«
                            </a>
                        </div>
                        <div class="mt-2">
                            <small class="text-muted">
                                <i class="fas fa-info-circle ms-1"></i>
                                Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© Ù„Ù„Ø¹Ø±Ø¶ Ø¨Ø­Ø¬Ù… ÙƒØ§Ù…Ù„
                            </small>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <div class="mb-3">
                            <i class="fas fa-id-card fa-4x text-muted"></i>
                        </div>
                        <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ±Ø© Ø±Ø®ØµØ©</h5>
                        <p class="text-muted">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø±Ø®ØµØ© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø¨Ø¹Ø¯</p>
                        <a href="{{ url_for('vehicles.vehicle_license_image', vehicle_id=vehicle.id) }}" 
                           class="btn btn-primary mt-2">
                            <i class="fas fa-plus ms-1"></i>
                            Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø±Ø®ØµØ©
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± -->
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-money-bill-wave ms-2"></i>
                        Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±
                    </h5>
                    <a href="{{ url_for('vehicles.create_rental', id=vehicle.id) }}" class="btn btn-sm btn-primary">
                        {% if rental %}ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±{% else %}Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠØ¬Ø§Ø±{% endif %}
                    </a>
                </div>
                <div class="card-body">
                    {% if rental %}
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</div>
                        <div class="col-sm-8">{{ rental.formatted_start_date }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</div>
                        <div class="col-sm-8">
                            {% if rental.end_date %}
                            {{ rental.formatted_end_date }}
                            {% else %}
                            <span class="badge bg-info">Ù…Ø³ØªÙ…Ø±</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ:</div>
                        <div class="col-sm-8">{{ "{:,.2f}".format(rental.monthly_cost) }} Ø±ÙŠØ§Ù„</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±:</div>
                        <div class="col-sm-8">
                            {% if rental.is_active %}
                            <span class="badge bg-success">Ù†Ø´Ø·</span>
                            {% else %}
                            <span class="badge bg-danger">Ù…Ù†ØªÙ‡ÙŠ</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø§Ù„Ù…Ø¤Ø¬Ø±:</div>
                        <div class="col-sm-8">{{ rental.lessor_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„:</div>
                        <div class="col-sm-8">{{ rental.lessor_contact or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</div>
                    </div>
                    <div class="row mb-2">
                        <div class="col-sm-4 fw-bold">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯:</div>
                        <div class="col-sm-8">{{ rental.contract_number or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</div>
                    </div>
                    {% if rental.notes %}
                    <div class="row mb-2">
                        <div class="col-12 fw-bold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±:</div>
                        <div class="col-12 mt-2">
                            <div class="alert alert-secondary">{{ rental.notes }}</div>
                        </div>
                    </div>
                    {% endif %}
                    <div class="mt-3">
                        <a href="{{ url_for('vehicles.edit_rental', id=rental.id) }}" class="btn btn-sm btn-warning">
                            <i class="fas fa-edit ms-1"></i>
                            ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±
                        </a>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <div class="mb-3">
                            <i class="fas fa-file-contract fa-4x text-muted"></i>
                        </div>
                        <h5>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥ÙŠØ¬Ø§Ø± Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹</h5>
                        <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ù„Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠØ¬Ø§Ø±"</p>
                        <a href="{{ url_for('vehicles.create_rental', id=vehicle.id) }}" class="btn btn-primary mt-2">
                            <i class="fas fa-plus ms-1"></i>
                            Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠØ¬Ø§Ø±
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
    <div class="row mb-4">
        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-clipboard-check ms-2"></i>
                        Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ
                        {% if periodic_inspections %}
                        <span class="badge bg-secondary">{{ periodic_inspections|length }}</span>
                        {% endif %}
                    </h5>
                    <div>
                        <a href="{{ url_for('vehicles.vehicle_inspections', id=vehicle.id) }}"
                            class="btn btn-sm btn-primary">
                            <i class="fas fa-eye ms-1"></i>
                            Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                        </a>
                        <a href="{{ url_for('vehicles.create_inspection', id=vehicle.id) }}"
                            class="btn btn-sm btn-success me-1">
                            <i class="fas fa-plus ms-1"></i>
                            Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    {% if periodic_inspections %}
                    <div class="table-responsive">
                        <table class="table table-sm table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„ÙØ­Øµ</th>
                                    <th>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ­Øµ</th>
                                    <th>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for inspection in periodic_inspections[:3] %}
                                <tr
                                    class="{% if inspection.is_expired %}table-danger{% elif inspection.is_expiring_soon %}table-warning{% endif %}">
                                    <td>{{ inspection.inspection_number }}</td>
                                    <td>{{ inspection.formatted_inspection_date }}</td>
                                    <td>{{ inspection.formatted_expiry_date }}</td>
                                    <td>
                                        {% if inspection.inspection_type == 'technical' %}
                                        <span class="badge bg-info">ÙØ­Øµ ÙÙ†ÙŠ</span>
                                        {% elif inspection.inspection_type == 'periodic' %}
                                        <span class="badge bg-primary">ÙØ­Øµ Ø¯ÙˆØ±ÙŠ</span>
                                        {% elif inspection.inspection_type == 'safety' %}
                                        <span class="badge bg-warning text-dark">ÙØ­Øµ Ø£Ù…Ø§Ù†</span>
                                        {% else %}
                                        <span class="badge bg-secondary">{{ inspection.inspection_type }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if inspection.inspection_status == 'valid' %}
                                        <span class="badge bg-success">Ø³Ø§Ø±ÙŠ</span>
                                        {% elif inspection.inspection_status == 'expired' %}
                                        <span class="badge bg-danger">Ù…Ù†ØªÙ‡ÙŠ</span>
                                        {% elif inspection.inspection_status == 'expiring_soon' %}
                                        <span class="badge bg-warning text-dark">ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ù‹Ø§</span>
                                        {% else %}
                                        <span class="badge bg-secondary">{{ inspection.inspection_status }}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if periodic_inspections|length > 3 %}
                    <div class="text-center mt-2">
                        <a href="{{ url_for('vehicles.vehicle_inspections', id=vehicle.id) }}"
                            class="btn btn-sm btn-outline-primary">
                            Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ({{ periodic_inspections|length }})
                        </a>
                    </div>
                    {% endif %}
                    {% else %}
                    <div class="text-center py-4">
                        <div class="mb-3">
                            <i class="fas fa-clipboard fa-4x text-muted"></i>
                        </div>
                        <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙØ­Øµ Ø¯ÙˆØ±ÙŠ</h5>
                        <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ÙØ­Øµ Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ"</p>
                        <a href="{{ url_for('vehicles.create_inspection', id=vehicle.id) }}"
                            class="btn btn-success mt-2">
                            <i class="fas fa-plus ms-1"></i>
                            Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¯ÙˆØ±ÙŠ
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-6 mb-4">
            <div class="card shadow-sm h-100">
                <div class="card-header  d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-shield-alt ms-2"></i>
                        ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø©
                        {% if safety_checks %}
                        <span class="badge bg-secondary">{{ safety_checks|length }}</span>
                        {% endif %}
                    </h5>
                    <div>
                        <a href="{{ url_for('vehicles.vehicle_safety_checks', id=vehicle.id) }}"
                            class="btn btn-sm btn-primary">
                            <i class="fas fa-eye ms-1"></i>
                            Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                        </a>
                        <a href="{{ url_for('vehicles.create_safety_check', id=vehicle.id) }}"
                            class="btn btn-sm btn-success me-1">
                            <i class="fas fa-plus ms-1"></i>
                            Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    {% if safety_checks %}
                    <div class="table-responsive">
                        <table class="table table-sm table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                                    <th>Ø§Ù„Ù…Ø´Ø±Ù</th>
                                    <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                    <th>Ù…Ø´Ø§ÙƒÙ„</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for check in safety_checks[:3] %}
                                <tr>
                                    <td>{{ check.formatted_check_date }}</td>
                                    <td>
                                        {% if check.check_type == 'daily' %}
                                        <span class="badge bg-info">ÙŠÙˆÙ…ÙŠ</span>
                                        {% elif check.check_type == 'weekly' %}
                                        <span class="badge bg-warning text-dark">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span>
                                        {% elif check.check_type == 'monthly' %}
                                        <span class="badge bg-danger">Ø´Ù‡Ø±ÙŠ</span>
                                        {% else %}
                                        <span class="badge bg-secondary">{{ check.check_type }}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ check.driver_name }}</td>
                                    <td>{{ check.supervisor_name }}</td>
                                    <td>
                                        {% if check.status == 'completed' %}
                                        <span class="badge bg-success">Ù…ÙƒØªÙ…Ù„</span>
                                        {% elif check.status == 'in_progress' %}
                                        <span class="badge bg-warning text-dark">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                                        {% elif check.status == 'needs_review' %}
                                        <span class="badge bg-danger">Ø¨Ø­Ø§Ø¬Ø© Ù„Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                                        {% else %}
                                        <span class="badge bg-secondary">{{ check.status }}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if check.issues_found %}
                                        <span class="badge bg-danger">Ù†Ø¹Ù…</span>
                                        {% else %}
                                        <span class="badge bg-success">Ù„Ø§</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <a href="{{ url_for('vehicles.vehicle_safety_checks', id=vehicle.id) }}"
                                                class="btn btn-sm btn-outline-primary" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{{ url_for('vehicles.edit_safety_check', id=check.id) }}"
                                                class="btn btn-sm btn-outline-warning" title="ØªØ¹Ø¯ÙŠÙ„">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <form method="POST"
                                                action="{{ url_for('vehicles.delete_safety_check', id=check.id) }}"
                                                style="display: inline-block;"
                                                onsubmit="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')">
                                                <button type="submit" class="btn btn-sm btn-outline-danger" title="Ø­Ø°Ù">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% if safety_checks|length > 3 %}
                    <div class="text-center mt-2">
                        <a href="{{ url_for('vehicles.vehicle_safety_checks', id=vehicle.id) }}"
                            class="btn btn-sm btn-outline-primary">
                            Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ({{ safety_checks|length }})
                        </a>
                    </div>
                    {% endif %}
                    {% else %}
                    <div class="text-center py-4">
                        <div class="mb-3">
                            <i class="fas fa-shield-alt fa-4x text-muted"></i>
                        </div>
                        <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙØ­Øµ Ø³Ù„Ø§Ù…Ø©</h5>
                        <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ÙØ­Øµ Ø³Ù„Ø§Ù…Ø© Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ"</p>
                        <a href="{{ url_for('vehicles.create_safety_check', id=vehicle.id) }}"
                            class="btn btn-success mt-2">
                            <i class="fas fa-plus ms-1"></i>
                            Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø³Ù„Ø§Ù…Ø©
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>



    <!-- ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
    <div class="row mb-4">
        <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
        <div class="col-md-12 mb-4">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">
                        <i class="fas fa-id-card ms-2"></i>
                        ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                    </h5>
                    <a href="{{ url_for('vehicles.edit_documents', id=vehicle.id) }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-edit ms-1"></i>
                        ØªØ¹Ø¯ÙŠÙ„ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                    </a>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
                        <div class="col-md-4 mb-3">
                            <div class="card h-100 {% if vehicle.authorization_expiry_date %}
                                {% if (vehicle.authorization_expiry_date - today).days < 0 %}
                                    border-danger
                                {% elif (vehicle.authorization_expiry_date - today).days <= 30 %}
                                    border-warning
                                {% else %}
                                    border-success
                                {% endif %}
                            {% else %}
                                border-light
                            {% endif %}">
                                <div class="card-body text-center">
                                    <h5 class="card-title mb-3">
                                        <i class="fas fa-file-contract me-1"></i>
                                        ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                                    </h5>
                                    {% if vehicle.authorization_expiry_date %}
                                    <p class="mb-1">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</p>
                                    <h4 class="mb-2">{{ vehicle.authorization_expiry_date.strftime('%Y-%m-%d') }}</h4>

                                    {% set days_remaining = (vehicle.authorization_expiry_date - today).days %}

                                    {% if days_remaining < 0 %} <div class="badge bg-danger p-2 mb-2 w-100">Ù…Ù†ØªÙ‡ÙŠ Ù…Ù†Ø° {{
                                        days_remaining|abs }} ÙŠÙˆÙ…
                                </div>
                                {% elif days_remaining <= 30 %} <div class="badge bg-warning text-dark p-2 mb-2 w-100">
                                    ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…
                            </div>
                            {% else %}
                            <div class="badge bg-success p-2 mb-2 w-100">ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…</div>
                            {% endif %}

                            <a href="{{ url_for('vehicles.view_documents', id=vehicle.id) }}"
                                class="btn btn-sm btn-outline-primary w-100">
                                <i class="fas fa-eye ms-1"></i>
                                Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </a>
                            {% else %}
                            <div class="text-muted mb-3">
                                <i class="fas fa-exclamation-circle fa-2x"></i>
                                <p class="mt-2">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡</p>
                            </div>
                            <a href="{{ url_for('vehicles.edit_documents', id=vehicle.id) }}"
                                class="btn btn-sm btn-primary w-100">
                                <i class="fas fa-plus ms-1"></i>
                                Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®
                            </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                <div class="col-md-4 mb-3">
                    <div class="card h-100 {% if vehicle.registration_expiry_date %}
                                {% if (vehicle.registration_expiry_date - today).days < 0 %}
                                    border-danger
                                {% elif (vehicle.registration_expiry_date - today).days <= 30 %}
                                    border-warning
                                {% else %}
                                    border-success
                                {% endif %}
                            {% else %}
                                border-light
                            {% endif %}">
                        <div class="card-body text-center">
                            <h5 class="card-title mb-3">
                                <i class="fas fa-clipboard-list me-1"></i>
                                Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                            </h5>
                            {% if vehicle.registration_expiry_date %}
                            <p class="mb-1">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</p>
                            <h4 class="mb-2">{{ vehicle.registration_expiry_date.strftime('%Y-%m-%d') }}</h4>

                            {% set days_remaining = (vehicle.registration_expiry_date - today).days %}

                            {% if days_remaining < 0 %} <div class="badge bg-danger p-2 mb-2 w-100">Ù…Ù†ØªÙ‡ÙŠ Ù…Ù†Ø° {{
                                days_remaining|abs }} ÙŠÙˆÙ…
                        </div>
                        {% elif days_remaining <= 30 %} <div class="badge bg-warning text-dark p-2 mb-2 w-100">ÙŠØªØ¨Ù‚Ù‰ {{
                            days_remaining }} ÙŠÙˆÙ…
                    </div>
                    {% else %}
                    <div class="badge bg-success p-2 mb-2 w-100">ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…</div>
                    {% endif %}

                    <a href="{{ url_for('vehicles.view_documents', id=vehicle.id) }}"
                        class="btn btn-sm btn-outline-primary w-100">
                        <i class="fas fa-eye ms-1"></i>
                        Ø§Ù„ØªÙØ§ØµÙŠÙ„
                    </a>
                    {% else %}
                    <div class="text-muted mb-3">
                        <i class="fas fa-exclamation-circle fa-2x"></i>
                        <p class="mt-2">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡</p>
                    </div>
                    <a href="{{ url_for('vehicles.edit_documents', id=vehicle.id) }}"
                        class="btn btn-sm btn-primary w-100">
                        <i class="fas fa-plus ms-1"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ -->
        <div class="col-md-4 mb-3">
            <div class="card h-100 {% if vehicle.inspection_expiry_date %}
                                {% if (vehicle.inspection_expiry_date - today).days < 0 %}
                                    border-danger
                                {% elif (vehicle.inspection_expiry_date - today).days <= 30 %}
                                    border-warning
                                {% else %}
                                    border-success
                                {% endif %}
                            {% else %}
                                border-light
                            {% endif %}">
                <div class="card-body text-center">
                    <h5 class="card-title mb-3">
                        <i class="fas fa-clipboard-check me-1"></i>
                        Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ
                    </h5>
                    {% if vehicle.inspection_expiry_date %}
                    <p class="mb-1">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</p>
                    <h4 class="mb-2">{{ vehicle.inspection_expiry_date.strftime('%Y-%m-%d') }}</h4>

                    {% set days_remaining = (vehicle.inspection_expiry_date - today).days %}

                    {% if days_remaining < 0 %} <div class="badge bg-danger p-2 mb-2 w-100">Ù…Ù†ØªÙ‡ÙŠ Ù…Ù†Ø° {{
                        days_remaining|abs }} ÙŠÙˆÙ…
                </div>
                {% elif days_remaining <= 30 %} <div class="badge bg-warning text-dark p-2 mb-2 w-100">ÙŠØªØ¨Ù‚Ù‰ {{
                    days_remaining }} ÙŠÙˆÙ…
            </div>
            {% else %}
            <div class="badge bg-success p-2 mb-2 w-100">ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…</div>
            {% endif %}

            <a href="{{ url_for('vehicles.view_documents', id=vehicle.id) }}"
                class="btn btn-sm btn-outline-primary w-100">
                <i class="fas fa-eye ms-1"></i>
                Ø§Ù„ØªÙØ§ØµÙŠÙ„
            </a>
            {% else %}
            <div class="text-muted mb-3">
                <i class="fas fa-exclamation-circle fa-2x"></i>
                <p class="mt-2">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡</p>
            </div>
            <a href="{{ url_for('vehicles.edit_documents', id=vehicle.id) }}" class="btn btn-sm btn-primary w-100">
                <i class="fas fa-plus ms-1"></i>
                Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®
            </a>
            {% endif %}
        </div>
    </div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø© ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
<div class="row mb-4">
    <!-- Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø© -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-tools ms-2"></i>
                    Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©
                    <span class="badge bg-secondary">{{ workshop_records|length }}</span>
                </h5>
                <div>
                    <div class="dropdown d-inline-block me-2">
                        <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
                            id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-file-export ms-1"></i>
                            ØªØµØ¯ÙŠØ± / Ù…Ø´Ø§Ø±ÙƒØ©
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="exportDropdown">
                            <li><a class="dropdown-item fw-bold"
                                    href="{{ url_for('vehicles.export_workshop_to_pdf', id=vehicle.id) }}">
                                    <i class="fas fa-file-pdf text-success ms-1"></i>
                                    ØªØµØ¯ÙŠØ± PDF <span class="badge bg-success ms-1">Ù…Ø­Ø³Ù†</span>
                                </a></li>
                            <li><a class="dropdown-item"
                                    href="{{ url_for('vehicles.export_workshop_to_excel', id=vehicle.id) }}">
                                    <i class="fas fa-file-excel text-success ms-1"></i>
                                    ØªØµØ¯ÙŠØ± Excel
                                </a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item"
                                    href="{{ url_for('vehicles.print_workshop_records', id=vehicle.id) }}"
                                    target="_blank">
                                    <i class="fas fa-print text-primary ms-1"></i>
                                    Ø·Ø¨Ø§Ø¹Ø©
                                </a></li>
                            <li><a class="dropdown-item"
                                    href="{{ url_for('vehicles.share_workshop_options', id=vehicle.id) }}">
                                    <i class="fas fa-share-alt text-info ms-1"></i>
                                    Ù…Ø´Ø§Ø±ÙƒØ©
                                </a></li>
                        </ul>
                    </div>
                    <a href="{{ url_for('vehicles.create_workshop', id=vehicle.id) }}" class="btn btn-sm btn-primary">
                        <i class="fas fa-plus ms-1"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if workshop_records %}
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙˆØ±Ø´Ø© -->
                <div class="row mb-3">
                    <div class="col-4 text-center">
                        <div class="fw-bold text-primary h5">{{ workshop_records|selectattr('repair_status', 'equalto', 'in_progress')|list|length }}</div>
                        <small class="text-muted">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</small>
                    </div>
                    <div class="col-4 text-center">
                        <div class="fw-bold text-success h5">{{ workshop_records|selectattr('repair_status', 'equalto', 'completed')|list|length }}</div>
                        <small class="text-muted">Ù…ÙƒØªÙ…Ù„</small>
                    </div>
                    <div class="col-4 text-center">
                        <div class="fw-bold text-warning h5">{{ workshop_records|selectattr('repair_status', 'equalto', 'pending_approval')|list|length }}</div>
                        <small class="text-muted">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</small>
                    </div>
                </div>
                <hr>
                
                <!-- Ø¹Ø±Ø¶ Ø¢Ø®Ø± 4 Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªÙˆØ³Ø¹ -->
                <div class="list-group" style="max-height: 600px; overflow-y: auto;">
                    {% for record in workshop_records %}
                    <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center p-3 {% if loop.index > 4 %}d-none older-workshop-record{% endif %}">
                        <div class="w-75">
                            <div class="fw-bold d-flex align-items-center mb-1">
                                {% if record.reason == 'maintenance' %}
                                <span class="badge bg-info me-2">ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©</span>
                                {% elif record.reason == 'breakdown' %}
                                <span class="badge bg-warning text-dark me-2">Ø¹Ø·Ù„</span>
                                {% elif record.reason == 'accident' %}
                                <span class="badge bg-danger me-2">Ø­Ø§Ø¯Ø«</span>
                                {% else %}
                                <span class="badge bg-secondary me-2">{{ record.reason }}</span>
                                {% endif %}

                                <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ -->
                                {% if record.repair_status == 'in_progress' %}
                                <span class="badge rounded-pill bg-warning text-dark me-2">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                                {% elif record.repair_status == 'completed' %}
                                <span class="badge rounded-pill bg-success me-2">ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</span>
                                {% elif record.repair_status == 'pending_approval' %}
                                <span class="badge rounded-pill bg-info me-2">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                                {% endif %}

                                <!-- Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø© -->
                                {% if record.workshop_name %}
                                <span class="small ms-2">{{ record.workshop_name }}</span>
                                {% endif %}
                            </div>
                            <div class="small mb-1 d-flex align-items-center">
                                <i class="fas fa-calendar-alt text-muted me-1"></i>
                                <span class="text-muted me-1">Ø§Ù„Ø¯Ø®ÙˆÙ„:</span>
                                <span class="fw-bold me-3">{{ record.formatted_entry_date }}</span>

                                {% if record.exit_date %}
                                <i class="fas fa-calendar-check text-success me-1"></i>
                                <span class="text-muted me-1">Ø§Ù„Ø®Ø±ÙˆØ¬:</span>
                                <span class="fw-bold">{{ record.formatted_exit_date }}</span>
                                {% else %}
                                <i class="fas fa-tools text-warning me-1"></i>
                                <span class="text-warning fw-bold">Ù…Ø§ Ø²Ø§Ù„Øª ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©</span>
                                {% endif %}
                            </div>

                            <div class="small d-flex align-items-center">
                                <i class="fas fa-coins text-muted me-1"></i>
                                <span class="text-muted me-1">Ø§Ù„ØªÙƒÙ„ÙØ©:</span>
                                <span class="fw-bold">{{ "{:,.2f}".format(record.cost) }} Ø±ÙŠØ§Ù„</span>

                                {% if record.technician_name %}
                                <span class="mx-2">|</span>
                                <i class="fas fa-user-cog text-muted me-1"></i>
                                <span class="text-muted me-1">Ø§Ù„ÙÙ†ÙŠ:</span>
                                <span>{{ record.technician_name }}</span>
                                {% endif %}
                            </div>

                            <!-- Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¥Ù† ÙˆØ¬Ø¯Øª -->
                            {% if record.delivery_link or record.reception_link %}
                            <div class="mt-2">
                                {% if record.delivery_link %}
                                <a href="{{ record.delivery_link }}" target="_blank"
                                    class="btn btn-sm btn-outline-primary me-2">
                                    <i class="fas fa-file-export me-1"></i>
                                    Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ù„ÙŠÙ…
                                </a>
                                {% endif %}

                                {% if record.reception_link %}
                                <a href="{{ record.reception_link }}" target="_blank"
                                    class="btn btn-sm btn-outline-success">
                                    <i class="fas fa-file-import me-1"></i>
                                    Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
                                </a>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>

                        <div class="d-flex flex-column align-items-center">
                            <!-- Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
                            <a href="{{ url_for('vehicles.workshop_details', workshop_id=record.id) }}"
                                class="btn btn-sm btn-info mb-2 w-100" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                <i class="fas fa-eye ms-1"></i>
                                Ø¹Ø±Ø¶
                            </a>

                            <!-- Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
                            <a href="{{ url_for('vehicles.edit_workshop', id=record.id) }}"
                                class="btn btn-sm btn-warning w-100" title="ØªØ¹Ø¯ÙŠÙ„">
                                <i class="fas fa-edit ms-1"></i>
                                ØªØ¹Ø¯ÙŠÙ„
                            </a>
                        </div>

                        <!-- Ù†Ø§ÙØ°Ø© Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ - Ù†Ù…ÙˆØ°Ø¬ Ø¬Ø¯ÙŠØ¯ Ø¨ØªØµÙ…ÙŠÙ… Ø£Ø¨Ø³Ø· -->
                        <div class="modal fade" id="workshopDetails{{ record.id }}" tabindex="-1"
                            aria-labelledby="workshopDetailsLabel{{ record.id }}" aria-hidden="true">
                            <div class="modal-dialog modal-lg">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="workshopDetailsLabel{{ record.id }}">
                                            <i class="fas fa-tools ms-2"></i>
                                            ØªÙØ§ØµÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„ÙˆØ±Ø´Ø©
                                        </h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                            aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="table-responsive mb-4">
                                            <table class="table table-bordered table-striped">
                                                <tbody>
                                                    <tr>
                                                        <th scope="row" class="table-light" width="30%">Ø³Ø¨Ø¨ Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                                                        <td>
                                                            {% if record.reason == 'maintenance' %}
                                                            <span class="badge bg-info">ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©</span>
                                                            {% elif record.reason == 'breakdown' %}
                                                            <span class="badge bg-warning text-dark">Ø¹Ø·Ù„</span>
                                                            {% elif record.reason == 'accident' %}
                                                            <span class="badge bg-danger">Ø­Ø§Ø¯Ø«</span>
                                                            {% else %}
                                                            <span class="badge bg-secondary">{{ record.reason }}</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="table-light">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­</th>
                                                        <td>
                                                            {% if record.repair_status == 'in_progress' %}
                                                            <span class="badge bg-warning text-dark">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                                                            {% elif record.repair_status == 'completed' %}
                                                            <span class="badge bg-success">ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</span>
                                                            {% elif record.repair_status == 'pending_approval' %}
                                                            <span class="badge bg-info">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="table-light">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                                                        <td>{{ record.formatted_entry_date }}</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="table-light">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬</th>
                                                        <td>
                                                            {% if record.exit_date %}
                                                            {{ record.formatted_exit_date }}
                                                            {% else %}
                                                            <span class="text-warning">Ù…Ø§ Ø²Ø§Ù„Øª ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©</span>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="table-light">Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø©</th>
                                                        <td>{{ record.workshop_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="table-light">Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ</th>
                                                        <td>{{ record.technician_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                                    </tr>
                                                    <tr>
                                                        <th scope="row" class="table-light">Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                                                        <td>{{ "{:,.2f}".format(record.cost) }} Ø±ÙŠØ§Ù„</td>
                                                    </tr>
                                                    {% if record.delivery_link or record.reception_link %}
                                                    <tr>
                                                        <th scope="row" class="table-light">Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</th>
                                                        <td>
                                                            {% if record.delivery_link %}
                                                            <a href="{{ record.delivery_link }}" target="_blank"
                                                                class="btn btn-sm btn-outline-primary me-2 mb-2">
                                                                <i class="fas fa-external-link-alt ms-1"></i>
                                                                Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ù„ÙŠÙ…
                                                            </a>
                                                            {% endif %}

                                                            {% if record.reception_link %}
                                                            <a href="{{ record.reception_link }}" target="_blank"
                                                                class="btn btn-sm btn-outline-success mb-2">
                                                                <i class="fas fa-external-link-alt ms-1"></i>
                                                                Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
                                                            </a>
                                                            {% endif %}
                                                        </td>
                                                    </tr>
                                                    {% endif %}
                                                </tbody>
                                            </table>
                                        </div>

                                        <div class="mb-4">
                                            <h6 class="fw-bold mb-2">ÙˆØµÙ Ø§Ù„Ø¹Ø·Ù„ Ø£Ùˆ Ø§Ù„ØµÙŠØ§Ù†Ø©</h6>
                                            <div class="card">
                                                <div class="card-body bg-light">
                                                    {{ record.description|nl2br|safe or 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ' }}
                                                </div>
                                            </div>
                                        </div>

                                        {% if record.notes %}
                                        <div class="mb-4">
                                            <h6 class="fw-bold mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h6>
                                            <div class="card">
                                                <div class="card-body bg-light">
                                                    {{ record.notes|nl2br|safe }}
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}

                                        {% if record.images %}
                                        <div>
                                            <h6 class="fw-bold mb-2">Ø§Ù„ØµÙˆØ±</h6>
                                            <div class="row">
                                                {% for image in record.images %}
                                                {% if image.image_type == 'before' %}
                                                <div class="col-md-3 mb-3">
                                                    <div class="card">
                                                        <div class="card-header bg-warning text-dark py-1 small">Ù‚Ø¨Ù„
                                                            Ø§Ù„Ø¥ØµÙ„Ø§Ø­</div>
                                                        <img src="{{ url_for('static', filename=image.image_path) }}"
                                                            class="img-fluid" alt="ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­">
                                                    </div>
                                                </div>
                                                {% endif %}
                                                {% endfor %}

                                                {% for image in record.images %}
                                                {% if image.image_type == 'after' %}
                                                <div class="col-md-3 mb-3">
                                                    <div class="card">
                                                        <div class="card-header bg-success text-white py-1 small">Ø¨Ø¹Ø¯
                                                            Ø§Ù„Ø¥ØµÙ„Ø§Ø­</div>
                                                        <img src="{{ url_for('static', filename=image.image_path) }}"
                                                            class="img-fluid" alt="ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­">
                                                    </div>
                                                </div>
                                                {% endif %}
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <div class="modal-footer">
                                        <a href="{{ url_for('vehicles.edit_workshop', id=record.id) }}"
                                            class="btn btn-warning">
                                            <i class="fas fa-edit ms-1"></i>
                                            ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„
                                        </a>
                                        <button type="button" class="btn btn-secondary"
                                            data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    
                    <!-- Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ -->
                    {% if workshop_records|length > 4 %}
                    <div class="text-center py-3 border-top">
                        <button class="btn btn-outline-primary btn-sm" onclick="toggleOlderWorkshopRecords()">
                            <i class="fas fa-chevron-down ms-1" id="toggleWorkshopIcon"></i>
                            <span id="toggleWorkshopText">Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© ({{ workshop_records|length - 4 }})</span>
                        </button>
                    </div>
                    {% endif %}
                </div>
                <div class="d-flex justify-content-between mt-3">
                    <div>
                        <span class="fw-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØµÙŠØ§Ù†Ø©:</span>
                        <span class="badge bg-primary">{{ "{:,.2f}".format(total_maintenance_cost) }} Ø±ÙŠØ§Ù„</span>
                    </div>
                    <div>
                        <span class="fw-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©:</span>
                        <span class="badge bg-danger">{{ days_in_workshop }} ÙŠÙˆÙ…</span>
                    </div>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <div class="mb-3">
                        <i class="fas fa-wrench fa-4x text-muted"></i>
                    </div>
                    <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙˆØ±Ø´Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h5>
                    <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯"</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- ØªØ®ØµÙŠØµØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
    <div class="col-md-6 mb-4">
        <div class="card shadow-sm h-100">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-project-diagram ms-2"></i>
                    ØªØ®ØµÙŠØµØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
                    <span class="badge bg-secondary">{{ project_assignments|length }}</span>
                </h5>
                <a href="{{ url_for('vehicles.create_project', id=vehicle.id) }}" class="btn btn-sm btn-primary">
                    <i class="fas fa-plus ms-1"></i>
                    ØªØ®ØµÙŠØµ Ù„Ù…Ø´Ø±ÙˆØ¹
                </a>
            </div>
            <div class="card-body">
                {% if project_assignments %}
                <div class="list-group">
                    {% for assignment in project_assignments %}
                    <div
                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold">
                                {{ assignment.project_name }}
                                {% if assignment.is_active %}
                                <span class="badge bg-success">Ù†Ø´Ø·</span>
                                {% else %}
                                <span class="badge bg-danger">Ù…Ù†ØªÙ‡ÙŠ</span>
                                {% endif %}
                            </div>
                            <div class="small">
                                Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: {{ assignment.formatted_start_date }}
                                {% if assignment.end_date %}
                                | Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: {{ assignment.formatted_end_date }}
                                {% else %}
                                | <span class="text-success">Ù…Ø³ØªÙ…Ø±</span>
                                {% endif %}
                            </div>
                            <div class="small">
                                Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {{ assignment.manager_name }} |
                                Ø§Ù„Ù…ÙˆÙ‚Ø¹: {{ assignment.location }}
                            </div>
                        </div>
                        <a href="{{ url_for('vehicles.edit_project', id=assignment.id) }}"
                            class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-eye"></i>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4">
                    <div class="mb-3">
                        <i class="fas fa-building fa-4x text-muted"></i>
                    </div>
                    <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ®ØµÙŠØµØ§Øª Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h5>
                    <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ®ØµÙŠØµ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "ØªØ®ØµÙŠØµ Ù„Ù…Ø´Ø±ÙˆØ¹"</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ† -->
<div class="row mb-4">
    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header  d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-user-tie ms-2"></i>
                    Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
                </h5>
                <a href="{{ url_for('vehicles.create_handover', id=vehicle.id) }}?type=delivery"
                    class="btn btn-sm btn-success">
                    <i class="fas fa-exchange-alt ms-1"></i>
                    ØªØ³Ù„ÙŠÙ… Ù„Ø³Ø§Ø¦Ù‚ Ø¬Ø¯ÙŠØ¯
                </a>
            </div>
            <div class="card-body">
                {% if current_driver %}
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="h5 mb-1">{{ current_driver.name }}</div>
                        <div class="small text-muted">
                            Ù…Ù†Ø° {{ current_driver.formatted_date }}
                        </div>
                    </div>
                    <div>
                        <a href="{{ url_for('vehicles.view_handover', id=current_driver.handover_id) }}"
                            class="btn btn-sm btn-outline-primary ms-1" title="Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{{ url_for('vehicles.handover_pdf_public', id=current_driver.handover_id) }}"
                            class="btn btn-sm btn-outline-danger ms-1" target="_blank" title="ØªØ­Ù…ÙŠÙ„ PDF">
                            <i class="fas fa-file-pdf"></i>
                        </a>
                        {% if current_driver.mobile %}
                        <a href="https://wa.me/{{ current_driver.mobile.replace('+', '').replace(' ', '').replace('-', '') }}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ current_driver.name }}%0A%0AğŸš— Ø¨Ø®ØµÙˆØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø±Ù‚Ù…: {{ vehicle.plate_number }}%0AğŸ“… ØªØ§Ø±ÙŠØ® {{ current_driver.handover_type_ar }}: {{ current_driver.formatted_date }}%0A%0AğŸ“‹ Ù…Ù„Ù PDF Ù„Ù„ØªØ³Ù„ÙŠÙ…/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:%0A{{ url_for('vehicles.handover_pdf_public', id=current_driver.handover_id, _external=True) }}%0A%0AğŸ™ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚"
                            class="btn btn-sm btn-success ms-1" target="_blank" title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                            <i class="fab fa-whatsapp"></i>
                        </a>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="text-muted">
                    <i class="fas fa-info-circle ms-1"></i>
                    Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card shadow-sm h-100">
            <div class="card-header  d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-history ms-2"></i>
                    Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ†
                    <span class="badge bg-secondary">{{ previous_drivers|length }}</span>
                </h5>
                <a href="{{ url_for('vehicles.create_handover', id=vehicle.id) }}?type=receive"
                    class="btn btn-sm btn-info">
                    <i class="fas fa-exchange-alt ms-1"></i>
                    Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø³Ø§Ø¦Ù‚
                </a>
            </div>
            <div class="card-body">
                {% if previous_drivers %}
                <div class="list-group">
                    {% for driver in previous_drivers %}
                    <div
                        class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-bold">{{ driver.name }}</div>
                            <div class="small text-muted">{{ driver.formatted_date }}</div>
                        </div>
                        <div>
                            <a href="{{ url_for('vehicles.view_handover', id=driver.handover_id) }}"
                                class="btn btn-sm btn-outline-primary ms-1" title="Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="{{ url_for('vehicles.handover_pdf_public', id=driver.handover_id) }}"
                                class="btn btn-sm btn-outline-danger ms-1" target="_blank" title="ØªØ­Ù…ÙŠÙ„ PDF">
                                <i class="fas fa-file-pdf"></i>
                            </a>
                            {% if driver.mobile %}
                            <a href="https://wa.me/{{ driver.mobile.replace('+', '').replace(' ', '').replace('-', '') }}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ driver.name }}%0A%0AğŸš— Ø¨Ø®ØµÙˆØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø±Ù‚Ù…: {{ vehicle.plate_number }}%0AğŸ“… ØªØ§Ø±ÙŠØ® {{ driver.handover_type_ar }}: {{ driver.formatted_date }}%0A%0AğŸ“‹ Ù…Ù„Ù PDF Ù„Ù„ØªØ³Ù„ÙŠÙ…/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:%0A{{ url_for('vehicles.handover_pdf_public', id=driver.handover_id, _external=True) }}%0A%0AğŸ™ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚"
                                class="btn btn-sm btn-success ms-1" target="_blank" title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-muted">
                    <i class="fas fa-info-circle ms-1"></i>
                    Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø³Ø§Ø¨Ù‚ÙŠÙ†
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù… -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header  d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-exchange-alt ms-2"></i>
                    Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù…
                    <span class="badge bg-secondary">{{ handover_records|length }}</span>
                </h5>
                <a href="{{ url_for('vehicles.create_handover', id=vehicle.id) }}" class="btn btn-sm btn-primary">
                    <i class="fas fa-plus ms-1"></i>
                    Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªÙ„Ø§Ù…
                </a>
            </div>
            <div class="card-body">
                {% if handover_records %}
                <form action="{{ url_for('vehicles.confirm_delete_handovers', vehicle_id=vehicle.id) }}" method="post"
                    id="handover-delete-form">
                    <div class="mb-3 d-flex justify-content-end">
                        <button type="submit" class="btn btn-sm btn-danger" id="delete-selected-btn" disabled>
                            <i class="fas fa-trash-alt ms-1"></i>
                            Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th width="40">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="select-all">
                                        </div>
                                    </th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø§Ù„Ø´Ø®Øµ</th>
                                    <th>Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                                    <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for record in handover_records %}
                                <tr>
                                    <td>
                                        <div class="form-check">
                                            <input class="form-check-input handover-checkbox" type="checkbox"
                                                name="handover_ids[]" value="{{ record.id }}">
                                        </div>
                                    </td>
                                    <td>{{ record.formatted_handover_date }}</td>
                                    <td>
                                        {% if record.handover_type_ar == 'ØªØ³Ù„ÙŠÙ…' %}
                                        <span class="badge bg-success">ØªØ³Ù„ÙŠÙ…</span>
                                        {% else %}
                                        <span class="badge bg-info">Ø§Ø³ØªÙ„Ø§Ù…</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ record.person_name }}</td>
                                    <td>{{ record.mileage }} ÙƒÙ…</td>
                                    <td>{{ record.fuel_level }}</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="{{ url_for('vehicles.view_handover', id=record.id) }}"
                                                class="btn btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="{{ url_for('vehicles.edit_handover', id=record.id) }}"
                                                class="btn btn-outline-success">
                                                <i class="fas fa-edit"></i>
                                                ØªØ¹Ø¯ÙŠÙ„
                                            </a>
                                            {% if record.mobile %}
                                            <a href="https://wa.me/{{ record.mobile.replace('+', '').replace(' ', '').replace('-', '') }}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ record.person_name }}%0A%0AğŸš— Ø¨Ø®ØµÙˆØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø±Ù‚Ù…: {{ vehicle.plate_number }}%0AğŸ“… ØªØ§Ø±ÙŠØ® {{ record.handover_type_ar }}: {{ record.formatted_handover_date }}%0A%0AğŸ“‹ Ù…Ù„Ù PDF Ù„Ù„ØªØ³Ù„ÙŠÙ…/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:%0A{{ url_for('vehicles.handover_pdf_public', id=record.id, _external=True) }}%0A%0AğŸ™ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚"
                                                class="btn btn-outline-success" target="_blank"
                                                title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                                                <i class="fab fa-whatsapp"></i>
                                            </a>
                                            {% endif %}
                                            <a href="{{ url_for('vehicles.handover_pdf_public', id=record.id) }}"
                                                class="btn btn-outline-danger" target="_blank">
                                                <i class="fas fa-file-pdf"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </form>
                {% else %}
                <div class="text-center py-4">
                    <div class="mb-3">
                        <i class="fas fa-file-signature fa-4x text-muted"></i>
                    </div>
                    <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ØªØ³Ù„ÙŠÙ… ÙˆØ§Ø³ØªÙ„Ø§Ù…</h5>
                    <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ³Ù„ÙŠÙ… Ø£Ùˆ Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªÙ„Ø§Ù…"
                    </p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Ù‚Ø³Ù… Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ© -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-file-signature ms-2"></i>
                    Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
                    <span class="badge bg-secondary">{{ external_authorizations|length }}</span>
                </h5>
                <a href="{{ url_for('vehicles.create_external_authorization', vehicle_id=vehicle.id) }}" class="btn btn-sm btn-primary">
                    <i class="fas fa-plus ms-1"></i>
                    Ø¥Ø¶Ø§ÙØ© ØªÙÙˆÙŠØ¶ Ø¬Ø¯ÙŠØ¯
                </a>
            </div>
            <div class="card-body">
                {% if external_authorizations %}
                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª -->
                <div class="row mb-3">
                    <div class="col-4 text-center">
                        <div class="fw-bold text-warning h5">{{ external_authorizations|selectattr('status', 'equalto', 'pending')|list|length }}</div>
                        <small class="text-muted">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</small>
                    </div>
                    <div class="col-4 text-center">
                        <div class="fw-bold text-success h5">{{ external_authorizations|selectattr('status', 'equalto', 'approved')|list|length }}</div>
                        <small class="text-muted">Ù…ÙÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡</small>
                    </div>
                    <div class="col-4 text-center">
                        <div class="fw-bold text-danger h5">{{ external_authorizations|selectattr('status', 'equalto', 'rejected')|list|length }}</div>
                        <small class="text-muted">Ù…Ø±ÙÙˆØ¶</small>
                    </div>
                </div>
                <hr>
                
                <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª -->
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                                <th>Ù†ÙˆØ¹ Ø§Ù„ØªÙÙˆÙŠØ¶</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for auth in external_authorizations %}
                            <tr>
                                <td>{{ auth.employee.name }}</td>
                                <td>{{ auth.project_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                <td><span class="badge bg-info">{{ auth.authorization_type }}</span></td>
                                <td>
                                    {% if auth.status == 'pending' %}
                                        <span class="badge bg-warning">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                                    {% elif auth.status == 'approved' %}
                                        <span class="badge bg-success">Ù…ÙÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡</span>
                                    {% elif auth.status == 'rejected' %}
                                        <span class="badge bg-danger">Ù…Ø±ÙÙˆØ¶</span>
                                    {% endif %}
                                </td>
                                <td>{{ auth.created_at.strftime('%Y-%m-%d') if auth.created_at else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <a href="{{ url_for('vehicles.view_external_authorization', vehicle_id=vehicle.id, auth_id=auth.id) }}" 
                                           class="btn btn-outline-primary" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{{ url_for('vehicles.edit_external_authorization', vehicle_id=vehicle.id, auth_id=auth.id) }}" 
                                           class="btn btn-outline-warning" title="ØªØ¹Ø¯ÙŠÙ„">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        {% if auth.file_path %}
                                        <a href="{{ url_for('static', filename='uploads/authorizations/' + auth.file_path) }}" target="_blank" class="btn btn-outline-info" title="Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù">
                                            <i class="fas fa-file-alt"></i>
                                        </a>
                                        {% endif %}
                                        {% if auth.external_link %}
                                        <a href="{{ auth.external_link }}" target="_blank" class="btn btn-outline-success" title="ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·">
                                            <i class="fas fa-external-link-alt"></i>
                                        </a>
                                        {% endif %}
                                        {% if auth.status == 'pending' %}
                                        <a href="{{ url_for('vehicles.approve_external_authorization', vehicle_id=vehicle.id, auth_id=auth.id) }}" 
                                           class="btn btn-outline-success" 
                                           onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØªÙÙˆÙŠØ¶ØŸ')" title="Ù…ÙˆØ§ÙÙ‚Ø©">
                                            <i class="fas fa-check"></i>
                                        </a>
                                        <a href="{{ url_for('vehicles.reject_external_authorization', vehicle_id=vehicle.id, auth_id=auth.id) }}" 
                                           class="btn btn-outline-danger" 
                                           onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„ØªÙÙˆÙŠØ¶ØŸ')" title="Ø±ÙØ¶">
                                            <i class="fas fa-times"></i>
                                        </a>
                                        {% endif %}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <i class="fas fa-file-signature fa-3x text-muted mb-3"></i>
                    <h6>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙÙˆÙŠØ¶Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©</h6>
                    <p class="text-muted small">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØªÙÙˆÙŠØ¶ Ø®Ø§Ø±Ø¬ÙŠ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© ØªÙÙˆÙŠØ¶ Ø¬Ø¯ÙŠØ¯"</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Ù‚Ø³Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…Ø±ÙˆØ±ÙŠØ© -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header  d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-car-crash ms-2"></i>
                    Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…Ø±ÙˆØ±ÙŠØ©
                    {% if accidents %}
                    <span class="badge bg-secondary">{{ accidents|length }}</span>
                    {% endif %}
                </h5>
                <div>
                    <a href="{{ url_for('vehicles.create_accident', id=vehicle.id) }}" class="btn btn-sm btn-success">
                        <i class="fas fa-plus ms-1"></i>
                        Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ø¯Ø« Ø¬Ø¯ÙŠØ¯
                    </a>
                </div>
            </div>
            <div class="card-body">
                {% if accidents %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                            <tr>
                                <th>ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ø¯Ø«</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ø¯Ø«</th>
                                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                                <th>Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­Ù…Ù„</th>
                                <th>Ù…Ø¨Ù„Øº Ø§Ù„Ø®ØµÙ…</th>
                                <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø®ØµÙ…</th>
                                <th>Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for accident in accidents %}
                            <tr>
                                <td>{{ accident.accident_date|display_date }}</td>
                                <td>{{ accident.driver_name }}</td>
                                <td>
                                    {% if accident.accident_status == 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' %}
                                    <span class="badge bg-warning text-dark">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                                    {% elif accident.accident_status == 'Ù…ØºÙ„Ù‚' %}
                                    <span class="badge bg-success">Ù…ØºÙ„Ù‚</span>
                                    {% elif accident.accident_status == 'Ù…Ø¹Ù„Ù‚' %}
                                    <span class="badge bg-secondary">Ù…Ø¹Ù„Ù‚</span>
                                    {% elif accident.accident_status == 'ÙÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†' %}
                                    <span class="badge bg-info">ÙÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†</span>
                                    {% else %}
                                    <span class="badge bg-secondary">{{ accident.accident_status }}</span>
                                    {% endif %}
                                </td>
                                <td>{{ accident.vehicle_condition or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                <td>
                                    {% if accident.liability_percentage > 0 %}
                                    {% if accident.liability_percentage == 25 %}
                                    <span class="badge bg-info">ØªØ­Ù…Ù„ Ø¬Ø²Ø¦ÙŠ (25%)</span>
                                    {% elif accident.liability_percentage == 50 %}
                                    <span class="badge bg-warning text-dark">ØªØ­Ù…Ù„ Ù…ØªÙˆØ³Ø· (50%)</span>
                                    {% elif accident.liability_percentage == 75 %}
                                    <span class="badge bg-danger">ØªØ­Ù…Ù„ ÙƒØ¨ÙŠØ± (75%)</span>
                                    {% elif accident.liability_percentage == 100 %}
                                    <span class="badge bg-dark">ØªØ­Ù…Ù„ ÙƒØ§Ù…Ù„ (100%)</span>
                                    {% else %}
                                    <span class="badge bg-secondary">{{ accident.liability_percentage }}%</span>
                                    {% endif %}
                                    {% else %}
                                    <span class="badge bg-light text-dark">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ù…Ù„ (0%)</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if accident.deduction_amount > 0 %}
                                    {{ "{:,.2f}".format(accident.deduction_amount) }} Ø±ÙŠØ§Ù„
                                    {% else %}
                                    <span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if accident.deduction_amount > 0 %}
                                    {% if accident.deduction_status %}
                                    <span class="badge bg-success">ØªÙ… Ø§Ù„Ø®ØµÙ…</span>
                                    {% else %}
                                    <span class="badge bg-danger">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø®ØµÙ…</span>
                                    {% endif %}
                                    {% else %}
                                    <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if accident.accident_file_link %}
                                    <a href="{{ accident.accident_file_link }}" target="_blank"
                                        class="btn btn-sm btn-outline-primary">
                                        <i class="fas fa-file-alt"></i>
                                    </a>
                                    {% else %}
                                    <span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <a href="{{ url_for('vehicles.edit_accident', id=accident.id) }}"
                                            class="btn btn-sm btn-warning">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a href="{{ url_for('vehicles.confirm_delete_accident', id=accident.id) }}"
                                            class="btn btn-sm btn-danger">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-4">
                    <div class="mb-3">
                        <i class="fas fa-car-crash fa-4x text-muted"></i>
                    </div>
                    <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­ÙˆØ§Ø¯Ø« Ù…Ø³Ø¬Ù„Ø©</h5>
                    <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø­Ø§Ø¯Ø« Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ø¯Ø« Ø¬Ø¯ÙŠØ¯"</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>




<script>
// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶/Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
function toggleOlderWorkshopRecords() {
    const olderRecords = document.querySelectorAll('.older-workshop-record');
    const toggleIcon = document.getElementById('toggleWorkshopIcon');
    const toggleText = document.getElementById('toggleWorkshopText');
    
    if (olderRecords[0] && olderRecords[0].classList.contains('d-none')) {
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        olderRecords.forEach(record => {
            record.classList.remove('d-none');
        });
        toggleIcon.className = 'fas fa-chevron-up ms-1';
        toggleText.textContent = 'Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©';
    } else {
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        olderRecords.forEach(record => {
            record.classList.add('d-none');
        });
        toggleIcon.className = 'fas fa-chevron-down ms-1';
        toggleText.textContent = 'Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (' + olderRecords.length + ')';
    }
}

// Ø¯ÙˆØ§Ù„ Ù„Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
function viewAuthDetails(authId) {
    alert('Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙÙˆÙŠØ¶ Ø±Ù‚Ù…: ' + authId);
}

function editAuthDetails(authId) {
    alert('ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªÙÙˆÙŠØ¶ Ø±Ù‚Ù…: ' + authId);
}

function approveAuth(authId) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØªÙÙˆÙŠØ¶ØŸ')) {
        alert('ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªÙÙˆÙŠØ¶ Ø±Ù‚Ù…: ' + authId);
    }
}

function rejectAuth(authId) {
    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„ØªÙÙˆÙŠØ¶ØŸ')) {
        alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„ØªÙÙˆÙŠØ¶ Ø±Ù‚Ù…: ' + authId);
    }
}

// ÙÙ„ØªØ±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù… (Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…ÙˆØ¬ÙˆØ¯Ø©)
const departmentSelect = document.getElementById('department_id');
if (departmentSelect) {
    departmentSelect.addEventListener('change', function() {
        const departmentId = this.value;
        const employeeSelect = document.getElementById('employee_id');
        if (!employeeSelect) return;
        
        const options = employeeSelect.querySelectorAll('option');
        
        options.forEach(option => {
            if (option.value === '') {
                option.style.display = 'block';
                return;
            }
            
            const employeeDepartments = option.dataset.departments ? option.dataset.departments.split(',') : [];
            
            if (!departmentId || employeeDepartments.includes(departmentId)) {
                option.style.display = 'block';
            } else {
                option.style.display = 'none';
            }
        });
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø®ØªØ§Ø±
        employeeSelect.value = '';
    });
}

// Ø¯Ø§Ù„Ø© animateCounters Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©
function animateCounters() {
    // Ø¯Ø§Ù„Ø© ÙˆÙ‡Ù…ÙŠØ© Ù„Ø­Ù„ Ø§Ù„Ø®Ø·Ø£
    console.log('animateCounters called');
}

// Ø¥Ø¯Ø§Ø±Ø© Ø£Ø²Ø±Ø§Ø± Ø­Ø°Ù Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù…
document.addEventListener('DOMContentLoaded', function() {
    const selectAllCheckbox = document.getElementById('select-all');
    const handoverCheckboxes = document.querySelectorAll('.handover-checkbox');
    const deleteSelectedBtn = document.getElementById('delete-selected-btn');
    const handoverDeleteForm = document.getElementById('handover-delete-form');

    // ØªÙØ¹ÙŠÙ„/Ø¥Ù„ØºØ§Ø¡ ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
    function updateDeleteButtonState() {
        const checkedBoxes = document.querySelectorAll('.handover-checkbox:checked');
        if (deleteSelectedBtn) {
            deleteSelectedBtn.disabled = checkedBoxes.length === 0;
        }
    }

    // ÙˆØ¸ÙŠÙØ© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function() {
            handoverCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
            updateDeleteButtonState();
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ± ÙÙŠ Ø£ÙŠ checkbox
    handoverCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            updateDeleteButtonState();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© "ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„"
            if (selectAllCheckbox) {
                const checkedCount = document.querySelectorAll('.handover-checkbox:checked').length;
                selectAllCheckbox.checked = checkedCount === handoverCheckboxes.length;
                selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < handoverCheckboxes.length;
            }
        });
    });

    // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    if (handoverDeleteForm) {
        handoverDeleteForm.addEventListener('submit', function(e) {
            const checkedBoxes = document.querySelectorAll('.handover-checkbox:checked');
            if (checkedBoxes.length === 0) {
                e.preventDefault();
                alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡Ø§');
                return false;
            }
            
            const confirmMessage = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${checkedBoxes.length} Ø³Ø¬Ù„ Ù…Ù† Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù…ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`;
            if (!confirm(confirmMessage)) {
                e.preventDefault();
                return false;
            }
        });
    }

    // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    updateDeleteButtonState();
});

// Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„ØµÙˆØ±Ø© Ø§Ù„Ø±Ø®ØµØ©
function showLicenseModal() {
    const modal = `
        <div class="modal fade" id="licenseModal" tabindex="-1" aria-labelledby="licenseModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="licenseModalLabel">ØµÙˆØ±Ø© Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø© - {{ vehicle.plate_number }}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
                    </div>
                    <div class="modal-body text-center">
                        <img src="{{ url_for('static', filename='uploads/vehicles/' + vehicle.license_image) if vehicle.license_image else '' }}" 
                             class="img-fluid rounded" 
                             style="max-height: 70vh; width: auto;" 
                             alt="ØµÙˆØ±Ø© Ø±Ø®ØµØ© Ø§Ù„Ø³ÙŠØ§Ø±Ø©">
                    </div>
                    <div class="modal-footer">
                        <a href="{{ url_for('static', filename='uploads/vehicles/' + vehicle.license_image) if vehicle.license_image else '#' }}" 
                           target="_blank" class="btn btn-success">
                            <i class="fas fa-download ms-1"></i>
                            ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©
                        </a>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    const existingModal = document.getElementById('licenseModal');
    if (existingModal) {
        existingModal.remove();
    }
    
    // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„Ù„ØµÙØ­Ø©
    document.body.insertAdjacentHTML('beforeend', modal);
    
    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Ø§ÙØ°Ø©
    const bootstrapModal = new bootstrap.Modal(document.getElementById('licenseModal'));
    bootstrapModal.show();
}

// Ø¯Ø§Ù„Ø© Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø­Ø§ÙØ¸Ø©
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        // Ø¥Ø¸Ù‡Ø§Ø± ØªÙ†Ø¨ÙŠÙ‡ Ù†Ø¬Ø§Ø­
        const toast = document.createElement('div');
        toast.className = 'toast show position-fixed top-0 end-0 m-3';
        toast.innerHTML = `
            <div class="toast-header">
                <strong class="me-auto text-success">Ù†Ø¬Ø­ Ø§Ù„Ù†Ø³Ø®</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body">
                ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©
            </div>
        `;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }).catch(function() {
        alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·');
    });
}

// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø±Ø§Ø¨Ø· Google Drive
function validateDriveLink(url) {
    const drivePattern = /^https:\/\/(drive\.google\.com|docs\.google\.com)/;
    return drivePattern.test(url);
}

// Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¯Ø§Ø±Ø© Google Drive
document.addEventListener('DOMContentLoaded', function() {
    const driveForm = document.getElementById('driveForm');
    const driveLinkInput = document.getElementById('driveLink');
    const linkPreview = document.getElementById('linkPreview');
    const previewContainer = document.getElementById('previewContainer');
    
    if (driveLinkInput) {
        driveLinkInput.addEventListener('input', function() {
            const url = this.value.trim();
            if (url && validateDriveLink(url)) {
                linkPreview.textContent = url;
                previewContainer.style.display = 'block';
                previewContainer.className = 'alert alert-success';
                previewContainer.innerHTML = `
                    <i class="fas fa-check-circle me-2"></i>
                    <strong>Ø±Ø§Ø¨Ø· ØµØ­ÙŠØ­:</strong><br>
                    <small>${url}</small>
                `;
            } else if (url) {
                previewContainer.style.display = 'block';
                previewContainer.className = 'alert alert-warning';
                previewContainer.innerHTML = `
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Google Drive ØµØ­ÙŠØ­
                `;
            } else {
                previewContainer.style.display = 'none';
            }
        });
    }
    
    if (driveForm) {
        driveForm.addEventListener('submit', function(e) {
            const url = driveLinkInput.value.trim();
            if (url && !validateDriveLink(url)) {
                e.preventDefault();
                alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Google Drive ØµØ­ÙŠØ­');
                return false;
            }
        });
    }
});
</script>



{% endblock %}
