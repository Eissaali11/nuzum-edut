<!-- Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø© -->
<div class="col-md-6 mb-4">
    <div class="card shadow-sm h-100">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-tools ms-2"></i>
                Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©
                <span class="badge bg-secondary">{{ workshop_records|length }}</span>
            </h5>
            <div>
                <div class="dropdown d-inline-block me-2">
                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button"
                        id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-file-export ms-1"></i>
                        ØªØµØ¯ÙŠØ± / Ù…Ø´Ø§Ø±ÙƒØ©
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="exportDropdown">
                        <li><a class="dropdown-item fw-bold"
                                href="{{ url_for('vehicles.export_workshop_to_pdf', id=vehicle.id) }}">
                                <i class="fas fa-file-pdf text-success ms-1"></i>
                                ØªØµØ¯ÙŠØ± PDF <span class="badge bg-success ms-1">Ù…Ø­Ø³Ù†</span>
                            </a></li>
                        <li><a class="dropdown-item" href="{{ url_for('vehicles.export_workshop_to_excel', id=vehicle.id) }}">
                                <i class="fas fa-file-excel text-success ms-1"></i>
                                ØªØµØ¯ÙŠØ± Excel
                            </a></li>
                        <li>
                            <hr class="dropdown-divider">
                        </li>
                        <li><a class="dropdown-item" href="{{ url_for('vehicles.print_workshop_records', id=vehicle.id) }}" target="_blank">
                                <i class="fas fa-print text-primary ms-1"></i>
                                Ø·Ø¨Ø§Ø¹Ø©
                            </a></li>
                        <li><a class="dropdown-item" href="{{ url_for('vehicles.share_workshop_options', id=vehicle.id) }}">
                                <i class="fas fa-share-alt text-info ms-1"></i>
                                Ù…Ø´Ø§Ø±ÙƒØ©
                            </a></li>
                    </ul>
                </div>
                <a href="{{ url_for('vehicles.create_workshop', id=vehicle.id) }}" class="btn btn-sm btn-primary">
                    <i class="fas fa-plus ms-1"></i>
                    Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
                </a>
            </div>
        </div>
        <div class="card-body">
            {% if workshop_records %}
            <div class="list-group">
                {% for record in workshop_records %}
                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center p-3">
                    <div class="w-75">
                        <div class="fw-bold d-flex align-items-center mb-1">
                            {% if record.reason == 'maintenance' %}
                            <span class="badge bg-info me-2">ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©</span>
                            {% elif record.reason == 'breakdown' %}
                            <span class="badge bg-warning text-dark me-2">Ø¹Ø·Ù„</span>
                            {% elif record.reason == 'accident' %}
                            <span class="badge bg-danger me-2">Ø­Ø§Ø¯Ø«</span>
                            {% else %}
                            <span class="badge bg-secondary me-2">{{ record.reason }}</span>
                            {% endif %}

                            {% if record.repair_status == 'in_progress' %}
                            <span class="badge rounded-pill bg-warning text-dark me-2">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                            {% elif record.repair_status == 'completed' %}
                            <span class="badge rounded-pill bg-success me-2">ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</span>
                            {% elif record.repair_status == 'pending_approval' %}
                            <span class="badge rounded-pill bg-info me-2">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                            {% endif %}

                            {% if record.workshop_name %}
                            <span class="small ms-2">{{ record.workshop_name }}</span>
                            {% endif %}
                        </div>
                        <div class="small mb-1 d-flex align-items-center">
                            <i class="fas fa-calendar-alt text-muted me-1"></i>
                            <span class="text-muted me-1">Ø§Ù„Ø¯Ø®ÙˆÙ„:</span>
                            <span class="fw-bold me-3">{{ record.formatted_entry_date }}</span>

                            {% if record.exit_date %}
                            <i class="fas fa-calendar-check text-success me-1"></i>
                            <span class="text-muted me-1">Ø§Ù„Ø®Ø±ÙˆØ¬:</span>
                            <span class="fw-bold">{{ record.formatted_exit_date }}</span>
                            {% else %}
                            <i class="fas fa-tools text-warning me-1"></i>
                            <span class="text-warning fw-bold">Ù…Ø§ Ø²Ø§Ù„Øª ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©</span>
                            {% endif %}
                        </div>

                        <div class="small d-flex align-items-center">
                            <i class="fas fa-coins text-muted me-1"></i>
                            <span class="text-muted me-1">Ø§Ù„ØªÙƒÙ„ÙØ©:</span>
                            <span class="fw-bold">{{ "{:,.2f}".format(record.cost) }} Ø±ÙŠØ§Ù„</span>

                            {% if record.technician_name %}
                            <span class="mx-2">|</span>
                            <i class="fas fa-user-cog text-muted me-1"></i>
                            <span class="text-muted me-1">Ø§Ù„ÙÙ†ÙŠ:</span>
                            <span>{{ record.technician_name }}</span>
                            {% endif %}
                        </div>

                        {% if record.delivery_link or record.reception_link %}
                        <div class="mt-2">
                            {% if record.delivery_link %}
                            <a href="{{ record.delivery_link }}" target="_blank" class="btn btn-sm btn-outline-primary me-2">
                                <i class="fas fa-file-export me-1"></i>
                                Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ù„ÙŠÙ…
                            </a>
                            {% endif %}

                            {% if record.reception_link %}
                            <a href="{{ record.reception_link }}" target="_blank" class="btn btn-sm btn-outline-success">
                                <i class="fas fa-file-import me-1"></i>
                                Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
                            </a>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>

                    <div class="d-flex flex-column align-items-center">
                        <a href="{{ url_for('vehicles.workshop_details', workshop_id=record.id) }}" class="btn btn-sm btn-info mb-2 w-100" title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                            <i class="fas fa-eye ms-1"></i>
                            Ø¹Ø±Ø¶
                        </a>

                        <a href="{{ url_for('vehicles.edit_workshop', id=record.id) }}" class="btn btn-sm btn-warning w-100" title="ØªØ¹Ø¯ÙŠÙ„">
                            <i class="fas fa-edit ms-1"></i>
                            ØªØ¹Ø¯ÙŠÙ„
                        </a>
                    </div>

                    <div class="modal fade" id="workshopDetails{{ record.id }}" tabindex="-1" aria-labelledby="workshopDetailsLabel{{ record.id }}" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="workshopDetailsLabel{{ record.id }}">
                                        <i class="fas fa-tools ms-2"></i>
                                        ØªÙØ§ØµÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„ÙˆØ±Ø´Ø©
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Ø¥ØºÙ„Ø§Ù‚"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="table-responsive mb-4">
                                        <table class="table table-bordered table-striped">
                                            <tbody>
                                                <tr>
                                                    <th scope="row" class="table-light" width="30%">Ø³Ø¨Ø¨ Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                                                    <td>
                                                        {% if record.reason == 'maintenance' %}
                                                        <span class="badge bg-info">ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©</span>
                                                        {% elif record.reason == 'breakdown' %}
                                                        <span class="badge bg-warning text-dark">Ø¹Ø·Ù„</span>
                                                        {% elif record.reason == 'accident' %}
                                                        <span class="badge bg-danger">Ø­Ø§Ø¯Ø«</span>
                                                        {% else %}
                                                        <span class="badge bg-secondary">{{ record.reason }}</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" class="table-light">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­</th>
                                                    <td>
                                                        {% if record.repair_status == 'in_progress' %}
                                                        <span class="badge bg-warning text-dark">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                                                        {% elif record.repair_status == 'completed' %}
                                                        <span class="badge bg-success">ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</span>
                                                        {% elif record.repair_status == 'pending_approval' %}
                                                        <span class="badge bg-info">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" class="table-light">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                                                    <td>{{ record.formatted_entry_date }}</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" class="table-light">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬</th>
                                                    <td>
                                                        {% if record.exit_date %}
                                                        {{ record.formatted_exit_date }}
                                                        {% else %}
                                                        <span class="text-warning">Ù…Ø§ Ø²Ø§Ù„Øª ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" class="table-light">Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø©</th>
                                                    <td>{{ record.workshop_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" class="table-light">Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ</th>
                                                    <td>{{ record.technician_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                                </tr>
                                                <tr>
                                                    <th scope="row" class="table-light">Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                                                    <td>{{ "{:,.2f}".format(record.cost) }} Ø±ÙŠØ§Ù„</td>
                                                </tr>
                                                {% if record.delivery_link or record.reception_link %}
                                                <tr>
                                                    <th scope="row" class="table-light">Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</th>
                                                    <td>
                                                        {% if record.delivery_link %}
                                                        <a href="{{ record.delivery_link }}" target="_blank" class="btn btn-sm btn-outline-primary me-2 mb-2">
                                                            <i class="fas fa-external-link-alt ms-1"></i>
                                                            Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ù„ÙŠÙ…
                                                        </a>
                                                        {% endif %}

                                                        {% if record.reception_link %}
                                                        <a href="{{ record.reception_link }}" target="_blank" class="btn btn-sm btn-outline-success mb-2">
                                                            <i class="fas fa-external-link-alt ms-1"></i>
                                                            Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
                                                        </a>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                                {% endif %}
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="mb-4">
                                        <h6 class="fw-bold mb-2">ÙˆØµÙ Ø§Ù„Ø¹Ø·Ù„ Ø£Ùˆ Ø§Ù„ØµÙŠØ§Ù†Ø©</h6>
                                        <div class="card">
                                            <div class="card-body bg-light">
                                                {{ record.description|nl2br|safe or 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ' }}
                                            </div>
                                        </div>
                                    </div>

                                    {% if record.notes %}
                                    <div class="mb-4">
                                        <h6 class="fw-bold mb-2">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h6>
                                        <div class="card">
                                            <div class="card-body bg-light">
                                                {{ record.notes|nl2br|safe }}
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}

                                    {% if record.images %}
                                    <div>
                                        <h6 class="fw-bold mb-2">Ø§Ù„ØµÙˆØ±</h6>
                                        <div class="row">
                                            {% for image in record.images %}
                                            {% if image.image_type == 'before' %}
                                            <div class="col-md-3 mb-3">
                                                <div class="card">
                                                    <div class="card-header bg-warning text-dark py-1 small">Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­</div>
                                                    <img src="{{ url_for('static', filename=image.image_path) }}" class="img-fluid" alt="ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­">
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% endfor %}

                                            {% for image in record.images %}
                                            {% if image.image_type == 'after' %}
                                            <div class="col-md-3 mb-3">
                                                <div class="card">
                                                    <div class="card-header bg-success text-white py-1 small">Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­</div>
                                                    <img src="{{ url_for('static', filename=image.image_path) }}" class="img-fluid" alt="ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­">
                                                </div>
                                            </div>
                                            {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="modal-footer">
                                    <a href="{{ url_for('vehicles.edit_workshop', id=record.id) }}" class="btn btn-warning">
                                        <i class="fas fa-edit ms-1"></i>
                                        ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„
                                    </a>
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="d-flex justify-content-between mt-3">
                <div>
                    <span class="fw-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØµÙŠØ§Ù†Ø©:</span>
                    <span class="badge bg-primary">{{ "{:,.2f}".format(total_maintenance_cost) }} Ø±ÙŠØ§Ù„</span>
                </div>
                <div>
                    <span class="fw-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©:</span>
                    <span class="badge bg-danger">{{ days_in_workshop }} ÙŠÙˆÙ…</span>
                </div>
            </div>
            {% else %}
            <div class="text-center py-4">
                <div class="mb-3">
                    <i class="fas fa-wrench fa-4x text-muted"></i>
                </div>
                <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙˆØ±Ø´Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h5>
                <p class="text-muted">ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯"</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
