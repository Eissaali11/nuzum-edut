#!/usr/bin/env python3
import os
import sys

print("--- [ููุทุฉ ุงูุชูุชูุด 1] --- ุจุฏุงูุฉ ุชุดุบูู run_local.py")

PROJECT_ROOT = os.path.abspath(os.path.join(os.path.dirname(__file__), "..", ".."))
if PROJECT_ROOT not in sys.path:
    sys.path.insert(0, PROJECT_ROOT)

try:
    from dotenv import load_dotenv
    print("--- [ููุทุฉ ุงูุชูุชูุด 2] --- ุชู ุงุณุชูุฑุงุฏ dotenv ุจูุฌุงุญ")

    if os.path.exists('.env'):
        load_dotenv('.env')
        print("--- [ููุทุฉ ุงูุชูุชูุด 3] --- ุชู ุชุญููู ุงูุฅุนุฏุงุฏุงุช ูู .env")
    else:
        print("--- [ุชุญุฐูุฑ] --- ูู ูุชู ุงูุนุซูุฑ ุนูู ููู .envุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ.")

    # --- ูุฐุง ูู ุงูููุงู ุงูุฐู ุชู ุชุนุฏููู ---
    print("--- [ููุทุฉ ุงูุชูุชูุด 4] --- ุนูู ูุดู ุงุณุชูุฑุงุฏ ุงูุชุทุจูู (app, db)...")
    from src.app import app, db # <--- ุงูุชุนุฏูู ุงูุฃูู: ุงุณุชูุฑุงุฏ 'app' ูุจุงุดุฑุฉ
    print("--- [ููุทุฉ ุงูุชูุชูุด 5] --- ุชู ุงุณุชูุฑุงุฏ ุงูุชุทุจูู ุจูุฌุงุญ!")
    
    # ูุง ูุญุชุงุฌ ูุฅูุดุงุก ุงูุชุทุจููุ ููู ููุฌูุฏ ุจุงููุนู
    # app = create_app() # <--- ุงูุชุนุฏูู ุงูุซุงูู: ุชู ุญุฐู ูุฐุง ุงูุณุทุฑ
    print("--- [ููุทุฉ ุงูุชูุชูุด 6] --- ูุงุฆู ุงูุชุทุจูู (app object) ุฌุงูุฒ.")

    with app.app_context():
        print("--- [ููุทุฉ ุงูุชูุชูุด 7] --- ุงูุฏุฎูู ุฅูู ุณูุงู ุงูุชุทุจูู (app context).")
        # ุบุงูุจูุง ูุง ูุชู ุงุณุชุฏุนุงุก db.create_all() ุฏุงุฎู app.pyุ ููู ููุชุฑููุง ููุง ููุงุญุชูุงุท
        # db.create_all() 
        print("--- [ููุทุฉ ุงูุชูุชูุด 8] --- ุชู ูุญุต ุณูุงู ุงูุชุทุจูู.")

    print("\n======= ุจุฏุก ุชุดุบูู ุงูุฎุงุฏู ุงูุขู =======")

    # ุชุดุบูู ุงูุฎุงุฏู
    # ุงูุชุญูู ูู ุฃููุง ูู ุงูุจุฑูุงูุฌ ุงูุฑุฆูุณู ูุชุฌูุจ ุงูุชุดุบูู ุงููุฒุฏูุฌ ุจุณุจุจ reloader
    if __name__ == '__main__':
       app.run(
    host='127.0.0.1', # <--- ุงูุชุนุฏูู ุงูุฌููุฑู ููุง
    port=4032,       # ุฏุนูุง ูุนุฏ ุฅูู ุงููููุฐ ุงูุฃุตูู
    debug=True,
    use_reloader=True
)
except Exception as e:
    print("\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")
    print("!!!!!!!!!!   ุญุฏุซ ุฎุทุฃ ูุงุฏุญ   !!!!!!!!!!")
    print(f"!!!!!!!!!!   ุงูุฎุทุฃ: {e}   !!!!!!!!!!")
    print("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n")
    import traceback
    traceback.print_exc()
    sys.exit(1)






# #!/usr/bin/env python3
# import os
# import sys

# print("--- [ููุทุฉ ุงูุชูุชูุด 1] --- ุจุฏุงูุฉ ุชุดุบูู run_local.py")

# try:
#     from dotenv import load_dotenv
#     print("--- [ููุทุฉ ุงูุชูุชูุด 2] --- ุชู ุงุณุชูุฑุงุฏ dotenv ุจูุฌุงุญ")

#     if os.path.exists('.env'):
#         load_dotenv('.env')
#         print("--- [ููุทุฉ ุงูุชูุชูุด 3] --- ุชู ุชุญููู ุงูุฅุนุฏุงุฏุงุช ูู .env")
#     else:
#         print("--- [ุชุญุฐูุฑ] --- ูู ูุชู ุงูุนุซูุฑ ุนูู ููู .envุ ุณูุชู ุงุณุชุฎุฏุงู ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ.")

#     # --- ูุฐุง ูู ุงูููุงู ุงููุญุชูู ูููุดููุฉ ---
#     print("--- [ููุทุฉ ุงูุชูุชูุด 4] --- ุนูู ูุดู ุงุณุชูุฑุงุฏ ุงูุชุทุจูู (create_app, db)...")
#     from src.app import create_app, db
#     print("--- [ููุทุฉ ุงูุชูุชูุด 5] --- ุชู ุงุณุชูุฑุงุฏ ุงูุชุทุจูู ุจูุฌุงุญ!")
    
#     app = create_app()
#     print("--- [ููุทุฉ ุงูุชูุชูุด 6] --- ุชู ุฅูุดุงุก ูุงุฆู ุงูุชุทุจูู (app object).")

#     with app.app_context():
#         print("--- [ููุทุฉ ุงูุชูุชูุด 7] --- ุงูุฏุฎูู ุฅูู ุณูุงู ุงูุชุทุจูู (app context).")
#         db.create_all()
#         print("--- [ููุทุฉ ุงูุชูุชูุด 8] --- ุชู ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช.")

#     print("\n======= ุจุฏุก ุชุดุบูู ุงูุฎุงุฏู ุงูุขู =======")

#     # ุชุดุบูู ุงูุฎุงุฏู
#     app.run(
#         host='0.0.0.0',
#         port=5000,
#         debug=True,
#         use_reloader=True
#     )

# except Exception as e:
#     print("\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!")
#     print("!!!!!!!!!!   ุญุฏุซ ุฎุทุฃ ูุงุฏุญ   !!!!!!!!!!")
#     print(f"!!!!!!!!!!   ุงูุฎุทุฃ: {e}   !!!!!!!!!!")
#     print("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n")
#     # ูุฅุธูุงุฑ ุชูุงุตูู ุงูุฎุทุฃ ุงููุงููุฉ (Traceback)
#     import traceback
#     traceback.print_exc()
#     sys.exit(1)









# #!/usr/bin/env python3
# """
# ุชุดุบูู ูุธุงู ููุธู ูู ุงูุจูุฆุฉ ุงููุญููุฉ
# """
# import os
# import sys
# from dotenv import load_dotenv

# def main():
#     """
#     ุงูุฏุงูุฉ ุงูุฑุฆูุณูุฉ ูุฅุนุฏุงุฏ ูุชุดุบูู ุชุทุจูู Flask.
#     """
#     # ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ุฃููุงู
#     if os.path.exists('.env'):
#         load_dotenv('.env')
#         print("โ ุชู ุชุญููู ุงูุฅุนุฏุงุฏุงุช ูู .env")
#     elif os.path.exists('.env.local'):
#         load_dotenv('.env.local')
#         print("โ ุชู ุชุญููู ุงูุฅุนุฏุงุฏุงุช ูู .env.local")
#     else:
#         print("ุชุญุฐูุฑ: ูู ูุชู ุงูุนุซูุฑ ุนูู ููู .env")

#     # ุงุณุชูุฑุงุฏ ุงูุชุทุจูู ุจุนุฏ ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
#     try:
#         from src.app import create_app, db
#         app = create_app()
#     except ImportError as e:
#         print(f"ุฎุทุฃ ูู ุงุณุชูุฑุงุฏ ุงููุญุฏุงุช: {e}")
#         print("ุชุฃูุฏ ูู ุชูุนูู ุงูุจูุฆุฉ ุงูุงูุชุฑุงุถูุฉ ูุชุซุจูุช ุงูููุชุจุงุช: pip install -r local_requirements.txt")
#         sys.exit(1)

#     # ุฅูุดุงุก ุฌุฏุงูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุถูู ุณูุงู ุงูุชุทุจูู
#     with app.app_context():
#         try:
#             db.create_all()
#             print("โ ุชู ูุญุต ูุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูุฌุงุญ.")
#         except Exception as e:
#             print(f"ุฎุทุฃ ุฃุซูุงุก ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช: {e}")

#     print("\n" + "=" * 50)
#     print("๐ ุจุฏุก ุชุดุบูู ูุธุงู ููุธู (ูุถุน ุงูุชุทููุฑ)...")
#     print(f"๐ ุงูุฑุงุจุท: http://{app.config.get('SERVER_NAME') or '127.0.0.1:5000'}")
#     print("๐ ููุฅููุงู: ุงุถุบุท Ctrl+C")
#     print("=" * 50 + "\n")

#     # ุชุดุบูู ุงูุฎุงุฏู
#     app.run(
#         host='0.0.0.0',
#         port=5000,
#         debug=True,
#         use_reloader=True
#     )

# # --- ููุทุฉ ุจุฏุงูุฉ ุชุดุบูู ุงูุจุฑูุงูุฌ ---
# # ูุฐุง ูู ุงูุฌุฒุก ุงูุฐู ูุชู ุชูููุฐู ููุท ุนูุฏ ุชุดุบูู `python run_local.py`
# if __name__ == '__main__':
#     main()











# #!/usr/bin/env python3
# """
# ุชุดุบูู ูุธุงู ููุธู ูู ุงูุจูุฆุฉ ุงููุญููุฉ
# """

# import os
# import sys
# from dotenv import load_dotenv

# # ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ
# if os.path.exists('.env'):
#     load_dotenv('.env')
# elif os.path.exists('.env.local'):
#     load_dotenv('.env.local')
# else:
#     print("ุชุญุฐูุฑ: ูู ูุชู ุงูุนุซูุฑ ุนูู ููู .env")

# # ุชุนููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ููุชุทููุฑ ุงููุญูู
# os.environ.setdefault('FLASK_ENV', 'development')
# os.environ.setdefault('FLASK_DEBUG', 'True')
# os.environ.setdefault('DATABASE_URL', 'sqlite:///nuzum_local.db')

# # import weasyprint  # ุชุนุทูู ุงุณุชุฏุนุงุก WeasyPrint ูุคูุชูุงุ ูุงุณุชุฎุฏุงู ุญู ุจุฏูู (ูุซูุงูุ ุงุณุชุฎุฏุงู ููุชุจุฉ ุฃุฎุฑู ุฃู ุชุนุทูู ูุธุงุฆู PDF ูุคูุชูุง) ุจุฏูุงู ูู ุชุซุจูุช ุชุจุนูุงุช GTK+ ุนูู Windows.

# try:
#     from src.app import app, db
    
#     # ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
#     with app.app_context():
#         try:
#             db.create_all()
#             print("โ ุชู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช")
#         except Exception as e:
#             print(f"ุฎุทุฃ ูู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช: {e}")
    
#     print("๐ ุจุฏุก ุชุดุบูู ูุธุงู ููุธู...")
#     print("๐ ุงูุฑุงุจุท: http://localhost:5000")
#     print("๐ ููุฅููุงู: Ctrl+C")
#     print("-" * 50)
    
#     # ุชุดุบูู ุงูุฎุงุฏู
#     app.run(
#         host='0.0.0.0',
#         port=5000,
#         debug=True,
#         use_reloader=True
#     )
    
# except ImportError as e:
#     print(f"ุฎุทุฃ ูู ุงุณุชูุฑุงุฏ ุงููุญุฏุงุช: {e}")
#     print("ุชุฃูุฏ ูู ุชุซุจูุช ุงูููุชุจุงุช: pip install -r local_requirements.txt")
#     sys.exit(1)
# except Exception as e:
#     print(f"ุฎุทุฃ ูู ุชุดุบูู ุงูุชุทุจูู: {e}")
#     sys.exit(1)