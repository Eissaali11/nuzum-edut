{% extends 'layout.html' %}

{% block title %}واجهة برمجة التطبيقات الذكية - الذكاء الاصطناعي{% endblock %}

{% block extra_css %}
{% include 'ai_services/partials/api_interface/_extra_css.html' %}
{% endblock %}

{% block content %}
{% include 'ai_services/partials/api_interface/_content.html' %}
{% endblock %}

{% block extra_js %}
<script>
// نسخ النص للحافظة
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
        // إظهار رسالة نجاح
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 2000
        });
        Toast.fire({
            icon: 'success',
            title: 'تم نسخ الكود!'
        });
    });
}

// اختبار نقطة نهاية
function testEndpoint(endpoint, method) {
    const loadingHtml = '<i class="fas fa-spinner fa-spin me-2"></i>جاري الاختبار...';
    const button = event.target;
    const originalHtml = button.innerHTML;
    button.innerHTML = loadingHtml;
    button.disabled = true;

    fetch(endpoint, {
        method: method,
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        Swal.fire({
            title: 'نتيجة الاختبار',
            html: '<pre class="text-left">' + JSON.stringify(data, null, 2) + '</pre>',
            icon: 'success',
            confirmButtonText: 'إغلاق'
        });
    })
    .catch(error => {
        Swal.fire({
            title: 'خطأ في الاختبار',
            text: 'فشل في الاتصال بـ API',
            icon: 'error',
            confirmButtonText: 'إغلاق'
        });
    })
    .finally(() => {
        button.innerHTML = originalHtml;
        button.disabled = false;
    });
}

// تشغيل اختبار مباشر
function runLiveTest() {
    const endpoint = document.getElementById('endpoint-select').value;
    const resultDiv = document.getElementById('live-result');
    
    resultDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> جاري تشغيل الاختبار...';
    
    fetch(endpoint)
        .then(response => response.json())
        .then(data => {
            resultDiv.innerHTML = JSON.stringify(data, null, 2);
        })
        .catch(error => {
            resultDiv.innerHTML = 'خطأ: ' + error.message;
        });
}

// تحميل SDK
function downloadSDK() {
    Swal.fire({
        title: 'SDK غير متاح حالياً',
        text: 'سيتم إضافة SDK قريباً للغات البرمجة المختلفة',
        icon: 'info',
        confirmButtonText: 'حسناً'
    });
}

// تحديث الصفحة كل 30 ثانية لعرض أحدث المعلومات
setInterval(() => {
    const statusIndicator = document.querySelector('.status-indicator');
    if (statusIndicator) {
        // فحص حالة API
        fetch('/ai/api/dashboard-stats')
            .then(response => {
                if (response.ok) {
                    statusIndicator.className = 'status-indicator status-active';
                } else {
                    statusIndicator.className = 'status-indicator status-inactive';
                }
            })
            .catch(() => {
                statusIndicator.className = 'status-indicator status-inactive';
            });
    }
}, 30000);
</script>
{% endblock %}