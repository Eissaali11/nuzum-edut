{% extends 'layout.html' %}

{% block title %}الذكاء الاصطناعي - لوحة التحكم{% endblock %}

{% block extra_css %}
{% include 'ai_services/partials/dashboard/_extra_css.html' %}
{% endblock %}

{% block content %}
{% include 'ai_services/partials/dashboard/_content.html' %}
{% endblock %}

{% block extra_js %}
<script>
// دالة اختبار الذكاء الاصطناعي
async function testAI() {
    const modal = new bootstrap.Modal(document.getElementById('aiResultModal'));
    const content = document.getElementById('aiResultContent');
    
    content.innerHTML = `
        <div class="text-center">
            <div class="spinner-border text-info" role="status">
                <span class="visually-hidden">جاري التحليل...</span>
            </div>
            <p class="mt-3">جاري تحليل البيانات بالذكاء الاصطناعي...</p>
        </div>
    `;
    
    modal.show();
    
    try {
        const response = await fetch('/ai/api/analyze', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                type: 'general'
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            content.innerHTML = `
                <div class="ai-analysis-result">
                    <h6 class="text-info mb-3">
                        <i class="fas fa-chart-line me-2"></i>
                        نظرة عامة
                    </h6>
                    <p>${data.analysis.overview || 'تم تحليل البيانات بنجاح'}</p>
                    
                    <h6 class="text-success mb-3 mt-4">
                        <i class="fas fa-thumbs-up me-2"></i>
                        نقاط القوة
                    </h6>
                    <ul class="list-unstyled">
                        ${(data.analysis.strengths || []).map(strength => 
                            `<li><i class="fas fa-check text-success me-2"></i>${strength}</li>`
                        ).join('')}
                    </ul>
                    
                    <h6 class="text-warning mb-3 mt-4">
                        <i class="fas fa-lightbulb me-2"></i>
                        التوصيات
                    </h6>
                    <ul class="list-unstyled">
                        ${(data.analysis.recommendations || []).map(rec => 
                            `<li><i class="fas fa-arrow-right text-warning me-2"></i>${rec}</li>`
                        ).join('')}
                    </ul>
                    
                    <div class="mt-4 p-3 rounded" style="background: rgba(0, 212, 170, 0.1); border: 1px solid var(--ai-border);">
                        <small class="text-muted">
                            <i class="fas fa-clock me-1"></i>
                            تم التحليل في: ${new Date(data.timestamp).toLocaleString('ar-SA')}
                        </small>
                    </div>
                </div>
            `;
        } else {
            content.innerHTML = `
                <div class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    خطأ في التحليل: ${data.error}
                </div>
            `;
        }
    } catch (error) {
        content.innerHTML = `
            <div class="alert alert-danger">
                <i class="fas fa-wifi me-2"></i>
                خطأ في الاتصال. يرجى المحاولة مرة أخرى.
            </div>
        `;
    }
}

// تحديث الإحصائيات بشكل دوري
setInterval(function() {
    fetch('/ai/api/stats')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // تحديث الأرقام مع تأثير حركي
                document.querySelectorAll('.ai-stat-number').forEach(element => {
                    element.style.transform = 'scale(1.1)';
                    setTimeout(() => {
                        element.style.transform = 'scale(1)';
                    }, 200);
                });
            }
        })
        .catch(error => console.log('تحديث الإحصائيات:', error));
}, 30000); // كل 30 ثانية
</script>
{% endblock %}