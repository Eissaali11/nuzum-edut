{% extends 'layout.html' %}

{% block title %}Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯{% endblock %}

{% block styles %}
<style>
    /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
    .main-wrapper {
        min-height: 100vh;
        background: #1a2035;
        padding: 20px 0;
    }

    /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª */
    .card {
        border: none;
        border-radius: 15px;
        overflow: hidden;
        margin-bottom: 25px;
        background-color: #202940;
        box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }
    
    .card .card-header {
        border: none;
        padding: 20px;
        font-weight: bold;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .card .card-body {
        background-color: #202940;
        color: #e9ecef;
        padding: 25px;
    }
    
    /* Ø§Ù„ÙÙˆØ±Ù… */
    .form-control, .form-select {
        border-radius: 8px;
        padding: 12px 15px;
        background-color: #2a3654;
        border: 1px solid #3f4865;
        color: #e9ecef;
        margin-bottom: 15px;
        transition: all 0.3s;
    }
    
    .form-control:focus, .form-select:focus {
        background-color: #2e3d60;
        border-color: #4d5b84;
        box-shadow: 0 0 0 0.25rem rgba(114, 124, 245, 0.25);
        color: #ffffff;
    }
    
    .form-label {
        font-weight: 600;
        margin-bottom: 8px;
        color: #e9ecef;
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .btn {
        border-radius: 8px;
        padding: 10px 15px;
        font-weight: 600;
        transition: all 0.3s;
    }
    
    .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    
    .btn-primary {
        background-color: #727cf5;
        border-color: #727cf5;
    }
    
    .btn-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
    }
    
    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
    .page-navigator {
        background-color: #202940;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .page-navigator a {
        color: #727cf5;
        text-decoration: none;
        transition: color 0.3s;
    }
    
    .page-navigator a:hover {
        color: #949df5;
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
    .form-icon {
        color: #727cf5;
        margin-left: 8px;
    }
    
    /* Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ */
    .invalid-feedback {
        color: #ff6b6b;
        font-size: 0.9em;
        margin-top: 5px;
    }
    
    /* ØªÙ†Ø¨ÙŠÙ‡ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ */
    .payment-schedule-alert {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
        color: white;
        display: none;
    }
    
    .payment-schedule-alert.show {
        display: block;
        animation: slideDown 0.5s ease;
    }
    
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .payment-date-item {
        background-color: rgba(255, 255, 255, 0.15);
        border-radius: 8px;
        padding: 12px 15px;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .payment-date-item:hover {
        background-color: rgba(255, 255, 255, 0.25);
        transform: translateX(-5px);
        transition: all 0.3s;
    }
    
    .payment-number {
        background-color: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        width: 35px;
        height: 35px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
    }
    
    /* ØªØµÙ…ÙŠÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ± */
    .image-upload-area {
        border: 2px dashed #3f4865;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        background-color: #2a3654;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .image-upload-area:hover {
        border-color: #727cf5;
        background-color: #2e3d60;
    }
    
    .image-preview {
        max-width: 150px;
        max-height: 150px;
        margin: 10px;
        border-radius: 8px;
        object-fit: cover;
    }
</style>
{% endblock %}

{% block content %}
<div class="main-wrapper">
    <div class="container">
        <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ -->
        <div class="page-navigator">
            <a href="{{ url_for('properties.dashboard') }}">
                <i class="fas fa-building"></i> Ø§Ù„Ø¹Ù‚Ø§Ø±Ø§Øª
            </a>
            <span class="mx-2">/</span>
            <span>Ø¥Ø¶Ø§ÙØ© Ø¹Ù‚Ø§Ø± Ø¬Ø¯ÙŠØ¯</span>
        </div>

        <form method="POST" enctype="multipart/form-data">
            {{ form.hidden_tag() }}
            
            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-home form-icon"></i>
                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.name.label(class="form-label") }}
                            {{ form.name(class="form-control" + (" is-invalid" if form.name.errors else "")) }}
                            {% if form.name.errors %}
                                <div class="invalid-feedback">{{ form.name.errors[0] }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            {{ form.property_type.label(class="form-label") }}
                            {{ form.property_type(class="form-select" + (" is-invalid" if form.property_type.errors else "")) }}
                            {% if form.property_type.errors %}
                                <div class="invalid-feedback">{{ form.property_type.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            {{ form.address.label(class="form-label") }}
                            {{ form.address(class="form-control" + (" is-invalid" if form.address.errors else ""), rows="2") }}
                            {% if form.address.errors %}
                                <div class="invalid-feedback">{{ form.address.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.area.label(class="form-label") }}
                            {{ form.area(class="form-control" + (" is-invalid" if form.area.errors else ""), placeholder="Ù…Ø«Ø§Ù„: 150") }}
                            {% if form.area.errors %}
                                <div class="invalid-feedback">{{ form.area.errors[0] }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            {{ form.rooms.label(class="form-label") }}
                            {{ form.rooms(class="form-control" + (" is-invalid" if form.rooms.errors else ""), placeholder="Ù…Ø«Ø§Ù„: 3") }}
                            {% if form.rooms.errors %}
                                <div class="invalid-feedback">{{ form.rooms.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            {{ form.notes.label(class="form-label") }}
                            {{ form.notes(class="form-control" + (" is-invalid" if form.notes.errors else ""), rows="3") }}
                            {% if form.notes.errors %}
                                <div class="invalid-feedback">{{ form.notes.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù‚Ø¯ -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-file-contract form-icon"></i>
                    Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ù‚Ø¯
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.landlord_name.label(class="form-label") }}
                            {{ form.landlord_name(class="form-control" + (" is-invalid" if form.landlord_name.errors else "")) }}
                            {% if form.landlord_name.errors %}
                                <div class="invalid-feedback">{{ form.landlord_name.errors[0] }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            {{ form.landlord_phone.label(class="form-label") }}
                            {{ form.landlord_phone(class="form-control" + (" is-invalid" if form.landlord_phone.errors else ""), placeholder="05XXXXXXXX") }}
                            {% if form.landlord_phone.errors %}
                                <div class="invalid-feedback">{{ form.landlord_phone.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            {{ form.contract_number.label(class="form-label") }}
                            {{ form.contract_number(class="form-control" + (" is-invalid" if form.contract_number.errors else "")) }}
                            {% if form.contract_number.errors %}
                                <div class="invalid-feedback">{{ form.contract_number.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.contract_start_date.label(class="form-label") }}
                            {{ form.contract_start_date(class="form-control" + (" is-invalid" if form.contract_start_date.errors else "")) }}
                            {% if form.contract_start_date.errors %}
                                <div class="invalid-feedback">{{ form.contract_start_date.errors[0] }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            {{ form.contract_end_date.label(class="form-label") }}
                            {{ form.contract_end_date(class="form-control" + (" is-invalid" if form.contract_end_date.errors else "")) }}
                            {% if form.contract_end_date.errors %}
                                <div class="invalid-feedback">{{ form.contract_end_date.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            {{ form.contract_file.label(class="form-label") }}
                            {{ form.contract_file(class="form-control" + (" is-invalid" if form.contract_file.errors else "")) }}
                            {% if form.contract_file.errors %}
                                <div class="invalid-feedback">{{ form.contract_file.errors[0] }}</div>
                            {% endif %}
                            <small class="text-muted">PDF, JPG Ø£Ùˆ PNG - Ø­Ø¬Ù… Ø£Ù‚ØµÙ‰: 10 MB</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            {{ form.location_link.label(class="form-label") }}
                            {{ form.location_link(class="form-control" + (" is-invalid" if form.location_link.errors else ""), placeholder="https://maps.google.com/...") }}
                            {% if form.location_link.errors %}
                                <div class="invalid-feedback">{{ form.location_link.errors[0] }}</div>
                            {% endif %}
                            <small class="text-muted">Ø±Ø§Ø¨Ø· Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³ÙƒÙ† Ø¹Ù„Ù‰ Ø®Ø±Ø§Ø¦Ø· Ø¬ÙˆØ¬Ù„</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ© -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-dollar-sign form-icon"></i>
                    Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            {{ form.monthly_rent.label(class="form-label") }}
                            {{ form.monthly_rent(class="form-control" + (" is-invalid" if form.monthly_rent.errors else ""), placeholder="Ù…Ø«Ø§Ù„: 5000") }}
                            {% if form.monthly_rent.errors %}
                                <div class="invalid-feedback">{{ form.monthly_rent.errors[0] }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            {{ form.payment_method.label(class="form-label") }}
                            {{ form.payment_method(class="form-select" + (" is-invalid" if form.payment_method.errors else "")) }}
                            {% if form.payment_method.errors %}
                                <div class="invalid-feedback">{{ form.payment_method.errors[0] }}</div>
                            {% endif %}
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            {{ form.payment_day.label(class="form-label") }}
                            {{ form.payment_day(class="form-control" + (" is-invalid" if form.payment_day.errors else ""), placeholder="Ù…Ø«Ø§Ù„: 1") }}
                            {% if form.payment_day.errors %}
                                <div class="invalid-feedback">{{ form.payment_day.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12 mb-3">
                            {{ form.payment_notes.label(class="form-label") }}
                            {{ form.payment_notes(class="form-control" + (" is-invalid" if form.payment_notes.errors else ""), rows="2") }}
                            {% if form.payment_notes.errors %}
                                <div class="invalid-feedback">{{ form.payment_notes.errors[0] }}</div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- ØªÙ†Ø¨ÙŠÙ‡ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹ -->
                    <div id="payment-schedule-alert" class="payment-schedule-alert">
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-calendar-alt fa-2x me-3"></i>
                            <div>
                                <h5 class="mb-0">ğŸ“… Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹Ø§Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</h5>
                                <small id="payment-schedule-subtitle">Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</small>
                            </div>
                        </div>
                        <div id="payment-dates-list"></div>
                        <div class="mt-3 p-3 rounded" style="background-color: rgba(255,255,255,0.1);">
                            <small>
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ØªÙ‚Ø¯ÙŠØ±ÙŠØ© ÙˆÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„Ù‡Ø§ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ù…Ù† ØµÙØ­Ø© ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù‚Ø§Ø±
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø± -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-images form-icon"></i>
                    ØµÙˆØ± Ø§Ù„Ø¹Ù‚Ø§Ø±
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        {{ form.images.label(class="form-label") }}
                        <div class="image-upload-area" onclick="document.getElementById('images').click()">
                            <i class="fas fa-cloud-upload-alt fa-3x mb-2" style="color: #727cf5;"></i>
                            <p>Ø§Ø¶ØºØ· Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± (ÙŠØ¯Ø¹Ù… HEIC Ù…Ù† iPhone/iPad)</p>
                            <small>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙƒØ«Ø± Ù…Ù† ØµÙˆØ±Ø©</small>
                        </div>
                        {{ form.images(class="d-none", id="images") }}
                        <div id="preview-container" class="mt-3"></div>
                    </div>
                </div>
            </div>

            <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('properties.dashboard') }}" class="btn btn-secondary">
                            <i class="fas fa-times me-2"></i>Ø¥Ù„ØºØ§Ø¡
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Ø­ÙØ¸ Ø§Ù„Ø¹Ù‚Ø§Ø±
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
// Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±
document.getElementById('images').addEventListener('change', function(e) {
    const previewContainer = document.getElementById('preview-container');
    previewContainer.innerHTML = '';
    
    const files = e.target.files;
    for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const img = document.createElement('img');
            img.src = e.target.result;
            img.className = 'image-preview';
            previewContainer.appendChild(img);
        }
        
        reader.readAsDataURL(file);
    }
});

// Ø­Ø³Ø§Ø¨ ÙˆØ¹Ø±Ø¶ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹
function calculatePaymentDates() {
    const startDateInput = document.getElementById('contract_start_date');
    const endDateInput = document.getElementById('contract_end_date');
    const paymentMethodSelect = document.getElementById('payment_method');
    const paymentDayInput = document.getElementById('payment_day');
    
    const startDate = startDateInput ? startDateInput.value : '';
    const endDate = endDateInput ? endDateInput.value : '';
    const paymentMethod = paymentMethodSelect ? paymentMethodSelect.value : '';
    const paymentDay = paymentDayInput ? parseInt(paymentDayInput.value) || 1 : 1;
    
    const alert = document.getElementById('payment-schedule-alert');
    const datesList = document.getElementById('payment-dates-list');
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©
    if (!startDate || !endDate || !paymentMethod) {
        alert.classList.remove('show');
        return;
    }
    
    // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø´Ù‡Ø± Ø¨ÙŠÙ† Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
    const start = new Date(startDate);
    const end = new Date(endDate);
    
    if (start >= end) {
        alert.classList.remove('show');
        return;
    }
    
    // ØªØ­Ø¯ÙŠØ¯ ÙØªØ±Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø£Ø´Ù‡Ø±
    const periods = {
        'monthly': 1,
        'quarterly': 3,
        'semi_annually': 6,
        'annually': 12
    };
    
    const periodMonths = periods[paymentMethod] || 1;
    
    // Ø£Ø³Ù…Ø§Ø¡ Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
    const methodNames = {
        'monthly': 'Ø´Ù‡Ø±ÙŠ',
        'quarterly': 'Ø±Ø¨Ø¹ Ø³Ù†ÙˆÙŠ (ÙƒÙ„ 3 Ø£Ø´Ù‡Ø±)',
        'semi_annually': 'Ù†ØµÙ Ø³Ù†ÙˆÙŠ (ÙƒÙ„ 6 Ø£Ø´Ù‡Ø±)',
        'annually': 'Ø³Ù†ÙˆÙŠ (ÙƒÙ„ 12 Ø´Ù‡Ø±)'
    };
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙØ±Ø¹ÙŠ
    document.getElementById('payment-schedule-subtitle').textContent = 
        `Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${methodNames[paymentMethod]} | ÙŠÙˆÙ… Ø§Ù„Ø¯ÙØ¹: ${paymentDay} Ù…Ù† ÙƒÙ„ ÙØªØ±Ø©`;
    
    // Ø­Ø³Ø§Ø¨ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹
    const paymentDates = [];
    let currentDate = new Date(start);
    currentDate.setDate(paymentDay);
    
    // Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠÙˆÙ… Ø§Ù„Ø¯ÙØ¹ Ù‚Ø¨Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©ØŒ Ø§Ø¨Ø¯Ø£ Ù…Ù† Ø§Ù„Ø´Ù‡Ø± Ø§Ù„ØªØ§Ù„ÙŠ
    if (currentDate < start) {
        currentDate.setMonth(currentDate.getMonth() + 1);
    }
    
    let paymentNumber = 1;
    while (currentDate <= end && paymentNumber <= 50) { // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 50 Ø¯ÙØ¹Ø©
        paymentDates.push({
            number: paymentNumber,
            date: new Date(currentDate)
        });
        
        currentDate.setMonth(currentDate.getMonth() + periodMonths);
        paymentNumber++;
    }
    
    // Ø¹Ø±Ø¶ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¯ÙØ¹
    datesList.innerHTML = '';
    
    if (paymentDates.length === 0) {
        alert.classList.remove('show');
        return;
    }
    
    paymentDates.forEach((payment, index) => {
        const dateItem = document.createElement('div');
        dateItem.className = 'payment-date-item';
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®
        const formattedDate = payment.date.toLocaleDateString('ar-SA', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            weekday: 'long'
        });
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
        const today = new Date();
        const daysUntil = Math.ceil((payment.date - today) / (1000 * 60 * 60 * 24));
        
        let daysText = '';
        if (daysUntil > 0) {
            daysText = `<span class="badge bg-light text-dark ms-2">Ø¨Ø¹Ø¯ ${daysUntil} ÙŠÙˆÙ…</span>`;
        } else if (daysUntil === 0) {
            daysText = '<span class="badge bg-warning text-dark ms-2">Ø§Ù„ÙŠÙˆÙ…</span>';
        } else {
            daysText = `<span class="badge bg-secondary ms-2">Ù…Ù†Ø° ${Math.abs(daysUntil)} ÙŠÙˆÙ…</span>`;
        }
        
        dateItem.innerHTML = `
            <div class="d-flex align-items-center">
                <div class="payment-number me-3">${payment.number}</div>
                <div>
                    <div><strong>${formattedDate}</strong></div>
                    <small style="opacity: 0.8;">Ø§Ù„Ø¯ÙØ¹Ø© Ø±Ù‚Ù… ${payment.number}</small>
                </div>
            </div>
            <div>
                ${daysText}
            </div>
        `;
        
        datesList.appendChild(dateItem);
        
        // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 12 Ø¯ÙØ¹Ø© ÙÙ‚Ø·
        if (index >= 11) return false;
    });
    
    // Ø¥Ø¶Ø§ÙØ© Ù…Ù„Ø§Ø­Ø¸Ø© Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø¯ÙØ¹Ø§Øª Ø£ÙƒØ«Ø±
    if (paymentDates.length > 12) {
        const moreNote = document.createElement('div');
        moreNote.className = 'text-center mt-3';
        moreNote.style.opacity = '0.8';
        moreNote.innerHTML = `<small><i class="fas fa-ellipsis-h me-2"></i>ÙˆÙ‡Ù†Ø§Ùƒ ${paymentDates.length - 12} Ø¯ÙØ¹Ø© Ø¥Ø¶Ø§ÙÙŠØ© Ø­ØªÙ‰ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù‚Ø¯</small>`;
        datesList.appendChild(moreNote);
    }
    
    // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    alert.classList.add('show');
}

// Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
document.addEventListener('DOMContentLoaded', function() {
    const startDateInput = document.getElementById('contract_start_date');
    const endDateInput = document.getElementById('contract_end_date');
    const paymentMethodSelect = document.getElementById('payment_method');
    const paymentDayInput = document.getElementById('payment_day');
    
    if (startDateInput) startDateInput.addEventListener('change', calculatePaymentDates);
    if (endDateInput) endDateInput.addEventListener('change', calculatePaymentDates);
    if (paymentMethodSelect) paymentMethodSelect.addEventListener('change', calculatePaymentDates);
    if (paymentDayInput) paymentDayInput.addEventListener('input', calculatePaymentDates);
    
    // Ø­Ø³Ø§Ø¨ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    calculatePaymentDates();
});
</script>
{% endblock %}
