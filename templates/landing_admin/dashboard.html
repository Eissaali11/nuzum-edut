{% extends "landing_admin/layout.html" %}

{% block title %}لوحة المعلومات - إدارة صفحة الهبوط{% endblock %}
{% block page_title %}لوحة معلومات صفحة الهبوط{% endblock %}

{% block content %}
{% include 'landing_admin/partials/dashboard/_content.html' %}
{% endblock %}

{% block extra_js %}
<script>
function editBasicInfo() {
    // في التطبيق الحقيقي، يمكن فتح نافذة تعديل
    alert('سيتم إضافة نافذة تعديل المعلومات الأساسية');
}

// حفظ القسم الرئيسي
function saveHeroSection() {
    const data = {
        hero_title: document.getElementById('heroTitle').value,
        hero_subtitle: document.getElementById('heroSubtitle').value,
        hero_primary_btn: document.getElementById('heroPrimaryBtn').value,
        hero_secondary_btn: document.getElementById('heroSecondaryBtn').value
    };
    
    fetch('/landing-admin/api/save-hero', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showAlert('تم حفظ القسم الرئيسي بنجاح', 'success');
        } else {
            showAlert('حدث خطأ في الحفظ', 'danger');
        }
    })
    .catch(error => {
        console.error('خطأ:', error);
        showAlert('حدث خطأ في الاتصال', 'danger');
    });
}

// حفظ الإحصائيات
function saveStatsSection() {
    const data = {
        stats_companies: document.getElementById('statsCompanies').value,
        stats_employees: document.getElementById('statsEmployees').value,
        stats_vehicles: document.getElementById('statsVehicles').value,
        stats_satisfaction: document.getElementById('statsSatisfaction').value
    };
    
    fetch('/landing-admin/api/save-stats', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showAlert('تم حفظ الإحصائيات بنجاح', 'success');
        } else {
            showAlert('حدث خطأ في الحفظ', 'danger');
        }
    })
    .catch(error => {
        console.error('خطأ:', error);
        showAlert('حدث خطأ في الاتصال', 'danger');
    });
}

// حفظ معلومات الشركة
function saveCompanySection() {
    const data = {
        company_name: document.getElementById('companyName').value,
        company_description: document.getElementById('companyDescription').value,
        company_year: document.getElementById('companyYear').value,
        company_location: document.getElementById('companyLocation').value
    };
    
    fetch('/landing-admin/api/save-company', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            showAlert('تم حفظ معلومات الشركة بنجاح', 'success');
        } else {
            showAlert('حدث خطأ في الحفظ', 'danger');
        }
    })
    .catch(error => {
        console.error('خطأ:', error);
        showAlert('حدث خطأ في الاتصال', 'danger');
    });
}

// عرض رسائل التنبيه
function showAlert(message, type) {
    const alertDiv = document.createElement('div');
    alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
    alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    const container = document.querySelector('.container-fluid');
    container.insertBefore(alertDiv, container.firstChild);
    
    // إزالة التنبيه بعد 3 ثوان
    setTimeout(() => {
        alertDiv.remove();
    }, 3000);
}

// تحديث الإحصائيات كل دقيقة
setInterval(function() {
    fetch('{{ url_for("landing_admin.api_settings") }}')
        .then(response => response.json())
        .then(data => {
            console.log('تم تحديث البيانات');
        })
        .catch(error => {
            console.error('خطأ في تحديث البيانات:', error);
        });
}, 60000);
</script>
{% endblock %}