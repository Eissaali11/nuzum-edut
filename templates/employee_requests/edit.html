{% extends "layout.html" %}

{% block title %}تعديل الطلب{% endblock %}

{% block content %}
<div class="container-fluid p-4">
    <div class="row mb-4">
        <div class="col-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{{ url_for('employee_requests.index') }}">طلبات الموظفين</a></li>
                    <li class="breadcrumb-item"><a href="{{ url_for('employee_requests.view_request', request_id=emp_request.id) }}">طلب #{{ emp_request.id }}</a></li>
                    <li class="breadcrumb-item active">تعديل</li>
                </ol>
            </nav>
        </div>
    </div>

    <div class="row">
        <div class="col-md-8">
            <div class="card shadow-lg">
                <div class="card-header bg-gradient-warning text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-edit me-2"></i>
                        تعديل الطلب #{{ emp_request.id }}
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        <!-- معلومات أساسية -->
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label">اسم الموظف</label>
                                <input type="text" class="form-control" value="{{ emp_request.employee.name if emp_request.employee else 'غير محدد' }}" disabled>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">نوع الطلب</label>
                                <input type="text" class="form-control" value="{% if emp_request.request_type == RequestType.INVOICE %}فاتورة{% elif emp_request.request_type == RequestType.CAR_WASH %}غسيل سيارة{% elif emp_request.request_type == RequestType.CAR_INSPECTION %}فحص وتوثيق{% elif emp_request.request_type == RequestType.ADVANCE_PAYMENT %}سلفة مالية{% endif %}" disabled>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">الحالة</label>
                                <input type="text" class="form-control" value="{% if emp_request.status == RequestStatus.PENDING %}قيد الانتظار{% elif emp_request.status == RequestStatus.APPROVED %}موافق عليها{% elif emp_request.status == RequestStatus.REJECTED %}مرفوضة{% endif %}" disabled>
                            </div>

                            <div class="col-md-12 mb-3">
                                <label class="form-label">العنوان</label>
                                <input type="text" name="title" class="form-control" value="{{ emp_request.title }}" required>
                            </div>

                            {% if emp_request.request_type == RequestType.INVOICE %}
                            <div class="col-md-6 mb-3">
                                <label class="form-label">اسم المورد</label>
                                <input type="text" name="vendor_name" class="form-control" value="{{ specific_request.vendor_name if specific_request else '' }}" required>
                            </div>

                            <div class="col-md-6 mb-3">
                                <label class="form-label">المبلغ (ريال)</label>
                                <input type="number" step="0.01" name="amount" class="form-control" value="{{ emp_request.amount if emp_request.amount else 0 }}" required>
                            </div>
                            {% endif %}

                            <div class="col-md-12 mb-3">
                                <label class="form-label">الوصف / الملاحظات</label>
                                <textarea name="description" class="form-control" rows="4">{{ emp_request.description if emp_request.description else '' }}</textarea>
                            </div>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-success">
                                <i class="fas fa-save"></i> حفظ التغييرات
                            </button>
                            <a href="{{ url_for('employee_requests.view_request', request_id=emp_request.id) }}" class="btn btn-secondary">
                                <i class="fas fa-times"></i> إلغاء
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card shadow-lg">
                <div class="card-header bg-gradient-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-info-circle me-2"></i>
                        معلومات إضافية
                    </h6>
                </div>
                <div class="card-body">
                    <p class="small text-muted mb-2">
                        <strong>تاريخ الإنشاء:</strong><br>
                        {{ emp_request.created_at.strftime('%Y-%m-%d %H:%M') }}
                    </p>
                    {% if emp_request.approved_at %}
                    <p class="small text-muted mb-2">
                        <strong>تاريخ المعالجة:</strong><br>
                        {{ emp_request.approved_at.strftime('%Y-%m-%d %H:%M') }}
                    </p>
                    {% endif %}
                    <hr>
                    <div class="alert alert-warning small mb-0">
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        <strong>ملاحظة:</strong> التعديل متاح فقط للحقول الأساسية. لا يمكن تعديل الصور أو الملفات المرفقة.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
