{% extends "admin_dashboard/layout.html" %}

{% block title %}إدارة المركبات - لوحة التحكم{% endblock %}
{% block page_title %}إدارة المركبات{% endblock %}

{% block content %}
{% include 'admin_dashboard/partials/vehicles/_content.html' %}
{% endblock %}

{% block extra_js %}
<script>
// تحديد/إلغاء تحديد الكل
function toggleSelectAll(type) {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('.select-item');
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
}

// حذف عنصر واحد
function deleteItem(type, id, name) {
    if (!confirmDelete(`هل أنت متأكد من حذف ${name}؟`)) {
        return;
    }
    
    fetch(`/admin/api/${type}/${id}`, {
        method: 'DELETE',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showMessage(data.message, 'success');
            setTimeout(() => location.reload(), 1000);
        } else {
            showMessage(data.message, 'error');
        }
    })
    .catch(error => {
        showMessage('حدث خطأ في الحذف', 'error');
    });
}

// الحذف المجمع
function bulkDelete(type) {
    const selected = document.querySelectorAll('.select-item:checked');
    
    if (selected.length === 0) {
        alert('يرجى تحديد عنصر واحد على الأقل');
        return;
    }
    
    if (!confirmDelete(`هل أنت متأكد من حذف ${selected.length} عنصر؟`)) {
        return;
    }
    
    const ids = Array.from(selected).map(checkbox => parseInt(checkbox.value));
    
    fetch('/admin/bulk-actions', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            action: 'delete',
            ids: ids,
            table: type
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showMessage(data.message, 'success');
            setTimeout(() => location.reload(), 1000);
        } else {
            showMessage(data.message, 'error');
        }
    })
    .catch(error => {
        showMessage('حدث خطأ في العملية', 'error');
    });
}
</script>
{% endblock %}