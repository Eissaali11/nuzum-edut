{% extends 'layout.html' %}

{% block title %}استيراد السيارات{% endblock %}

{% block extra_css %}
{% include 'vehicles/partials/import_vehicles/_extra_css.html' %}
{% endblock %}

{% block content %}
{% include 'vehicles/partials/import_vehicles/_content.html' %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const selectedFile = document.getElementById('selectedFile');
    const fileName = document.getElementById('fileName');

    // النقر على منطقة الرفع
    uploadArea.addEventListener('click', function() {
        fileInput.click();
    });

    // تغيير الملف
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            fileName.textContent = file.name;
            selectedFile.classList.add('show');
        }
    });

    // منع السلوك الافتراضي للسحب والإفلات
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // تسليط الضوء على منطقة الرفع عند السحب
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        uploadArea.classList.add('dragover');
    }

    function unhighlight(e) {
        uploadArea.classList.remove('dragover');
    }

    // التعامل مع إسقاط الملف
    uploadArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;

        if (files.length > 0) {
            const file = files[0];
            if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                fileInput.files = files;
                fileName.textContent = file.name;
                selectedFile.classList.add('show');
            } else {
                alert('يرجى اختيار ملف Excel (.xlsx أو .xls)');
            }
        }
    }
});
</script>
{% endblock %}