{{ super() }}
<script>
// ØªÙ… Ø¥Ø²Ø§Ù„Ø© ÙƒÙˆØ¯ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© - Ø§Ù„ØµÙˆØ± ØªÙØªØ­ Ø§Ù„Ø¢Ù† ÙÙŠ ØµÙØ­Ø© Ù…Ù†ÙØµÙ„Ø©

// Ù…Ø´Ø§Ø±ÙƒØ© ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ±Ø´Ø© Ù…Ø¹ Ø§Ù„ØµÙˆØ±
async function shareWorkshopDetails() {
    try {
        // Ø¬Ù…Ø¹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØ±
        const beforeImages = [];
        const afterImages = [];
        const imageFiles = [];
        
        {% if record.images %}
        {% for image in record.images %}
        {% if image.image_type == 'before' %}
        beforeImages.push({
            src: '/static/{{ image.image_path }}',
            description: '{{ image.notes or "ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­" }}'
        });
        {% elif image.image_type == 'after' %}
        afterImages.push({
            src: '/static/{{ image.image_path }}',
            description: '{{ image.notes or "ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­" }}'
        });
        {% endif %}
        {% endfor %}
        {% endif %}

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ± Ø¥Ù„Ù‰ Ù…Ù„ÙØ§Øª Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        for (const beforeImg of beforeImages) {
            try {
                const response = await fetch(beforeImg.src);
                const blob = await response.blob();
                const file = new File([blob], `Ù‚Ø¨Ù„_Ø§Ù„Ø¥ØµÙ„Ø§Ø­_{{ vehicle.plate_number }}.jpg`, {type: blob.type});
                imageFiles.push(file);
            } catch (e) {
                console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:', e);
            }
        }
        
        for (const afterImg of afterImages) {
            try {
                const response = await fetch(afterImg.src);
                const blob = await response.blob();
                const file = new File([blob], `Ø¨Ø¹Ø¯_Ø§Ù„Ø¥ØµÙ„Ø§Ø­_{{ vehicle.plate_number }}.jpg`, {type: blob.type});
                imageFiles.push(file);
            } catch (e) {
                console.log('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:', e);
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø³Ø§Ù„Ø© Ù…Ù†Ø¸Ù…Ø© ÙˆÙ…ÙØµÙ„Ø©
        let shareText = `ğŸš— ØªÙ‚Ø±ÙŠØ± Ø³Ø¬Ù„ Ø§Ù„ÙˆØ±Ø´Ø© - {{ vehicle.plate_number }}
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©: {{ vehicle.plate_number }}
â€¢ Ø§Ù„Ù…Ø§Ø±ÙƒØ©: {{ vehicle.make }}
â€¢ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„: {{ vehicle.model }}
â€¢ Ø§Ù„Ø³Ù†Ø©: {{ vehicle.year }}

ğŸª Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø©: {{ record.workshop_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
â€¢ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¯Ø®ÙˆÙ„: {{ record.formatted_entry_date or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}`;

{% if record.exit_date %}
shareText += `
â€¢ ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø±ÙˆØ¬: {{ record.formatted_exit_date }}`;
{% endif %}

{% if record.technician_name %}
shareText += `
â€¢ Ø§Ù„ÙÙ†ÙŠ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {{ record.technician_name }}`;
{% endif %}

shareText += `

ğŸ”§ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â€¢ Ø³Ø¨Ø¨ Ø§Ù„Ø¯Ø®ÙˆÙ„: {% if record.reason == 'maintenance' %}ğŸ”§ ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©{% elif record.reason == 'breakdown' %}âš ï¸ Ø¹Ø·Ù„{% elif record.reason == 'accident' %}ğŸ’¥ Ø­Ø§Ø¯Ø«{% else %}{{ record.reason or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}{% endif %}
â€¢ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­: {% if record.repair_status == 'completed' %}âœ… ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­{% elif record.repair_status == 'in_progress' %}ğŸ”„ Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°{% elif record.repair_status == 'pending_approval' %}â³ Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©{% else %}{{ record.repair_status or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}{% endif %}`;

{% if record.cost and record.cost > 0 %}
shareText += `
â€¢ Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©: {{ '{:,.2f}'.format(record.cost) }} Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ`;
{% endif %}

{% if record.description %}
shareText += `

ğŸ“ ÙˆØµÙ Ø§Ù„Ù…Ø´ÙƒÙ„Ø© ÙˆØ§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…Ù†ÙØ°Ø©:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{{ record.description }}`;
{% endif %}

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØµÙˆØ±
        if (beforeImages.length > 0 || afterImages.length > 0) {
            shareText += `

ğŸ“¸ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙ‚Ø© (${beforeImages.length + afterImages.length} ØµÙˆØ±Ø©):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;
            
            if (beforeImages.length > 0) {
                shareText += `
ğŸ“· ØµÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ (${beforeImages.length} ØµÙˆØ±Ø©):`;
                beforeImages.forEach((img, index) => {
                    if (img.description && img.description !== 'ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­') {
                        shareText += `
  ${index + 1}. ${img.description}`;
                    } else {
                        shareText += `
  ${index + 1}. ØµÙˆØ±Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­`;
                    }
                });
            }
            
            if (afterImages.length > 0) {
                shareText += `
âœ… ØµÙˆØ± Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ (${afterImages.length} ØµÙˆØ±Ø©):`;
                afterImages.forEach((img, index) => {
                    if (img.description && img.description !== 'ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­') {
                        shareText += `
  ${index + 1}. ${img.description}`;
                    } else {
                        shareText += `
  ${index + 1}. ØµÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥ØµÙ„Ø§Ø­`;
                    }
                });
            }
        } else {
            shareText += `

ğŸ“¸ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø±ÙÙ‚Ø©:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙˆØ± Ù…Ø±ÙÙ‚Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„`;
        }

{% if record.delivery_link or record.reception_link %}
shareText += `

ğŸ”— Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;
{% if record.delivery_link %}
shareText += `
â€¢ Ø±Ø§Ø¨Ø· ØªØ³Ù„ÙŠÙ… Ø§Ù„ÙˆØ±Ø´Ø©:
  {{ record.delivery_link }}`;
{% endif %}
{% if record.reception_link %}
shareText += `
â€¢ Ø±Ø§Ø¨Ø· Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø§Ù„ÙˆØ±Ø´Ø©:
  {{ record.reception_link }}`;
{% endif %}
{% endif %}

{% if record.notes %}
shareText += `

ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
{{ record.notes }}`;
{% endif %}

        shareText += `

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“… ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-SA')}
ğŸ•’ ÙˆÙ‚Øª Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleTimeString('ar-SA')}
ğŸ¢ Ù†Ø¸Ø§Ù… Ù†ÙØ¸Ù… Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø·ÙŠÙ„`;

        console.log('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø©:', shareText);

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù…Ø¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        const shareData = {
            title: 'ØªÙ‚Ø±ÙŠØ± Ø³Ø¬Ù„ Ø§Ù„ÙˆØ±Ø´Ø© - {{ vehicle.plate_number }}',
            text: shareText
        };

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…ØªØµÙØ­ ÙŠØ¯Ø¹Ù…Ù‡Ø§
        if (navigator.canShare && imageFiles.length > 0) {
            shareData.files = imageFiles;
        }

        if (navigator.share) {
            await navigator.share(shareData);
            console.log('ØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­!');
        } else {
            // Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø© ÙƒØ¨Ø¯ÙŠÙ„
            await navigator.clipboard.writeText(shareText);
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #10b981, #059669);
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
                z-index: 10000;
                font-weight: 600;
                animation: slideIn 0.3s ease;
            `;
            toast.innerHTML = `
                <i class="fas fa-check-circle" style="margin-left: 8px;"></i>
                ØªÙ… Ù†Ø³Ø® ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ±Ø´Ø© Ù„Ù„Ø­Ø§ÙØ¸Ø©!
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

    } catch (error) {
        console.error('Ø®Ø·Ø£ ÙÙŠ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØªÙ‚Ø±ÙŠØ±:', error);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
        const errorToast = document.createElement('div');
        errorToast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.3);
            z-index: 10000;
            font-weight: 600;
        `;
        errorToast.innerHTML = `
            <i class="fas fa-exclamation-triangle" style="margin-left: 8px;"></i>
            Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.
        `;
        
        document.body.appendChild(errorToast);
        
        setTimeout(() => errorToast.remove(), 3000);
    }
}

// Ø¥Ø¶Ø§ÙØ© CSS Ù„Ù„ØªØ­Ø±ÙŠÙƒ
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);
</script>
