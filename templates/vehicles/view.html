{% extends 'layout.html' %}

{% block extra_css %}
<style>
    /* Modern Vehicle Management Styles */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #05122D 100%);
        --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        --info-gradient: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --card-shadow-hover: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        --glass-bg: rgba(255, 255, 255, 0.95);
        --glass-border: rgba(255, 255, 255, 0.2);
    }

    /* Enhanced Page Header */
    .vehicle-header {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
        animation: slideDown 0.6s ease-out;
    }

    .vehicle-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: var(--primary-gradient);
    }

    .vehicle-header h2 {
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    /* Enhanced Action Buttons */
    .btn-vehicle-action {
        position: relative;
        overflow: hidden;
        border: none;
        border-radius: 12px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--card-shadow);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        min-width: 140px;
        justify-content: center;
    }

    .btn-vehicle-action::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s ease;
    }

    .btn-vehicle-action:hover::before {
        left: 100%;
    }

    .btn-vehicle-action:hover {
        transform: translateY(-2px);
        box-shadow: var(--card-shadow-hover);
        text-decoration: none;
    }

    .btn-warning-enhanced {
        background: var(--warning-gradient);
        color: white;
    }

    .btn-primary-enhanced {
        background: var(--primary-gradient);
        color: white;
    }

    .btn-success-enhanced {
        background: var(--success-gradient);
        color: white;
    }

    .btn-info-enhanced {
        background: var(--info-gradient);
        color: white;
    }

    .btn-danger-enhanced {
        background: var(--danger-gradient);
        color: white;
    }

    /* Enhanced Tabs */
    .nav-tabs-enhanced {
        border-bottom: 2px solid rgba(0, 0, 0, 0.1);
    }

    .nav-tabs-enhanced .nav-link {
        border: none;
        border-radius: 8px 8px 0 0;
        padding: 1rem 1.5rem;
        font-weight: 600;
        color: #6c757d;
        transition: all 0.3s ease;
        margin-right: 0.5rem;
    }

    .nav-tabs-enhanced .nav-link:hover {
        color: #05122D;
        transform: translateY(-2px);
    }

    .nav-tabs-enhanced .nav-link.active {
        color: white;
        background: var(--primary-gradient);
        box-shadow: var(--card-shadow);
        transform: translateY(0);
    }

    /* Enhanced Cards */
    .vehicle-card {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        box-shadow: var(--card-shadow);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        height: 100%;
        position: relative;
        animation: slideUp 0.6s ease-out both;
    }

    .vehicle-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        transform: translateX(-100%);
        transition: transform 0.6s ease;
    }

    .vehicle-card:hover::before {
        transform: translateX(100%);
    }

    .vehicle-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--card-shadow-hover);
    }

    .vehicle-card-header {
        background: linear-gradient(135deg, #3c57d2ff 0%, #05122D 100%);
        color: white;
        padding: 1.5rem;
        position: relative;
    }

    .vehicle-card-header::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
    }

    .vehicle-card-header h5 {
        margin: 0;
        font-weight: 700;
        font-size: 1.25rem;
    }

    /* Enhanced Badges */
    .badge-enhanced {
        padding: 0.5rem 0.75rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.75rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }

    .badge-enhanced:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    /* Enhanced Alert */
    .alert-enhanced {
        border: none;
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        backdrop-filter: blur(10px);
        animation: slideInRight 0.5s ease-out;
        position: relative;
        overflow: hidden;
    }

    .alert-enhanced::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #17a2b8, #20c997, #17a2b8);
    }

    .alert-warning-enhanced::before {
        background: linear-gradient(90deg, #ffc107, #fd7e14, #ffc107);
    }

    /* Animations */
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Staggered Animation for Cards */
    .vehicle-item:nth-child(1) { animation-delay: 0.1s; }
    .vehicle-item:nth-child(2) { animation-delay: 0.2s; }
    .vehicle-item:nth-child(3) { animation-delay: 0.3s; }
    .vehicle-item:nth-child(4) { animation-delay: 0.4s; }
    .vehicle-item:nth-child(5) { animation-delay: 0.5s; }
    .vehicle-item:nth-child(6) { animation-delay: 0.6s; }

    /* Responsive Design */
    @media (max-width: 768px) {
        .container-fluid {
            padding: 1rem;
        }
        
        .vehicle-header {
            padding: 1.5rem;
        }
        
        .vehicle-header h2 {
            font-size: 2rem;
        }
        
        .vehicle-card-header,
        .vehicle-card-body {
            padding: 1rem;
        }
        
        .btn-group-enhanced {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .btn-group-enhanced .btn {
            width: 100%;
            margin: 0;
        }
    }

    /* Safety Checks Table Enhancement */
    .safety-table-container {
        max-height: 400px;
        overflow-x: auto;
        overflow-y: auto;
        border: 2px solid #4a6b8a;
        border-radius: 15px;
        background-color: #2d4a6b;
        padding: 5px;
    }

    .safety-table {
        background-color: #2d4a6b;
        color: white;
        min-width: 1400px;
        white-space: nowrap;
    }

    .safety-table th {
        color: white;
        border-color: #4a6b8a;
        background: linear-gradient(135deg, #1e3a5c 0%, #2d4a6b 100%);
    }

    .safety-table td {
        color: white;
        border-color: #4a6b8a;
        background-color: rgba(45, 74, 107, 0.8);
    }

    /* Enhanced Document Cards */
    .document-card {
        border-radius: 12px;
        transition: all 0.3s ease;
        overflow: hidden;
    }

    .document-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }

    .document-card .card-body {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .document-card .document-preview {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    /* Enhanced Status Indicators */
    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 5px;
    }

    .status-active {
        background: #28a745;
        box-shadow: 0 0 10px #28a745;
    }

    .status-pending {
        background: #ffc107;
        box-shadow: 0 0 10px #ffc107;
    }

    .status-expired {
        background: #dc3545;
        box-shadow: 0 0 10px #dc3545;
    }

    /* Enhanced Form Controls */
    .form-control-enhanced {
        border-radius: 8px;
        border: 1px solid rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    .form-control-enhanced:focus {
        border-color: #667eea;
        box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25);
    }
</style>
{% endblock %}

{% block title %}ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: {{ vehicle.plate_number }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Enhanced Header -->
    <div class="vehicle-header">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <h2>
                    <i class="fas fa-car ms-2"></i>
                    ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: {{ vehicle.plate_number }}
                </h2>
                <p class="text-muted mb-0">{{ vehicle.make }} {{ vehicle.model }} - {{ vehicle.year }}</p>
            </div>
            <div class="d-flex flex-wrap gap-2">
                <a href="{{ url_for('vehicles.edit', id=vehicle.id) }}" class="btn-vehicle-action btn-warning-enhanced">
                    <i class="fas fa-edit"></i>
                    ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                </a>
                <a href="{{ url_for('vehicles.view_documents', id=vehicle.id) }}" class="btn-vehicle-action btn-primary-enhanced">
                    <i class="fas fa-id-card"></i>
                    ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                </a>
                <a href="{{ url_for('external_safety.external_safety_check_form', vehicle_id=vehicle.id) }}" 
                   class="btn-vehicle-action btn-success-enhanced" target="_blank">
                    <i class="fas fa-shield-alt"></i>
                    ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø©
                </a>
                <button class="btn-vehicle-action btn-info-enhanced"
                    onclick="shareSafetyCheckForm({{ vehicle.id }}, '{{ vehicle.plate_number }}')">
                    <i class="fas fa-share-alt"></i>
                    Ù…Ø´Ø§Ø±ÙƒØ© Ø±Ø§Ø¨Ø· Ø§Ù„ÙØ­Øµ
                </button>
                <a href="{{ url_for('vehicles.confirm_delete', id=vehicle.id) }}" class="btn-vehicle-action btn-danger-enhanced">
                    <i class="fas fa-trash-alt"></i>
                    Ø­Ø°Ù Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                </a>
                <a href="{{ url_for('vehicles.index') }}" class="btn-vehicle-action btn-outline-secondary">
                    <i class="fas fa-arrow-right"></i>
                    Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                </a>
            </div>
        </div>
    </div>

    {% if inspection_warnings %}
    <div class="alert alert-warning alert-enhanced mb-4">
        <i class="fas fa-exclamation-triangle ms-2"></i>
        {% for warning in inspection_warnings %}
        <span>{{ warning }}</span>{% if not loop.last %} | {% endif %} 
        {% endfor %}
    </div>
    {% endif %}

    <!-- Enhanced Tabs -->
    <ul class="nav nav-tabs nav-tabs-enhanced mb-4" id="vehicleTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="accidents-tab" data-bs-toggle="tab" data-bs-target="#accidents" type="button" role="tab" aria-controls="accidents" aria-selected="true">
                <i class="fas fa-car-crash me-1"></i> Ø§Ù„Ø­ÙˆØ§Ø¯Ø«
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="info-tab" data-bs-toggle="tab" data-bs-target="#info" type="button" role="tab" aria-controls="info" aria-selected="false">
                <i class="fas fa-info-circle me-1"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="documents-tab" data-bs-toggle="tab" data-bs-target="#documents" type="button" role="tab" aria-controls="documents" aria-selected="false">
                <i class="fas fa-file-alt me-1"></i> Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="inspections-tab" data-bs-toggle="tab" data-bs-target="#inspections" type="button" role="tab" aria-controls="inspections" aria-selected="false">
                <i class="fas fa-clipboard-check me-1"></i> Ø§Ù„ÙØ­ÙˆØµØ§Øª
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="workshop-tab" data-bs-toggle="tab" data-bs-target="#workshop" type="button" role="tab" aria-controls="workshop" aria-selected="false">
                <i class="fas fa-tools me-1"></i> Ø§Ù„ÙˆØ±Ø´Ø©
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="drivers-tab" data-bs-toggle="tab" data-bs-target="#drivers" type="button" role="tab" aria-controls="drivers" aria-selected="false">
                <i class="fas fa-user-tie me-1"></i> Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ†
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="projects-tab" data-bs-toggle="tab" data-bs-target="#projects" type="button" role="tab" aria-controls="projects" aria-selected="false">
                <i class="fas fa-project-diagram me-1"></i> Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="authorizations-tab" data-bs-toggle="tab" data-bs-target="#authorizations" type="button" role="tab" aria-controls="authorizations" aria-selected="false">
                <i class="fas fa-file-signature me-1"></i> Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª
            </button>
        </li>
    </ul>

    <div class="tab-content" id="vehicleTabsContent">
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø­ÙˆØ§Ø¯Ø« -->
        <div class="tab-pane fade show active" id="accidents" role="tabpanel" aria-labelledby="accidents-tab">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="vehicle-card card">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-car-crash ms-2"></i>
                                Ø§Ù„Ø­ÙˆØ§Ø¯Ø« Ø§Ù„Ù…Ø±ÙˆØ±ÙŠØ© 
                                {% if accidents %}
                                <span class="badge-enhanced bg-secondary">{{ accidents|length }}</span>
                                {% endif %}
                            </h5>
                            <div>
                                <a href="{{ url_for('vehicles.create_accident', id=vehicle.id) }}" 
                                   class="btn btn-sm btn-success">
                                    <i class="fas fa-plus ms-1"></i>
                                    Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ø¯Ø« Ø¬Ø¯ÙŠØ¯
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            {% if accidents %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ø¯Ø«</th>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                                            <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ø¯Ø«</th>
                                            <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                                            <th>Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ­Ù…Ù„</th>
                                            <th>Ù…Ø¨Ù„Øº Ø§Ù„Ø®ØµÙ…</th>
                                            <th>Ø­Ø§Ù„Ø© Ø§Ù„Ø®ØµÙ…</th>
                                            <th>Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for accident in accidents %}
                                        <tr>
                                            <td>{{ accident.accident_date|display_date }}</td>
                                            <td>{{ accident.driver_name }}</td>
                                            <td>
                                                {% if accident.accident_status == 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©' %}
                                                <span class="badge-enhanced bg-warning text-dark">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</span>
                                                {% elif accident.accident_status == 'Ù…ØºÙ„Ù‚' %}
                                                <span class="badge-enhanced bg-success">Ù…ØºÙ„Ù‚</span>
                                                {% elif accident.accident_status == 'Ù…Ø¹Ù„Ù‚' %}
                                                <span class="badge-enhanced bg-secondary">Ù…Ø¹Ù„Ù‚</span>
                                                {% elif accident.accident_status == 'ÙÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†' %}
                                                <span class="badge-enhanced bg-info">ÙÙŠ Ø§Ù„ØªØ£Ù…ÙŠÙ†</span>
                                                {% else %}
                                                <span class="badge-enhanced bg-secondary">{{ accident.accident_status }}</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ accident.vehicle_condition or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                            <td>
                                                {% if accident.liability_percentage > 0 %} 
                                                {% if accident.liability_percentage == 25 %}
                                                <span class="badge-enhanced bg-info">ØªØ­Ù…Ù„ Ø¬Ø²Ø¦ÙŠ (25%)</span>
                                                {% elif accident.liability_percentage == 50 %}
                                                <span class="badge-enhanced bg-warning text-dark">ØªØ­Ù…Ù„ Ù…ØªÙˆØ³Ø· (50%)</span>
                                                {% elif accident.liability_percentage == 75 %}
                                                <span class="badge-enhanced bg-danger">ØªØ­Ù…Ù„ ÙƒØ¨ÙŠØ± (75%)</span>
                                                {% elif accident.liability_percentage == 100 %}
                                                <span class="badge-enhanced bg-dark">ØªØ­Ù…Ù„ ÙƒØ§Ù…Ù„ (100%)</span>
                                                {% else %}
                                                <span class="badge-enhanced bg-secondary">{{ accident.liability_percentage }}%</span>
                                                {% endif %} 
                                                {% else %}
                                                <span class="badge-enhanced bg-light text-dark">Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ­Ù…Ù„ (0%)</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if accident.deduction_amount > 0 %} 
                                                {{ "{:,.2f}".format(accident.deduction_amount) }} Ø±ÙŠØ§Ù„ 
                                                {% else %}
                                                <span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if accident.deduction_amount > 0 %} 
                                                {% if accident.deduction_status %}
                                                <span class="badge-enhanced bg-success">ØªÙ… Ø§Ù„Ø®ØµÙ…</span>
                                                {% else %}
                                                <span class="badge-enhanced bg-danger">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø®ØµÙ…</span>
                                                {% endif %} 
                                                {% else %}
                                                <span class="text-muted">-</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if accident.accident_file_link %}
                                                <a href="{{ accident.accident_file_link }}" 
                                                   target="_blank" 
                                                   class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-file-alt"></i>
                                                </a>
                                                {% else %}
                                                <span class="text-muted">Ù„Ø§ ÙŠÙˆØ¬Ø¯</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="btn-group">
                                                    <a href="{{ url_for('vehicles.view_accident_details', id=accident.id) }}" 
                                                       class="btn btn-sm btn-info">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a href="{{ url_for('vehicles.edit_accident', id=accident.id) }}" 
                                                       class="btn btn-sm btn-warning">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    <a href="{{ url_for('vehicles.confirm_delete_accident', id=accident.id) }}" 
                                                       class="btn btn-sm btn-danger">
                                                        <i class="fas fa-trash"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-4">
                                <div class="mb-3">
                                    <i class="fas fa-car-crash fa-4x text-muted"></i>
                                </div>
                                <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­ÙˆØ§Ø¯Ø« Ù…Ø³Ø¬Ù„Ø©</h5>
                                <p class="text-muted">
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø­Ø§Ø¯Ø« Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ø¯Ø« Ø¬Ø¯ÙŠØ¯"
                                </p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
        <div class="tab-pane fade" id="info" role="tabpanel" aria-labelledby="info-tab">
            <div class="row mb-4">
                <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
                <div class="col-md-6 mb-4">
                    <div class="vehicle-card card">
                        <div class="vehicle-card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-info-circle ms-2"></i>
                                Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©:</div>
                                <div class="col-sm-8">
                                    {{ vehicle.plate_number }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø§Ù„Ù†ÙˆØ¹:</div>
                                <div class="col-sm-8">
                                    {{ vehicle.make }} {{ vehicle.model }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø³Ù†Ø© Ø§Ù„ØµÙ†Ø¹:</div>
                                <div class="col-sm-8">{{ vehicle.year }}</div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø§Ù„Ù„ÙˆÙ†:</div>
                                <div class="col-sm-8">
                                    <span class="badge-enhanced rounded-pill" 
                                          style="background-color: {{ vehicle.color }}; color: {{ '#000' if vehicle.color in ['white', 'yellow', 'silver'] else '#fff' }};">
                                        {{ vehicle.color }}
                                    </span>
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø§Ù„Ø­Ø§Ù„Ø©:</div>
                                <div class="col-sm-8">
                                    {% if vehicle.status == 'available' %}
                                    <span class="badge-enhanced bg-success">âœ… Ù…ØªØ§Ø­Ø©</span>
                                    {% elif vehicle.status == 'rented' %}
                                    <span class="badge-enhanced bg-info">ğŸš— Ù…Ø¤Ø¬Ø±Ø©</span>
                                    {% elif vehicle.status == 'in_project' %}
                                    <span class="badge-enhanced bg-info">ğŸš— Ù†Ø´Ø·Ø© Ù…Ø¹ Ø³Ø§Ø¦Ù‚</span>
                                    {% elif vehicle.status == 'in_workshop' %}
                                    <span class="badge-enhanced bg-warning text-dark">ğŸ”§ ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø© ØµÙŠØ§Ù†Ø©</span>
                                    {% elif vehicle.status == 'accident' %}
                                    <span class="badge-enhanced bg-danger">âš ï¸ ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø© Ø­Ø§Ø¯Ø«</span>
                                    {% elif vehicle.status == 'out_of_service' %}
                                    <span class="badge-enhanced bg-secondary">ğŸ”´ Ø®Ø§Ø±Ø¬ Ø§Ù„Ø®Ø¯Ù…Ø©</span>
                                    {% else %}
                                    <span class="badge-enhanced bg-secondary">{{ vehicle.status }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</div>
                                <div class="col-sm-8">
                                    {{ vehicle.created_at.strftime('%Y-%m-%d') }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«:</div>
                                <div class="col-sm-8">
                                    {{ vehicle.updated_at.strftime('%Y-%m-%d') }}
                                </div>
                            </div>
                            {% if vehicle.project %}
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:</div>
                                <div class="col-sm-8">
                                    <span class="badge-enhanced bg-info">{{ vehicle.project }}</span>
                                </div>
                            </div>
                            {% endif %}

                            <div class="row mb-3">
                                <div class="col-sm-4 fw-bold">Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ:</div>
                                <div class="col-sm-8">
                                    {% if current_driver %}
                                    <span class="text-success fw-bold">{{ current_driver.name }}</span>
                                    <small class="text-muted d-block">Ù…Ù†Ø° {{ current_driver.formatted_date }}</small>
                                    <div class="mt-2">
                                        <a href="{{ url_for('vehicles.view_handover', id=current_driver.handover_id) }}" 
                                           class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye ms-1"></i>
                                            Ù…Ø´Ø§Ù‡Ø¯Ø© Ø³Ø¬Ù„ Ø§Ù„ØªØ³Ù„ÙŠÙ…
                                        </a>
                                        {% if current_driver.mobile %}
                                        <a href="https://wa.me/{{ current_driver.mobile | replace('+', '') | replace(' ', '') | replace('-', '') }}?text={{ (
                                            'Ù…Ø±Ø­Ø¨Ø§Ù‹ ' ~ current_driver.name ~ '\n\n' ~
                                            'Ø¨Ø®ØµÙˆØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø±Ù‚Ù…: ' ~ vehicle.plate_number ~ '\n' ~
                                            'ØªØ§Ø±ÙŠØ® ' ~ current_driver.handover_type_ar ~ ': ' ~ current_driver.formatted_date ~ '\n\n' ~
                                            'ğŸš— Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø³Ø§Ø¦Ù‚ØŒ Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ù‚ÙŠØ§Ø¯Ø© Ø¢Ù…Ù†Ø©\n\n' ~
                                            'âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø©:\n' ~
                                            'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø²ÙŠØª Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠ Ù…ÙˆØ¹Ø¯Ù‡\n' ~
                                            'â€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙ‡ÙŠ Ø£Ù…Ø§Ù†Ø© ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ\n' ~
                                            'â€¢ ØªÙÙ‚Ø¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯ ÙˆØ§Ù„Ù…Ø§Ø¡ Ø¨Ø§Ù†ØªØ¸Ø§Ù…\n' ~
                                            'â€¢ Ø§Ù„ØªØ²Ù… Ø¨Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±Ø¹Ø©\n\n' ~
                                            'ğŸ“ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ù…Ù‡Ù…Ø©:\n' ~
                                            'â€¢ Ù†Ø¬Ù… (Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚): 920000560\n' ~
                                            'â€¢ Ø§Ù„Ù…Ø±ÙˆØ±: 993\n' ~
                                            'â€¢ Ø§Ù„Ù‡Ù„Ø§Ù„ Ø§Ù„Ø£Ø­Ù…Ø±: 997\n' ~
                                            'â€¢ Ø§Ù„Ø´Ø±Ø·Ø©: 999\n' ~
                                            'â€¢ Ø£Ù…Ù† Ø§Ù„Ø·Ø±Ù‚: 996\n\n' ~
                                            'ğŸ“„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·:\n' ~
                                            'â€¢ Ù…Ù„Ù PDF Ù„Ù„ØªØ³Ù„ÙŠÙ…/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:\n' ~ url_for('vehicles.handover_pdf_public', id=current_driver.handover_id, _external=True) ~
                                            (('\nâ€¢ ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©:\n' ~ request.url_root ~ 'static/' ~ vehicle.registration_form_image) if vehicle.registration_form_image else '') ~
                                            '\n\nğŸ™ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚'
                                        ) | urlencode }}"
                                           class="btn btn-sm btn-success ms-1"
                                           target="_blank"
                                           title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                                            <i class="fab fa-whatsapp ms-1"></i>
                                            ÙˆØ§ØªØ³Ø§Ø¨
                                        </a>
                                        {% endif %}
                                    </div>
                                    {% else %}
                                    <span class="text-muted">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% if vehicle.notes %}
                            <div class="row mb-2">
                                <div class="col-12 fw-bold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</div>
                                <div class="col-12 mt-2">
                                    <div class="alert alert-secondary">
                                        {{ vehicle.notes }}
                                    </div>
                                </div>
                            </div>
                            {% endif %}

                            <!-- Ù…Ù„ÙØ§Øª Google Drive Ø¯Ø§Ø®Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                            <hr class="my-3" />
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">
                                    <i class="fab fa-google-drive text-info ms-1"></i>
                                    Ù…Ù„ÙØ§Øª Google Drive:
                                </div>
                                <div class="col-sm-8">
                                    {% if vehicle.drive_folder_link %}
                                    <div class="d-flex align-items-center">
                                        <span class="badge-enhanced bg-success me-2">Ù…Ø±ØªØ¨Ø·</span>
                                        <a href="{{ vehicle.drive_folder_link }}" 
                                           target="_blank" 
                                           class="btn btn-sm btn-success me-2">
                                            <i class="fab fa-google-drive me-1"></i>
                                            ÙØªØ­ Ø§Ù„Ù…Ø¬Ù„Ø¯
                                        </a>
                                        <a href="{{ url_for('vehicles.drive_management', vehicle_id=vehicle.id) }}" 
                                           class="btn btn-sm btn-info">
                                            <i class="fas fa-cog me-1"></i>
                                            Ø¥Ø¯Ø§Ø±Ø©
                                        </a>
                                    </div>
                                    <small class="text-muted d-block mt-1">ØªÙ… Ø±Ø¨Ø· Ù…Ø¬Ù„Ø¯ Ù„ØªÙ†Ø¸ÙŠÙ… Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø±ÙƒØ¨Ø©</small>
                                    {% else %}
                                    <div class="d-flex align-items-center">
                                        <span class="badge-enhanced bg-warning text-dark me-2">ØºÙŠØ± Ù…Ø±ØªØ¨Ø·</span>
                                        <a href="{{ url_for('vehicles.drive_management', vehicle_id=vehicle.id) }}" 
                                           class="btn btn-sm btn-info">
                                            <i class="fas fa-link me-1"></i>
                                            Ø±Ø¨Ø· Ù…Ø¬Ù„Ø¯
                                        </a>
                                    </div>
                                    <small class="text-muted d-block mt-1">Ù„Ù… ÙŠØªÙ… Ø±Ø¨Ø· Ù…Ø¬Ù„Ø¯ Google Drive Ø¨Ø¹Ø¯</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± -->
                <div class="col-md-6 mb-4">
                    <div class="vehicle-card card">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-money-bill-wave ms-2"></i>
                                Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±
                            </h5>
                            <a href="{{ url_for('vehicles.create_rental', id=vehicle.id) }}" 
                               class="btn btn-sm btn-primary">
                                {% if rental %}ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±{% else %}Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠØ¬Ø§Ø±{% endif %}
                            </a>
                        </div>
                        <div class="card-body">
                            {% if rental %}
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©:</div>
                                <div class="col-sm-8">
                                    {{ rental.formatted_start_date }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:</div>
                                <div class="col-sm-8">
                                    {% if rental.end_date %} 
                                    {{ rental.formatted_end_date }} 
                                    {% else %}
                                    <span class="badge-enhanced bg-info">Ù…Ø³ØªÙ…Ø±</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ø§Ù„Ø´Ù‡Ø±ÙŠ:</div>
                                <div class="col-sm-8">
                                    {{ "{:,.2f}".format(rental.monthly_cost) }} Ø±ÙŠØ§Ù„
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±:</div>
                                <div class="col-sm-8">
                                    {% if rental.is_active %}
                                    <span class="badge-enhanced bg-success">Ù†Ø´Ø·</span>
                                    {% else %}
                                    <span class="badge-enhanced bg-danger">Ù…Ù†ØªÙ‡ÙŠ</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø§Ù„Ù…Ø¤Ø¬Ø±:</div>
                                <div class="col-sm-8">
                                    {{ rental.lessor_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„:</div>
                                <div class="col-sm-8">
                                    {{ rental.lessor_contact or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                                </div>
                            </div>
                            <div class="row mb-2">
                                <div class="col-sm-4 fw-bold">Ø±Ù‚Ù… Ø§Ù„Ø¹Ù‚Ø¯:</div>
                                <div class="col-sm-8">
                                    {{ rental.contract_number or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                                </div>
                            </div>
                            {% if rental.notes %}
                            <div class="row mb-2">
                                <div class="col-12 fw-bold">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±:</div>
                                <div class="col-12 mt-2">
                                    <div class="alert alert-secondary">
                                        {{ rental.notes }}
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            <div class="mt-3">
                                <a href="{{ url_for('vehicles.edit_rental', id=rental.id) }}" 
                                   class="btn btn-sm btn-warning">
                                    <i class="fas fa-edit ms-1"></i>
                                    ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø±
                                </a>
                            </div>
                            {% else %}
                            <div class="text-center py-4">
                                <div class="mb-3">
                                    <i class="fas fa-file-contract fa-4x text-muted"></i>
                                </div>
                                <h5>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¥ÙŠØ¬Ø§Ø± Ù†Ø´Ø· Ø­Ø§Ù„ÙŠØ§Ù‹</h5>
                                <p class="text-muted">
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¥ÙŠØ¬Ø§Ø± Ù„Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠØ¬Ø§Ø±"
                                </p>
                                <a href="{{ url_for('vehicles.create_rental', id=vehicle.id) }}" 
                                   class="btn btn-primary mt-2">
                                    <i class="fas fa-plus ms-1"></i>
                                    Ø¥Ø¶Ø§ÙØ© Ø¥ÙŠØ¬Ø§Ø±
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ -->
        <div class="tab-pane fade" id="documents" role="tabpanel" aria-labelledby="documents-tab">
            <div class="row mb-4">
                <div class="col-md-12 mb-4">
                    <div class="vehicle-card card">
                        <div class="vehicle-card-header">
                            <h5 class="mb-0">
                                <i class="fas fa-file-alt ms-2"></i>
                                Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø© -->
                                <div class="col-md-4 mb-3">
                                    <div class="document-card card h-100 border-primary">
                                        <div class="card-body text-center">
                                            <h6 class="card-title">
                                                <i class="fas fa-file-alt me-2"></i>
                                                ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©
                                            </h6>
                                            {% if vehicle.registration_form_image %}
                                            <div class="document-preview mb-3">
                                                <img src="{{ '/' + vehicle.registration_form_image }}" 
                                                     alt="ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©" 
                                                     class="img-fluid rounded" 
                                                     style="max-height: 200px; cursor: pointer;"
                                                     onclick="openImageModal('{{ '/' + vehicle.registration_form_image }}', 'ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©')">
                                            </div>
                                            <div class="d-flex justify-content-center gap-2">
                                                <button class="btn btn-sm btn-outline-primary" 
                                                        onclick="openImageModal('{{ '/' + vehicle.registration_form_image }}', 'ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-success" 
                                                        onclick="shareVehicleDocuments()"
                                                        title="Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨">
                                                    <i class="fab fa-whatsapp"></i>
                                                </button>
                                                <form method="POST" 
                                                      action="{{ url_for('vehicles.delete_document', id=vehicle.id) }}" 
                                                      class="d-inline">
                                                    <input type="hidden" name="document_type" value="registration_form">
                                                    <button type="submit" 
                                                            class="btn btn-sm btn-outline-danger"
                                                            onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©ØŸ')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                            {% else %}
                                            <div class="document-preview text-muted mb-3">
                                                <i class="fas fa-file-alt fa-3x"></i>
                                                <p class="mt-2">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©</p>
                                            </div>
                                            {% endif %}

                                            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© -->
                                            <form method="POST" 
                                                  action="{{ url_for('vehicles.upload_document', id=vehicle.id) }}" 
                                                  enctype="multipart/form-data" 
                                                  class="mt-3">
                                                <input type="hidden" name="document_type" value="registration_form">
                                                <div class="input-group">
                                                    <input type="file" 
                                                           name="file" 
                                                           class="form-control form-control-sm" 
                                                           accept="image/*,application/pdf" 
                                                           required>
                                                    <button type="submit" class="btn btn-sm btn-primary">
                                                        <i class="fas fa-upload"></i>
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <!-- ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØ­Ø© -->
                                <div class="col-md-4 mb-3">
                                    <div class="document-card card h-100 border-success">
                                        <div class="card-body text-center">
                                            <h6 class="card-title">
                                                <i class="fas fa-id-card me-2"></i>
                                                ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØ­Ø©
                                            </h6>
                                            {% if vehicle.plate_image %}
                                            <div class="document-preview mb-3">
                                                <img src="{{ '/' + vehicle.plate_image }}" 
                                                     alt="ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØ­Ø©" 
                                                     class="img-fluid rounded" 
                                                     style="max-height: 200px; cursor: pointer;"
                                                     onclick="openImageModal('{{ '/' + vehicle.plate_image }}', 'ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØ­Ø©')">
                                            </div>
                                            <div class="d-flex justify-content-center gap-2">
                                                <button class="btn btn-sm btn-outline-primary" 
                                                        onclick="openImageModal('{{ '/' + vehicle.plate_image }}', 'ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØ­Ø©')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <form method="POST" 
                                                      action="{{ url_for('vehicles.delete_document', id=vehicle.id) }}" 
                                                      class="d-inline">
                                                    <input type="hidden" name="document_type" value="plate">
                                                    <button type="submit" 
                                                            class="btn btn-sm btn-outline-danger"
                                                            onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØ­Ø©ØŸ')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                            {% else %}
                                            <div class="document-preview text-muted mb-3">
                                                <i class="fas fa-id-card fa-3x"></i>
                                                <p class="mt-2">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù„ÙˆØ­Ø©</p>
                                            </div>
                                            {% endif %}

                                            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© -->
                                            <form method="POST" 
                                                  action="{{ url_for('vehicles.upload_document', id=vehicle.id) }}" 
                                                  enctype="multipart/form-data" 
                                                  class="mt-3">
                                                <input type="hidden" name="document_type" value="plate">
                                                <div class="input-group">
                                                    <input type="file" 
                                                           name="file" 
                                                           class="form-control form-control-sm" 
                                                           accept="image/*,application/pdf" 
                                                           required>
                                                    <button type="submit" class="btn btn-sm btn-success">
                                                        <i class="fas fa-upload"></i>
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ù…Ù„Ù Ø§Ù„ØªØ£Ù…ÙŠÙ† -->
                                <div class="col-md-4 mb-3">
                                    <div class="document-card card h-100 border-warning">
                                        <div class="card-body text-center">
                                            <h6 class="card-title">
                                                <i class="fas fa-shield-alt me-2"></i>
                                                Ù…Ù„Ù Ø§Ù„ØªØ£Ù…ÙŠÙ†
                                            </h6>
                                            {% if vehicle.insurance_file %}
                                            <div class="document-preview mb-3">
                                                {% if vehicle.insurance_file.lower().endswith('.pdf') %}
                                                <div class="text-center">
                                                    <i class="fas fa-file-pdf fa-4x text-danger mb-2"></i>
                                                    <p class="small">Ù…Ù„Ù PDF</p>
                                                </div>
                                                {% else %}
                                                <img src="{{ '/' + vehicle.insurance_file }}" 
                                                     alt="Ù…Ù„Ù Ø§Ù„ØªØ£Ù…ÙŠÙ†" 
                                                     class="img-fluid rounded" 
                                                     style="max-height: 200px; cursor: pointer;"
                                                     onclick="openImageModal('{{ '/' + vehicle.insurance_file }}', 'Ù…Ù„Ù Ø§Ù„ØªØ£Ù…ÙŠÙ†')">
                                                {% endif %}
                                            </div>
                                            <div class="d-flex justify-content-center gap-2">
                                                <a href="{{ '/' + vehicle.insurance_file }}" 
                                                   target="_blank" 
                                                   class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-eye"></i>
                                                </a>
                                                <form method="POST" 
                                                      action="{{ url_for('vehicles.delete_document', id=vehicle.id) }}" 
                                                      class="d-inline">
                                                    <input type="hidden" name="document_type" value="insurance">
                                                    <button type="submit" 
                                                            class="btn btn-sm btn-outline-danger"
                                                            onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù…Ù„Ù Ø§Ù„ØªØ£Ù…ÙŠÙ†ØŸ')">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </form>
                                            </div>
                                            {% else %}
                                            <div class="document-preview text-muted mb-3">
                                                <i class="fas fa-shield-alt fa-3x"></i>
                                                <p class="mt-2">Ù„Ù… ÙŠØªÙ… Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„ØªØ£Ù…ÙŠÙ†</p>
                                            </div>
                                            {% endif %}

                                            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù -->
                                            <form method="POST" 
                                                  action="{{ url_for('vehicles.upload_document', id=vehicle.id) }}" 
                                                  enctype="multipart/form-data" 
                                                  class="mt-3">
                                                <input type="hidden" name="document_type" value="insurance">
                                                <div class="input-group">
                                                    <input type="file" 
                                                           name="file" 
                                                           class="form-control form-control-sm" 
                                                           accept="image/*,application/pdf,.doc,.docx" 
                                                           required>
                                                    <button type="submit" class="btn btn-sm btn-warning">
                                                        <i class="fas fa-upload"></i>
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <!-- Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
                <div class="col-md-12 mb-4">
                    <div class="vehicle-card card">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-id-card ms-2"></i>
                                ÙˆØ«Ø§Ø¦Ù‚ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                            </h5>
                            <a href="{{ url_for('vehicles.edit_documents', id=vehicle.id) }}" 
                               class="btn btn-sm btn-primary">
                                <i class="fas fa-edit ms-1"></i>
                                ØªØ¹Ø¯ÙŠÙ„ ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„ÙˆØ«Ø§Ø¦Ù‚
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© -->
                                <div class="col-md-4 mb-3">
                                    <div class="document-card card h-100 {% if vehicle.authorization_expiry_date %} {% if (vehicle.authorization_expiry_date - today).days < 0 %} border-danger {% elif (vehicle.authorization_expiry_date - today).days <= 30 %} border-warning {% else %} border-success {% endif %} {% else %} border-light {% endif %}">
                                        <div class="card-body text-center">
                                            <h5 class="card-title mb-3">
                                                <i class="fas fa-file-contract me-1"></i>
                                                ØªÙÙˆÙŠØ¶ Ø§Ù„Ù…Ø±ÙƒØ¨Ø©
                                            </h5>
                                            {% if vehicle.authorization_expiry_date %}
                                            <p class="mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</p>
                                            <h4 class="mb-2">
                                                {{ vehicle.authorization_expiry_date.strftime('%Y-%m-%d') }}
                                            </h4>

                                            {% set days_remaining = (vehicle.authorization_expiry_date - today).days %}
                                            {% if days_remaining < 0 %}
                                            <div class="badge-enhanced bg-danger p-2 mb-2 w-100">
                                                Ù…Ù†ØªÙ‡ÙŠ Ù…Ù†Ø° {{ days_remaining|abs }} ÙŠÙˆÙ…
                                            </div>
                                            {% elif days_remaining <= 30 %}
                                            <div class="badge-enhanced bg-warning text-dark p-2 mb-2 w-100">
                                                ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…
                                            </div>
                                            {% else %}
                                            <div class="badge-enhanced bg-success p-2 mb-2 w-100">
                                                ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…
                                            </div>
                                            {% endif %}

                                            <a href="{{ url_for('vehicles.view_documents', id=vehicle.id) }}" 
                                               class="btn btn-sm btn-outline-primary w-100">
                                                <i class="fas fa-eye ms-1"></i>
                                                Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                            </a>
                                            {% else %}
                                            <div class="text-muted mb-3">
                                                <i class="fas fa-exclamation-circle fa-2x"></i>
                                                <p class="mt-2">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡</p>
                                            </div>
                                            <a href="{{ url_for('vehicles.edit_documents', id=vehicle.id) }}" 
                                               class="btn btn-sm btn-primary w-100">
                                                <i class="fas fa-plus ms-1"></i>
                                                Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®
                                            </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <!-- Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© -->
                                <div class="col-md-4 mb-3">
                                    <div class="document-card card h-100 {% if vehicle.registration_expiry_date %} {% if (vehicle.registration_expiry_date - today).days < 0 %} border-danger {% elif (vehicle.registration_expiry_date - today).days <= 30 %} border-warning {% else %} border-success {% endif %} {% else %} border-light {% endif %}">
                                        <div class="card-body text-center">
                                            <h5 class="card-title mb-3">
                                                <i class="fas fa-clipboard-list me-1"></i>
                                                Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø©
                                            </h5>
                                            {% if vehicle.registration_expiry_date %}
                                            <p class="mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</p>
                                            <h4 class="mb-2">
                                                {{ vehicle.registration_expiry_date.strftime('%Y-%m-%d') }}
                                            </h4>

                                            {% set days_remaining = (vehicle.registration_expiry_date - today).days %}
                                            {% if days_remaining < 0 %}
                                            <div class="badge-enhanced bg-danger p-2 mb-2 w-100">
                                                Ù…Ù†ØªÙ‡ÙŠ Ù…Ù†Ø° {{ days_remaining|abs }} ÙŠÙˆÙ…
                                            </div>
                                            {% elif days_remaining <= 30 %}
                                            <div class="badge-enhanced bg-warning text-dark p-2 mb-2 w-100">
                                                ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…
                                            </div>
                                            {% else %}
                                            <div class="badge-enhanced bg-success p-2 mb-2 w-100">
                                                ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…
                                            </div>
                                            {% endif %}

                                            <a href="{{ url_for('vehicles.view_documents', id=vehicle.id) }}" 
                                               class="btn btn-sm btn-outline-primary w-100">
                                                <i class="fas fa-eye ms-1"></i>
                                                Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                            </a>
                                            {% else %}
                                            <div class="text-muted mb-3">
                                                <i class="fas fa-exclamation-circle fa-2x"></i>
                                                <p class="mt-2">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡</p>
                                            </div>
                                            <a href="{{ url_for('vehicles.edit_documents', id=vehicle.id) }}" 
                                               class="btn btn-sm btn-primary w-100">
                                                <i class="fas fa-plus ms-1"></i>
                                                Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®
                                            </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>

                                <!-- Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ -->
                                <div class="col-md-4 mb-3">
                                    <div class="document-card card h-100 {% if vehicle.inspection_expiry_date %} {% if (vehicle.inspection_expiry_date - today).days < 0 %} border-danger {% elif (vehicle.inspection_expiry_date - today).days <= 30 %} border-warning {% else %} border-success {% endif %} {% else %} border-light {% endif %}">
                                        <div class="card-body text-center">
                                            <h5 class="card-title mb-3">
                                                <i class="fas fa-clipboard-check me-1"></i>
                                                Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ
                                            </h5>
                                            {% if vehicle.inspection_expiry_date %}
                                            <p class="mb-1">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</p>
                                            <h4 class="mb-2">
                                                {{ vehicle.inspection_expiry_date.strftime('%Y-%m-%d') }}
                                            </h4>

                                            {% set days_remaining = (vehicle.inspection_expiry_date - today).days %}
                                            {% if days_remaining < 0 %}
                                            <div class="badge-enhanced bg-danger p-2 mb-2 w-100">
                                                Ù…Ù†ØªÙ‡ÙŠ Ù…Ù†Ø° {{ days_remaining|abs }} ÙŠÙˆÙ…
                                            </div>
                                            {% elif days_remaining <= 30 %}
                                            <div class="badge-enhanced bg-warning text-dark p-2 mb-2 w-100">
                                                ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…
                                            </div>
                                            {% else %}
                                            <div class="badge-enhanced bg-success p-2 mb-2 w-100">
                                                ÙŠØªØ¨Ù‚Ù‰ {{ days_remaining }} ÙŠÙˆÙ…
                                            </div>
                                            {% endif %}

                                            <a href="{{ url_for('vehicles.view_documents', id=vehicle.id) }}" 
                                               class="btn btn-sm btn-outline-primary w-100">
                                                <i class="fas fa-eye ms-1"></i>
                                                Ø§Ù„ØªÙØ§ØµÙŠÙ„
                                            </a>
                                            {% else %}
                                            <div class="text-muted mb-3">
                                                <i class="fas fa-exclamation-circle fa-2x"></i>
                                                <p class="mt-2">Ù„Ù… ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯ ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡</p>
                                            </div>
                                            <a href="{{ url_for('vehicles.edit_documents', id=vehicle.id) }}" 
                                               class="btn btn-sm btn-primary w-100">
                                                <i class="fas fa-plus ms-1"></i>
                                                Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ§Ø±ÙŠØ®
                                            </a>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙØ­ÙˆØµØ§Øª -->
        <div class="tab-pane fade" id="inspections" role="tabpanel" aria-labelledby="inspections-tab">
            <div class="row mb-4">
                <div class="col-md-12 mb-4">
                    <div class="vehicle-card card h-100">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-clipboard-check ms-2"></i>
                                Ø§Ù„ÙØ­Øµ Ø§Ù„Ø¯ÙˆØ±ÙŠ 
                                {% if periodic_inspections %}
                                <span class="badge-enhanced bg-secondary">{{ periodic_inspections|length }}</span>
                                {% endif %}
                            </h5>
                            <div>
                                <a href="{{ url_for('vehicles.vehicle_inspections', id=vehicle.id) }}" 
                                   class="btn btn-sm btn-primary">
                                    <i class="fas fa-eye ms-1"></i>
                                    Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                                </a>
                                <a href="{{ url_for('vehicles.create_inspection', id=vehicle.id) }}" 
                                   class="btn btn-sm btn-success me-1">
                                    <i class="fas fa-plus ms-1"></i>
                                    Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            {% if periodic_inspections %}
                            <div class="table-responsive">
                                <table class="table table-sm table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Ø±Ù‚Ù… Ø§Ù„ÙØ­Øµ</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ­Øµ</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</th>
                                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for inspection in periodic_inspections[:3] %}
                                        <tr class="{% if inspection.is_expired %}table-danger{% elif inspection.is_expiring_soon %}table-warning{% endif %}">
                                            <td>{{ inspection.inspection_number }}</td>
                                            <td>{{ inspection.formatted_inspection_date }}</td>
                                            <td>{{ inspection.formatted_expiry_date }}</td>
                                            <td>
                                                {% if inspection.inspection_type == 'technical' %}
                                                <span class="badge-enhanced bg-info">ÙØ­Øµ ÙÙ†ÙŠ</span>
                                                {% elif inspection.inspection_type == 'periodic' %}
                                                <span class="badge-enhanced bg-primary">ÙØ­Øµ Ø¯ÙˆØ±ÙŠ</span>
                                                {% elif inspection.inspection_type == 'safety' %}
                                                <span class="badge-enhanced bg-warning text-dark">ÙØ­Øµ Ø£Ù…Ø§Ù†</span>
                                                {% else %}
                                                <span class="badge-enhanced bg-secondary">{{ inspection.inspection_type }}</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if inspection.inspection_status == 'valid' %}
                                                <span class="badge-enhanced bg-success">Ø³Ø§Ø±ÙŠ</span>
                                                {% elif inspection.inspection_status == 'expired' %}
                                                <span class="badge-enhanced bg-danger">Ù…Ù†ØªÙ‡ÙŠ</span>
                                                {% elif inspection.inspection_status == 'expiring_soon' %}
                                                <span class="badge-enhanced bg-warning text-dark">ÙŠÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ù‹Ø§</span>
                                                {% else %}
                                                <span class="badge-enhanced bg-secondary">{{ inspection.inspection_status }}</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% if periodic_inspections|length > 3 %}
                            <div class="text-center mt-2">
                                <a href="{{ url_for('vehicles.vehicle_inspections', id=vehicle.id) }}" 
                                   class="btn btn-sm btn-outline-primary">
                                    Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ({{ periodic_inspections|length }})
                                </a>
                            </div>
                            {% endif %} 
                            {% else %}
                            <div class="text-center py-4">
                                <div class="mb-3">
                                    <i class="fas fa-clipboard fa-4x text-muted"></i>
                                </div>
                                <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙØ­Øµ Ø¯ÙˆØ±ÙŠ</h5>
                                <p class="text-muted">
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ÙØ­Øµ Ø¯ÙˆØ±ÙŠ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ"
                                </p>
                                <a href="{{ url_for('vehicles.create_inspection', id=vehicle.id) }}" 
                                   class="btn btn-success mt-2">
                                    <i class="fas fa-plus ms-1"></i>
                                    Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø¯ÙˆØ±ÙŠ
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="col-md-12 mb-4">
                    <div class="vehicle-card card h-100">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-shield-alt ms-2"></i>
                                ÙØ­ÙˆØµØ§Øª Ø§Ù„Ø³Ù„Ø§Ù…Ø© 
                                {% if external_safety_checks %}
                                <span class="badge-enhanced bg-secondary">{{ external_safety_checks|length }}</span>
                                {% endif %}
                            </h5>
                            <div>
                                <a href="{{ url_for('vehicles.vehicle_safety_checks', id=vehicle.id) }}" 
                                   class="btn btn-sm btn-primary">
                                    <i class="fas fa-eye ms-1"></i>
                                    Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                                </a>
                                <a href="{{ url_for('external_safety.external_safety_check_form', vehicle_id=vehicle.id) }}" 
                                   class="btn btn-sm btn-success me-1">
                                    <i class="fas fa-plus ms-1"></i>
                                    Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            {% if external_safety_checks %}
                            <div class="safety-table-container">
                                <table class="table table-striped table-hover safety-table" id="safetyChecksTable">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©</th>
                                            <th>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</th>
                                            <th>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚</th>
                                            <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                            <th>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ÙØ­Øµ</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th>Ø§Ù„ØµÙˆØ±</th>
                                            <th>Ù…Ù„Ù/Ø±Ø§Ø¨Ø·</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for safety_check in external_safety_checks %}
                                        <tr data-status="{{ safety_check.approval_status }}">
                                            <td>{{ safety_check.id }}</td>
                                            <td>{{ safety_check.vehicle_plate_number }}</td>
                                            <td>{{ safety_check.vehicle_make_model }}</td>
                                            <td>{{ safety_check.driver_name }}</td>
                                            <td>{{ safety_check.driver_department }}</td>
                                            <td>{{ safety_check.driver_city }}</td>
                                            <td>{{ safety_check.inspection_date.strftime('%Y-%m-%d %H:%M') }}</td>
                                            <td>
                                                {% if safety_check.is_pending %}
                                                    <span class="badge-enhanced" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white;">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                                                {% elif safety_check.is_approved %}
                                                    <span class="badge-enhanced" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white;">Ù…Ø¹ØªÙ…Ø¯Ø©</span>
                                                {% elif safety_check.is_rejected %}
                                                    <span class="badge-enhanced" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white;">Ù…Ø±ÙÙˆØ¶Ø©</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <span class="badge-enhanced" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white;">{{ safety_check.safety_images | length }}</span>
                                            </td>
                                            <td>
                                                {% if safety_check.pdf_file_path or safety_check.drive_pdf_link %}
                                                <div class="d-flex gap-1">
                                                    {% if safety_check.pdf_file_path %}
                                                    <a href="{{ url_for('static', filename='uploads/' + safety_check.pdf_file_path) }}" 
                                                       target="_blank" 
                                                       class="btn btn-sm" 
                                                       style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none;"
                                                       title="Ù…Ù„Ù PDF">
                                                        <i class="fas fa-file-pdf"></i>
                                                    </a>
                                                    {% endif %}
                                                    {% if safety_check.drive_pdf_link %}
                                                    <a href="{{ safety_check.drive_pdf_link }}" 
                                                       target="_blank" 
                                                       class="btn btn-sm" 
                                                       style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; border: none;"
                                                       title="Ø±Ø§Ø¨Ø· Ø®Ø§Ø±Ø¬ÙŠ">
                                                        <i class="fas fa-external-link-alt"></i>
                                                    </a>
                                                    {% endif %}
                                                </div>
                                                {% else %}
                                                <span class="text-muted">-</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="btn-group" role="group">
                                                    <a href="{{ url_for('external_safety.admin_view_safety_check', check_id=safety_check.id) }}" 
                                                       class="btn btn-sm" style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border: none;">
                                                        <i class="fas fa-eye"></i> Ø¹Ø±Ø¶
                                                    </a>
                                                    <a href="{{ url_for('external_safety.edit_safety_check', check_id=safety_check.id) }}" 
                                                       class="btn btn-sm" style="background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); color: white; border: none;">
                                                        <i class="fas fa-edit"></i> ØªØ¹Ø¯ÙŠÙ„
                                                    </a>
                                                    
                                                    {% if safety_check.is_pending %}
                                                    <form method="POST" 
                                                          action="{{ url_for('external_safety.approve_safety_check', check_id=safety_check.id) }}" 
                                                          style="display: inline-block;">
                                                        <button type="submit" 
                                                                class="btn btn-sm" style="background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%); color: white; border: none;"
                                                                onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø¹ØªÙ…Ø§Ø¯ Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')">
                                                            <i class="fas fa-check"></i> Ø§Ø¹ØªÙ…Ø§Ø¯
                                                        </button>
                                                    </form>
                                                    
                                                    <a href="{{ url_for('external_safety.reject_safety_check_page', check_id=safety_check.id) }}" 
                                                       class="btn btn-sm" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none;">
                                                        <i class="fas fa-times"></i> Ø±ÙØ¶
                                                    </a>
                                                    {% endif %}
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            {% if external_safety_checks|length >= 1 %}
                            <div class="text-center mt-2">
                                <a href="{{ url_for('vehicles.vehicle_safety_checks', id=vehicle.id) }}" 
                                   class="btn btn-sm btn-outline-primary">
                                    Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª ({{ external_safety_checks|length }})
                                </a>
                            </div>
                            {% endif %} 
                            {% else %}
                            <div class="text-center py-4">
                                <div class="mb-3">
                                    <i class="fas fa-shield-alt fa-4x text-muted"></i>
                                </div>
                                <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙØ­Øµ Ø³Ù„Ø§Ù…Ø©</h5>
                                <p class="text-muted">
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ÙØ­Øµ Ø³Ù„Ø§Ù…Ø© Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ"
                                </p>
                                <a href="{{ url_for('external_safety.external_safety_check_form', vehicle_id=vehicle.id) }}" 
                                   class="btn btn-success mt-2">
                                    <i class="fas fa-plus ms-1"></i>
                                    Ø¥Ø¶Ø§ÙØ© ÙØ­Øµ Ø³Ù„Ø§Ù…Ø©
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="vehicle-card card mb-4">
                <div class="vehicle-card-header bg-warning">
                    <h5 class="mb-0">
                        <i class="fas fa-shield-alt ms-2"></i>
                        ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-info-circle text-info me-2"></i>
                                <span>ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø´Ø§Ø±ÙƒØ© Ø±Ø§Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†</span>
                            </div>
                            <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-link text-primary me-2"></i>
                                <small class="text-muted">Ø§Ù„Ø±Ø§Ø¨Ø·: {{ url_for('external_safety.external_safety_check_form', vehicle_id=vehicle.id, _external=True) }}</small>
                            </div>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-mobile-alt text-success me-2"></i>
                                <small class="text-muted">ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ù† Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ø­Ù…ÙˆÙ„ Ø£Ùˆ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±</small>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-warning btn-lg"
                                onclick="shareSafetyCheckForm({{ vehicle.id }}, '{{ vehicle.plate_number }}')">
                                <i class="fas fa-share-alt ms-2"></i>
                                Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                            </button>
                            <a href="{{ url_for('external_safety.external_safety_check_form', vehicle_id=vehicle.id) }}"
                                class="btn btn-outline-warning btn-lg ms-2"
                                target="_blank">
                                <i class="fas fa-external-link-alt ms-2"></i>
                                ÙØªØ­ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙˆØ±Ø´Ø© -->
        <div class="tab-pane fade" id="workshop" role="tabpanel" aria-labelledby="workshop-tab">
            <div class="row mb-4">
                <!-- Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø© -->
                <div class="col-md-12 mb-4">
                    <div class="vehicle-card card h-100">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-tools ms-2"></i>
                                Ø³Ø¬Ù„Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©
                                <span class="badge-enhanced bg-secondary">{{ workshop_records|length }}</span>
                            </h5>
                            <div>
                                <div class="dropdown d-inline-block me-2">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="fas fa-file-export ms-1"></i>
                                        ØªØµØ¯ÙŠØ± / Ù…Ø´Ø§Ø±ÙƒØ©
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="exportDropdown">
                                        <li>
                                            <a class="dropdown-item fw-bold" href="{{ url_for('vehicles.export_workshop_to_pdf', id=vehicle.id) }}">
                                                <i class="fas fa-file-pdf text-success ms-1"></i>
                                                ØªØµØ¯ÙŠØ± PDF
                                                <span class="badge bg-success ms-1">Ù…Ø­Ø³Ù†</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{{ url_for('vehicles.export_workshop_to_excel', id=vehicle.id) }}">
                                                <i class="fas fa-file-excel text-success ms-1"></i>
                                                ØªØµØ¯ÙŠØ± Excel
                                            </a>
                                        </li>
                                        <li>
                                            <hr class="dropdown-divider" />
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{{ url_for('vehicles.print_workshop_records', id=vehicle.id) }}" target="_blank">
                                                <i class="fas fa-print text-primary ms-1"></i>
                                                Ø·Ø¨Ø§Ø¹Ø©
                                            </a>
                                        </li>
                                        <li>
                                            <a class="dropdown-item" href="{{ url_for('vehicles.share_workshop_options', id=vehicle.id) }}">
                                                <i class="fas fa-share-alt text-info ms-1"></i>
                                                Ù…Ø´Ø§Ø±ÙƒØ©
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <a href="{{ url_for('vehicles.create_workshop', id=vehicle.id) }}" 
                                   class="btn btn-sm btn-primary">
                                    <i class="fas fa-plus ms-1"></i>
                                    Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
                                </a>
                            </div>
                        </div>
                        <div class="card-body">
                            {% if workshop_records %}
                            <div class="list-group">
                                {% for record in workshop_records %}
                                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center p-3">
                                    <div class="w-75">
                                        <div class="fw-bold d-flex align-items-center mb-1">
                                            {% if record.reason == 'maintenance' %}
                                            <span class="badge-enhanced bg-info me-2">ØµÙŠØ§Ù†Ø© Ø¯ÙˆØ±ÙŠØ©</span>
                                            {% elif record.reason == 'breakdown' %}
                                            <span class="badge-enhanced bg-warning text-dark me-2">Ø¹Ø·Ù„</span>
                                            {% elif record.reason == 'accident' %}
                                            <span class="badge-enhanced bg-danger me-2">Ø­Ø§Ø¯Ø«</span>
                                            {% else %}
                                            <span class="badge-enhanced bg-secondary me-2">{{ record.reason }}</span>
                                            {% endif %}

                                            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ -->
                                            {% if record.repair_status == 'in_progress' %}
                                            <span class="badge-enhanced rounded-pill bg-warning text-dark me-2">Ù‚ÙŠØ¯ Ø§Ù„ØªÙ†ÙÙŠØ°</span>
                                            {% elif record.repair_status == 'completed' %}
                                            <span class="badge-enhanced rounded-pill bg-success me-2">ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­</span>
                                            {% elif record.repair_status == 'pending_approval' %}
                                            <span class="badge-enhanced rounded-pill bg-info me-2">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©</span>
                                            {% endif %}

                                            <!-- Ø§Ø³Ù… Ø§Ù„ÙˆØ±Ø´Ø© -->
                                            {% if record.workshop_name %}
                                            <span class="small ms-2">{{ record.workshop_name }}</span>
                                            {% endif %}
                                        </div>
                                        <div class="small mb-1 d-flex align-items-center">
                                            <i class="fas fa-calendar-alt text-muted me-1"></i>
                                            <span class="text-muted me-1">Ø§Ù„Ø¯Ø®ÙˆÙ„:</span>
                                            <span class="fw-bold me-3">{{ record.formatted_entry_date }}</span>

                                            {% if record.exit_date %}
                                            <i class="fas fa-calendar-check text-success me-1"></i>
                                            <span class="text-muted me-1">Ø§Ù„Ø®Ø±ÙˆØ¬:</span>
                                            <span class="fw-bold">{{ record.formatted_exit_date }}</span>
                                            {% else %}
                                            <i class="fas fa-tools text-warning me-1"></i>
                                            <span class="text-warning fw-bold">Ù…Ø§ Ø²Ø§Ù„Øª ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©</span>
                                            {% endif %}
                                        </div>

                                        <div class="small d-flex align-items-center">
                                            <i class="fas fa-coins text-muted me-1"></i>
                                            <span class="text-muted me-1">Ø§Ù„ØªÙƒÙ„ÙØ©:</span>
                                            <span class="fw-bold">{{ "{:,.2f}".format(record.cost) }} Ø±ÙŠØ§Ù„</span>

                                            {% if record.technician_name %}
                                            <span class="mx-2">|</span>
                                            <i class="fas fa-user-cog text-muted me-1"></i>
                                            <span class="text-muted me-1">Ø§Ù„ÙÙ†ÙŠ:</span>
                                            <span>{{ record.technician_name }}</span>
                                            {% endif %}
                                        </div>

                                        <!-- Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¥Ù† ÙˆØ¬Ø¯Øª -->
                                        {% if record.delivery_link or record.reception_link %}
                                        <div class="mt-2">
                                            {% if record.delivery_link %}
                                            <a href="{{ record.delivery_link }}" 
                                               target="_blank" 
                                               class="btn btn-sm btn-outline-primary me-2">
                                                <i class="fas fa-file-export me-1"></i>
                                                Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ù„ÙŠÙ…
                                            </a>
                                            {% endif %} 
                                            {% if record.reception_link %}
                                            <a href="{{ record.reception_link }}" 
                                               target="_blank" 
                                               class="btn btn-sm btn-outline-success">
                                                <i class="fas fa-file-import me-1"></i>
                                                Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
                                            </a>
                                            {% endif %}
                                        </div>
                                        {% endif %}
                                    </div>

                                    <div class="d-flex flex-column align-items-center">
                                        <!-- Ø²Ø± Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
                                        <a href="{{ url_for('vehicles.workshop_details', workshop_id=record.id) }}" 
                                           class="btn btn-sm btn-info mb-2 w-100" 
                                           title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                            <i class="fas fa-eye ms-1"></i>
                                            Ø¹Ø±Ø¶
                                        </a>

                                        <!-- Ø²Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ -->
                                        <a href="{{ url_for('vehicles.edit_workshop', id=record.id) }}" 
                                           class="btn btn-sm btn-warning w-100" 
                                           title="ØªØ¹Ø¯ÙŠÙ„">
                                            <i class="fas fa-edit ms-1"></i>
                                            ØªØ¹Ø¯ÙŠÙ„
                                        </a>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            <div class="d-flex justify-content-between mt-3">
                                <div>
                                    <span class="fw-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ ØªÙƒØ§Ù„ÙŠÙ Ø§Ù„ØµÙŠØ§Ù†Ø©:</span>
                                    <span class="badge-enhanced bg-primary">{{ "{:,.2f}".format(total_maintenance_cost) }} Ø±ÙŠØ§Ù„</span>
                                </div>
                                <div>
                                    <span class="fw-bold">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙŠØ§Ù… ÙÙŠ Ø§Ù„ÙˆØ±Ø´Ø©:</span>
                                    <span class="badge-enhanced bg-danger">{{ days_in_workshop }} ÙŠÙˆÙ…</span>
                                </div>
                            </div>
                            {% else %}
                            <div class="text-center py-4">
                                <div class="mb-3">
                                    <i class="fas fa-wrench fa-4x text-muted"></i>
                                </div>
                                <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ÙˆØ±Ø´Ø© Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h5>
                                <p class="text-muted">
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯"
                                </p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† -->
        <div class="tab-pane fade" id="drivers" role="tabpanel" aria-labelledby="drivers-tab">
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="vehicle-card card h-100">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-user-tie ms-2"></i>
                                Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
                            </h5>
                            <a href="{{ url_for('vehicles.create_handover', id=vehicle.id) }}?type=delivery" 
                               class="btn btn-sm btn-success">
                                <i class="fas fa-exchange-alt ms-1"></i>
                                ØªØ³Ù„ÙŠÙ… Ù„Ø³Ø§Ø¦Ù‚ Ø¬Ø¯ÙŠØ¯
                            </a>
                        </div>
                        <div class="card-body">
                            {% if current_driver %}
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="h5 mb-1">{{ current_driver.name }}</div>
                                    <div class="small text-muted">Ù…Ù†Ø° {{ current_driver.formatted_date }}</div>
                                </div>
                                <div>
                                    <a href="{{ url_for('vehicles.view_handover', id=current_driver.handover_id) }}" 
                                       class="btn btn-sm btn-outline-primary ms-1" 
                                       title="Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('vehicles.handover_pdf_public', id=current_driver.handover_id) }}" 
                                       class="btn btn-sm btn-outline-danger ms-1" 
                                       target="_blank" 
                                       title="ØªØ­Ù…ÙŠÙ„ PDF">
                                        <i class="fas fa-file-pdf"></i>
                                    </a>
                                    {% if current_driver.mobile %}
                                    <a href="https://wa.me/{{ current_driver.mobile | replace('+', '') | replace(' ', '') | replace('-', '') }}?text={{ (
                                            'Ù…Ø±Ø­Ø¨Ø§Ù‹ ' ~ current_driver.name ~ '\n\n' ~
                                            'Ø¨Ø®ØµÙˆØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø±Ù‚Ù…: ' ~ vehicle.plate_number ~ '\n' ~
                                            'ØªØ§Ø±ÙŠØ® ' ~ current_driver.handover_type_ar ~ ': ' ~ current_driver.formatted_date ~ '\n\n' ~
                                            'ğŸš— Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø³Ø§Ø¦Ù‚ØŒ Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ù‚ÙŠØ§Ø¯Ø© Ø¢Ù…Ù†Ø©\n\n' ~
                                            'âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø©:\n' ~
                                            'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø²ÙŠØª Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠ Ù…ÙˆØ¹Ø¯Ù‡\n' ~
                                            'â€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙ‡ÙŠ Ø£Ù…Ø§Ù†Ø© ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ\n' ~
                                            'â€¢ ØªÙÙ‚Ø¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯ ÙˆØ§Ù„Ù…Ø§Ø¡ Ø¨Ø§Ù†ØªØ¸Ø§Ù…\n' ~
                                            'â€¢ Ø§Ù„ØªØ²Ù… Ø¨Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±Ø¹Ø©\n\n' ~
                                            'ğŸ“ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ù…Ù‡Ù…Ø©:\n' ~
                                            'â€¢ Ù†Ø¬Ù… (Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚): 920000560\n' ~
                                            'â€¢ Ø§Ù„Ù…Ø±ÙˆØ±: 993\n' ~
                                            'â€¢ Ø§Ù„Ù‡Ù„Ø§Ù„ Ø§Ù„Ø£Ø­Ù…Ø±: 997\n' ~
                                            'â€¢ Ø§Ù„Ø´Ø±Ø·Ø©: 999\n' ~
                                            'â€¢ Ø£Ù…Ù† Ø§Ù„Ø·Ø±Ù‚: 996\n\n' ~
                                            'ğŸ“„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·:\n' ~
                                            'â€¢ Ù…Ù„Ù PDF Ù„Ù„ØªØ³Ù„ÙŠÙ…/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:\n' ~ url_for('vehicles.handover_pdf_public', id=current_driver.handover_id, _external=True) ~
                                            (('\nâ€¢ ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©:\n' ~ request.url_root ~ 'static/' ~ vehicle.registration_form_image) if vehicle.registration_form_image else '') ~
                                            '\n\nğŸ™ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚'
                                        ) | urlencode }}"
                                           class="btn btn-sm btn-success ms-1"
                                           target="_blank"
                                           title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                                            <i class="fab fa-whatsapp ms-1"></i>
                                            ÙˆØ§ØªØ³Ø§Ø¨
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% else %}
                            <div class="text-muted">
                                <i class="fas fa-info-circle ms-1"></i>
                                Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="vehicle-card card h-100">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-history ms-2"></i>
                                Ø§Ù„Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø§Ù„Ø³Ø§Ø¨Ù‚ÙŠÙ†
                                <span class="badge-enhanced bg-secondary">{{ previous_drivers|length }}</span>
                            </h5>
                            <a href="{{ url_for('vehicles.create_handover', id=vehicle.id) }}?type=receive" 
                               class="btn btn-sm btn-info">
                                <i class="fas fa-exchange-alt ms-1"></i>
                                Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø³Ø§Ø¦Ù‚
                            </a>
                        </div>
                        <div class="card-body">
                            {% if previous_drivers %}
                            <div class="list-group">
                                {% for driver in previous_drivers %}
                                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-bold">{{ driver.name }}</div>
                                        <div class="small text-muted">{{ driver.formatted_date }}</div>
                                    </div>
                                    <div>
                                        <a href="{{ url_for('vehicles.view_handover', id=driver.handover_id) }}" 
                                           class="btn btn-sm btn-outline-primary ms-1" 
                                           title="Ù…Ø´Ø§Ù‡Ø¯Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a href="{{ url_for('vehicles.handover_pdf_public', id=driver.handover_id) }}" 
                                           class="btn btn-sm btn-outline-danger ms-1" 
                                           target="_blank" 
                                           title="ØªØ­Ù…ÙŠÙ„ PDF">
                                            <i class="fas fa-file-pdf"></i>
                                        </a>
                                        {% if driver.mobile %}
                                        <a href="https://wa.me/{{ driver.mobile | replace('+', '') | replace(' ', '') | replace('-', '') }}?text={{ (
                                            'Ù…Ø±Ø­Ø¨Ø§Ù‹ ' ~ driver.name ~ '\n\n' ~
                                            'Ø¨Ø®ØµÙˆØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø±Ù‚Ù…: ' ~ vehicle.plate_number ~ '\n' ~
                                            'ØªØ§Ø±ÙŠØ® ' ~ driver.handover_type_ar ~ ': ' ~ driver.formatted_date ~ '\n\n' ~
                                            'ğŸš— Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ø³Ø§Ø¦Ù‚ØŒ Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ù‚ÙŠØ§Ø¯Ø© Ø¢Ù…Ù†Ø©\n\n' ~
                                            'âš ï¸ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù…Ù‡Ù…Ø©:\n' ~
                                            'â€¢ ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø²ÙŠØª Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙŠ Ù…ÙˆØ¹Ø¯Ù‡\n' ~
                                            'â€¢ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ§Ø±Ø© ÙÙ‡ÙŠ Ø£Ù…Ø§Ù†Ø© ÙˆÙ…Ø³Ø¤ÙˆÙ„ÙŠØªÙƒ\n' ~
                                            'â€¢ ØªÙÙ‚Ø¯ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯ ÙˆØ§Ù„Ù…Ø§Ø¡ Ø¨Ø§Ù†ØªØ¸Ø§Ù…\n' ~
                                            'â€¢ Ø§Ù„ØªØ²Ù… Ø¨Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ­Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±Ø¹Ø©\n\n' ~
                                            'ğŸ“ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ø§Ù„Ù…Ù‡Ù…Ø©:\n' ~
                                            'â€¢ Ù†Ø¬Ù… (Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø±ÙŠÙ‚): 920000560\n' ~
                                            'â€¢ Ø§Ù„Ù…Ø±ÙˆØ±: 993\n' ~
                                            'â€¢ Ø§Ù„Ù‡Ù„Ø§Ù„ Ø§Ù„Ø£Ø­Ù…Ø±: 997\n' ~
                                            'â€¢ Ø§Ù„Ø´Ø±Ø·Ø©: 999\n' ~
                                            'â€¢ Ø£Ù…Ù† Ø§Ù„Ø·Ø±Ù‚: 996\n\n' ~
                                            'ğŸ“„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª ÙˆØ§Ù„Ø±ÙˆØ§Ø¨Ø·:\n' ~
                                            'â€¢ Ù…Ù„Ù PDF Ù„Ù„ØªØ³Ù„ÙŠÙ…/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:\n' ~ url_for('vehicles.handover_pdf_public', id=driver.handover_id, _external=True) ~
                                            (('\nâ€¢ ØµÙˆØ±Ø© Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø±Ø©:\n' ~ request.url_root ~ 'static/' ~ vehicle.registration_form_image) if vehicle.registration_form_image else '') ~
                                            '\n\nğŸ™ Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚'
                                        ) | urlencode }}"
                                           class="btn btn-sm btn-success ms-1"
                                           target="_blank"
                                           title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                                            <i class="fab fa-whatsapp"></i>
                                        </a>
                                        {% endif %}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="text-muted">
                                <i class="fas fa-info-circle ms-1"></i>
                                Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ø§Ø¦Ù‚ÙŠÙ† Ø³Ø§Ø¨Ù‚ÙŠÙ†
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <div class="col-12">
                    <div class="vehicle-card card">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-exchange-alt ms-2"></i>
                                Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù…
                                <span class="badge-enhanced bg-secondary">{{ handover_records|length }}</span>
                            </h5>
                            <a href="{{ url_for('vehicles.create_handover', id=vehicle.id) }}" 
                               class="btn btn-sm btn-primary">
                                <i class="fas fa-plus ms-1"></i>
                                Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªÙ„Ø§Ù…
                            </a>
                        </div>
                        <div class="card-body">
                            {% if handover_records %}
                            <form action="{{ url_for('vehicles.confirm_delete_handovers', vehicle_id=vehicle.id) }}" 
                                  method="post" 
                                  id="handover-delete-form">
                                {{ csrf_token() }}
                                <div class="mb-3 d-flex justify-content-end">
                                    <button type="submit" 
                                            class="btn btn-sm btn-danger" 
                                            id="delete-selected-btn" 
                                            disabled>
                                        <i class="fas fa-trash-alt ms-1"></i>
                                        Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯
                                    </button>
                                </div>

                                <div class="table-responsive">
                                    <table class="table table-bordered table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th width="40">
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="select-all">
                                                    </div>
                                                </th>
                                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                                <th>Ø§Ù„Ø´Ø®Øµ</th>
                                                <th>Ø§Ù„Ø¹Ø¯Ø§Ø¯</th>
                                                <th>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ÙˆÙ‚ÙˆØ¯</th>
                                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for record in handover_records %}
                                            <tr>
                                                <td>
                                                    <div class="form-check">
                                                        <input class="form-check-input handover-checkbox" 
                                                               type="checkbox" 
                                                               name="handover_ids[]" 
                                                               value="{{ record.id }}">
                                                    </div>
                                                </td>
                                                <td>{{ record.formatted_handover_date }}</td>
                                                <td>
                                                    {% if record.handover_type == 'delivery' %}
                                                    <span class="badge-enhanced bg-success">ØªØ³Ù„ÙŠÙ…</span>
                                                    {% else %}
                                                    <span class="badge-enhanced bg-info">Ø§Ø³ØªÙ„Ø§Ù…</span>
                                                    {% endif %}
                                                </td>
                                                <td>{{ record.person_name }}</td>
                                                <td>{{ record.mileage }} ÙƒÙ…</td>
                                                <td>{{ record.fuel_level }}</td>
                                                <td>
                                                    <div class="btn-group btn-group-sm">
                                                        <a href="{{ url_for('vehicles.view_handover', id=record.id) }}" 
                                                           class="btn btn-outline-primary">
                                                            <i class="fas fa-eye"></i>
                                                        </a>
                                                        <a href="{{ url_for('vehicles.edit_handover', id=record.id) }}" 
                                                           class="btn btn-outline-success">
                                                            <i class="fas fa-edit"></i>
                                                            ØªØ¹Ø¯ÙŠÙ„
                                                        </a>
                                                        {% if record.mobile %}
                                                        <a href="https://wa.me/{{ record.mobile.replace('+', '').replace(' ', '').replace('-', '') }}?text=Ù…Ø±Ø­Ø¨Ø§Ù‹ {{ record.person_name }}%0A%0AØ¨Ø®ØµÙˆØµ Ø§Ù„Ù…Ø±ÙƒØ¨Ø© Ø±Ù‚Ù…: {{ vehicle.plate_number }}%0AØªØ§Ø±ÙŠØ® {{ record.handover_type_ar }}: {{ record.formatted_handover_date }}%0A%0AØ±Ø§Ø¨Ø· Ù…Ù„Ù PDF Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…/Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:%0A{{ url_for('vehicles.handover_pdf_public', id=record.id, _external=True) }}%0A%0AØ´ÙƒØ±Ø§Ù‹ Ù„Ùƒ"
                                                           class="btn btn-outline-success" 
                                                           target="_blank" 
                                                           title="Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">
                                                            <i class="fab fa-whatsapp"></i>
                                                        </a>
                                                        {% endif %}
                                                        <a href="{{ url_for('vehicles.handover_pdf_public', id=record.id) }}" 
                                                           class="btn btn-outline-danger" 
                                                           target="_blank">
                                                            <i class="fas fa-file-pdf"></i>
                                                        </a>
                                                        <a href="{{ url_for('vehicles.confirm_delete_single_handover', handover_id=record.id) }}" 
                                                           class="btn btn-outline-danger" 
                                                           title="Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„">
                                                            <i class="fas fa-trash-alt"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </form>
                            {% else %}
                            <div class="text-center py-4">
                                <div class="mb-3">
                                    <i class="fas fa-file-signature fa-4x text-muted"></i>
                                </div>
                                <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª ØªØ³Ù„ÙŠÙ… ÙˆØ§Ø³ØªÙ„Ø§Ù…</h5>
                                <p class="text-muted">
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ³Ù„ÙŠÙ… Ø£Ùˆ Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ ØªØ³Ù„ÙŠÙ…/Ø§Ø³ØªÙ„Ø§Ù…"
                                </p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
        <div class="tab-pane fade" id="projects" role="tabpanel" aria-labelledby="projects-tab">
            <div class="row mb-4">
                <!-- ØªØ®ØµÙŠØµØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹ -->
                <div class="col-md-12 mb-4">
                    <div class="vehicle-card card h-100">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-project-diagram ms-2"></i>
                                ØªØ®ØµÙŠØµØ§Øª Ø§Ù„Ù…Ø´Ø§Ø±ÙŠØ¹
                                <span class="badge-enhanced bg-secondary">{{ project_assignments|length }}</span>
                            </h5>
                            <a href="{{ url_for('vehicles.create_project', id=vehicle.id) }}" 
                               class="btn btn-sm btn-primary">
                                <i class="fas fa-plus ms-1"></i>
                                ØªØ®ØµÙŠØµ Ù„Ù…Ø´Ø±ÙˆØ¹
                            </a>
                        </div>
                        <div class="card-body">
                            {% if project_assignments %}
                            <div class="list-group">
                                {% for assignment in project_assignments %}
                                <div class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="fw-bold">
                                            {{ assignment.project_name }} 
                                            {% if assignment.is_active %}
                                            <span class="badge-enhanced bg-success">Ù†Ø´Ø·</span>
                                            {% else %}
                                            <span class="badge-enhanced bg-danger">Ù…Ù†ØªÙ‡ÙŠ</span>
                                            {% endif %}
                                        </div>
                                        <div class="small">
                                            Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: {{ assignment.formatted_start_date }}
                                            {% if assignment.end_date %} |
                                            Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: {{ assignment.formatted_end_date }} 
                                            {% else %} |
                                            <span class="text-success">Ù…Ø³ØªÙ…Ø±</span>
                                            {% endif %}
                                        </div>
                                        <div class="small">
                                            Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: {{ assignment.manager_name }} | Ø§Ù„Ù…ÙˆÙ‚Ø¹: {{ assignment.location }}
                                        </div>
                                    </div>
                                    <a href="{{ url_for('vehicles.edit_project', id=assignment.id) }}" 
                                       class="btn btn-sm btn-outline-secondary">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </div>
                                {% endfor %}
                            </div>
                            {% else %}
                            <div class="text-center py-4">
                                <div class="mb-3">
                                    <i class="fas fa-building fa-4x text-muted"></i>
                                </div>
                                <h5>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ®ØµÙŠØµØ§Øª Ù„Ù…Ø´Ø§Ø±ÙŠØ¹</h5>
                                <p class="text-muted">
                                    ÙŠÙ…ÙƒÙ†Ùƒ ØªØ®ØµÙŠØµ Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù„Ù…Ø´Ø±ÙˆØ¹ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "ØªØ®ØµÙŠØµ Ù„Ù…Ø´Ø±ÙˆØ¹"
                                </p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª -->
        <div class="tab-pane fade" id="authorizations" role="tabpanel" aria-labelledby="authorizations-tab">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="vehicle-card card">
                        <div class="vehicle-card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <i class="fas fa-file-signature ms-2"></i>
                                Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠØ©
                                <span class="badge-enhanced bg-secondary">{{ external_authorizations|length }}</span>
                            </h5>
                            <a href="{{ url_for('vehicles.create_external_authorization', vehicle_id=vehicle.id) }}" 
                               class="btn btn-sm btn-primary">
                                <i class="fas fa-plus ms-1"></i>
                                Ø¥Ø¶Ø§ÙØ© ØªÙÙˆÙŠØ¶ Ø¬Ø¯ÙŠØ¯
                            </a>
                        </div>
                        <div class="card-body">
                            {% if external_authorizations %}
                            <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª -->
                            <div class="row mb-3">
                                <div class="col-4 text-center">
                                    <div class="fw-bold text-warning h5">
                                        {{ external_authorizations|selectattr('status', 'equalto', 'pending')|list|length }}
                                    </div>
                                    <small class="text-muted">ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</small>
                                </div>
                                <div class="col-4 text-center">
                                    <div class="fw-bold text-success h5">
                                        {{ external_authorizations|selectattr('status', 'equalto', 'approved')|list|length }}
                                    </div>
                                    <small class="text-muted">Ù…ÙÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡</small>
                                </div>
                                <div class="col-4 text-center">
                                    <div class="fw-bold text-danger h5">
                                        {{ external_authorizations|selectattr('status', 'equalto', 'rejected')|list|length }}
                                    </div>
                                    <small class="text-muted">Ù…Ø±ÙÙˆØ¶</small>
                                </div>
                            </div>
                            <hr />

                            <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙÙˆÙŠØ¶Ø§Øª -->
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                            <th>Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</th>
                                            <th>Ù†ÙˆØ¹ Ø§Ù„ØªÙÙˆÙŠØ¶</th>
                                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡</th>
                                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for auth in external_authorizations %}
                                        <tr>
                                            <td>
                                                {% if auth.employee %}
                                                    {{ auth.employee.name }}
                                                {% else %}
                                                    {{ auth.manual_driver_name }}
                                                    <small class="text-muted d-block">(Ø¥Ø¯Ø®Ø§Ù„ ÙŠØ¯ÙˆÙŠ)</small>
                                                {% endif %}
                                            </td>
                                            <td>{{ auth.project_name or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</td>
                                            <td>
                                                <span class="badge-enhanced bg-info">{{ auth.authorization_type }}</span>
                                            </td>
                                            <td>
                                                {% if auth.status == 'pending' %}
                                                <span class="badge-enhanced bg-warning">Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©</span>
                                                {% elif auth.status == 'approved' %}
                                                <span class="badge-enhanced bg-success">Ù…ÙÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡</span>
                                                {% elif auth.status == 'rejected' %}
                                                <span class="badge-enhanced bg-danger">Ù…Ø±ÙÙˆØ¶</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {{ auth.created_at.strftime('%Y-%m-%d') if auth.created_at else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a href="{{ url_for('vehicles.view_external_authorization', vehicle_id=vehicle.id, auth_id=auth.id) }}" 
                                                       class="btn btn-outline-primary" 
                                                       title="Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„">
                                                        <i class="fas fa-eye"></i>
                                                    </a>
                                                    <a href="{{ url_for('vehicles.edit_external_authorization', vehicle_id=vehicle.id, auth_id=auth.id) }}" 
                                                       class="btn btn-outline-warning" 
                                                       title="ØªØ¹Ø¯ÙŠÙ„">
                                                        <i class="fas fa-edit"></i>
                                                    </a>
                                                    {% if auth.file_path %}
                                                    <a href="{{ url_for('static', filename='uploads/authorizations/' + auth.file_path) }}" 
                                                       target="_blank" 
                                                       class="btn btn-outline-info" 
                                                       title="Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù">
                                                        <i class="fas fa-file-alt"></i>
                                                    </a>
                                                    {% endif %} 
                                                    {% if auth.external_link %}
                                                    <a href="{{ auth.external_link }}" 
                                                       target="_blank" 
                                                       class="btn btn-outline-success" 
                                                       title="ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø·">
                                                        <i class="fas fa-external-link-alt"></i>
                                                    </a>
                                                    {% endif %} 
                                                    {% if auth.status == 'pending' %}
                                                    <a href="{{ url_for('vehicles.approve_external_authorization', vehicle_id=vehicle.id, auth_id=auth.id) }}" 
                                                       class="btn btn-outline-success" 
                                                       onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„ØªÙÙˆÙŠØ¶ØŸ')" 
                                                       title="Ù…ÙˆØ§ÙÙ‚Ø©">
                                                        <i class="fas fa-check"></i>
                                                    </a>
                                                    <a href="{{ url_for('vehicles.reject_external_authorization', vehicle_id=vehicle.id, auth_id=auth.id) }}" 
                                                       class="btn btn-outline-danger" 
                                                       onclick="return confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ÙØ¶ Ù‡Ø°Ø§ Ø§Ù„ØªÙÙˆÙŠØ¶ØŸ')" 
                                                       title="Ø±ÙØ¶">
                                                        <i class="fas fa-times"></i>
                                                    </a>
                                                    {% endif %}
                                                </div>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            {% else %}
                            <div class="text-center py-4">
                                <i class="fas fa-file-signature fa-3x text-muted mb-3"></i>
                                <h6>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙÙˆÙŠØ¶Ø§Øª Ø®Ø§Ø±Ø¬ÙŠØ©</h6>
                                <p class="text-muted small">
                                    ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© ØªÙÙˆÙŠØ¶ Ø®Ø§Ø±Ø¬ÙŠ Ø¬Ø¯ÙŠØ¯ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± "Ø¥Ø¶Ø§ÙØ© ØªÙÙˆÙŠØ¶ Ø¬Ø¯ÙŠØ¯"
                                </p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener("DOMContentLoaded", function () {
    // Ø­ÙØ¸ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«
    const activeTab = localStorage.getItem("activeVehicleTab");
    if (activeTab) {
        const tabTrigger = new bootstrap.Tab(document.querySelector(activeTab));
        tabTrigger.show();
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù†Ø´Ø· Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
    const tabLinks = document.querySelectorAll('[data-bs-toggle="tab"]');
    tabLinks.forEach((tabLink) => {
        tabLink.addEventListener("shown.bs.tab", (event) => {
            localStorage.setItem(
                "activeVehicleTab",
                event.target.getAttribute("data-bs-target")
            );
        });
    });

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    const selectAllCheckbox = document.getElementById("select-all");
    const handoverCheckboxes = document.querySelectorAll(".handover-checkbox");
    const deleteSelectedBtn = document.getElementById("delete-selected-btn");
    const handoverDeleteForm = document.getElementById("handover-delete-form");

    if (selectAllCheckbox && handoverCheckboxes.length > 0 && deleteSelectedBtn) {
        // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        function updateDeleteButtonState() {
            const checkedCount = document.querySelectorAll(".handover-checkbox:checked").length;
            deleteSelectedBtn.disabled = checkedCount === 0;

            // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ø²Ø± Ù„ÙŠØ¹ÙƒØ³ Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            if (checkedCount > 0) {
                deleteSelectedBtn.innerHTML = `<i class="fas fa-trash-alt ms-1"></i> Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯ (${checkedCount})`;
            } else {
                deleteSelectedBtn.innerHTML = `<i class="fas fa-trash-alt ms-1"></i> Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯`;
            }
        }

        // ØªØ­Ø¯ÙŠØ¯/Ø¥Ù„ØºØ§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
        selectAllCheckbox.addEventListener("change", function () {
            handoverCheckboxes.forEach((checkbox) => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            updateDeleteButtonState();
        });

        // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø­Ø°Ù Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø£ÙŠ Ø®Ø§Ù†Ø©
        handoverCheckboxes.forEach((checkbox) => {
            checkbox.addEventListener("change", function () {
                // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø®Ø§Ù†Ø© ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
                const allChecked = document.querySelectorAll(".handover-checkbox:checked").length === handoverCheckboxes.length;
                selectAllCheckbox.checked = allChecked;

                // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ø­Ø°Ù
                updateDeleteButtonState();
            });
        });

        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø± ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        updateDeleteButtonState();
    }

    // ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
    if (handoverDeleteForm) {
        handoverDeleteForm.addEventListener("submit", function (e) {
            const checkedBoxes = document.querySelectorAll(".handover-checkbox:checked");
            if (checkedBoxes.length === 0) {
                e.preventDefault();
                alert("ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡Ø§");
                return false;
            }

            const confirmMessage = `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${checkedBoxes.length} Ø³Ø¬Ù„ Ù…Ù† Ø³Ø¬Ù„Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ… ÙˆØ§Ù„Ø§Ø³ØªÙ„Ø§Ù…ØŸ\n\nÙ‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`;
            if (!confirm(confirmMessage)) {
                e.preventDefault();
                return false;
            }
        });
    }

    // Ø¯Ø§Ù„Ø© Ù…Ø´Ø§Ø±ÙƒØ© Ø±Ø§Ø¨Ø· Ù†Ù…ÙˆØ°Ø¬ ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ
    function shareSafetyCheckForm(vehicleId, plateNumber) {
        // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø·Ø§Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ
        const formUrl = window.location.origin + "/external-safety/external-safety-check/" + vehicleId;

        const shareData = {
            title: "Ù†Ù…ÙˆØ°Ø¬ ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ - Ù†ÙØ¸Ù…",
            text: `Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‘‹

ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ù†Ù…ÙˆØ°Ø¬ ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ Ù„Ù„Ù…Ø±ÙƒØ¨Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©:

ğŸš— Ø±Ù‚Ù… Ø§Ù„Ù„ÙˆØ­Ø©: ${plateNumber}
ğŸ“‹ Ù†ÙˆØ¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬: ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ
ğŸ¢ Ù†Ø¸Ø§Ù… Ù†ÙØ¸Ù… Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø±ÙƒØ¨Ø§Øª

ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø§Ø¨Ø· Ø£Ø¯Ù†Ø§Ù‡ Ù„ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬:
${formUrl}

âš ï¸ Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨Ø¹Ù†Ø§ÙŠØ© ÙˆØ¥Ø±ÙØ§Ù‚ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„ÙØ­Øµ.

Ø´ÙƒØ±Ø§Ù‹ Ù„ØªØ¹Ø§ÙˆÙ†ÙƒÙ…`,
            url: formUrl,
        };

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Share API Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØ§Ø­Ø§Ù‹
        if (navigator.share) {
            navigator.share(shareData)
                .then(() => {
                    showToast("ØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­!", "success");
                })
                .catch((error) => {
                    console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©:", error);
                    fallbackShare(shareData);
                });
        } else {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø³Ø® Ù„Ù„Ø­Ø§ÙØ¸Ø© ÙƒØ¨Ø¯ÙŠÙ„
            fallbackShare(shareData);
        }
    }

    // Ø¯Ø§Ù„Ø© Ø¨Ø¯ÙŠÙ„Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©
    function fallbackShare(shareData) {
        const textToCopy = shareData.text;

        // Ù…Ø­Ø§ÙˆÙ„Ø© Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø©
        if (navigator.clipboard) {
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    showToast("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„ÙØ­Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø©!", "success");
                })
                .catch(() => {
                    showShareModal(shareData);
                });
        } else {
            showShareModal(shareData);
        }
    }

    // Ø¹Ø±Ø¶ Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©
    function showShareModal(shareData) {
        const modal = document.createElement("div");
        modal.className = "modal fade";
        modal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Ù…Ø´Ø§Ø±ÙƒØ© Ø±Ø§Ø¨Ø· ÙØ­Øµ Ø§Ù„Ø³Ù„Ø§Ù…Ø©</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p class="mb-3">Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù…Ø´Ø§Ø±ÙƒØªÙ‡Ø§:</p>
                        <textarea class="form-control" rows="8" readonly>${shareData.text}</textarea>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="copyToClipboard(this, '${shareData.text}')">
                            <i class="fas fa-copy ms-1"></i>
                            Ù†Ø³Ø® Ø§Ù„Ù†Øµ
                        </button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ø¥ØºÙ„Ø§Ù‚</button>
                    </div>
                </div>
            </div>
        `;

        document.body.appendChild(modal);
        const bootstrapModal = new bootstrap.Modal(modal);
        bootstrapModal.show();

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
        modal.addEventListener("hidden.bs.modal", () => {
            document.body.removeChild(modal);
        });
    }

    // Ø¯Ø§Ù„Ø© Ù†Ø³Ø® Ø§Ù„Ù†Øµ Ù„Ù„Ø­Ø§ÙØ¸Ø©
    function copyToClipboard(button, text) {
        const textarea = document.createElement("textarea");
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        document.body.removeChild(textarea);

        // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø²Ø± Ù…Ø¤Ù‚ØªØ§Ù‹
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check ms-1"></i> ØªÙ… Ø§Ù„Ù†Ø³Ø®!';
        button.className = "btn btn-success";

        setTimeout(() => {
            button.innerHTML = originalText;
            button.className = "btn btn-primary";
        }, 2000);
    }

    // Ø¯Ø§Ù„Ø© Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Toast
    function showToast(message, type = "info") {
        const toast = document.createElement("div");
        toast.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        toast.style.cssText = "top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; min-width: 300px;";
        toast.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;

        document.body.appendChild(toast);

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 5000);
    }
});
</script>

<!-- Ù†Ø§ÙØ°Ø© Ø¥Ø¯Ø§Ø±Ø© Google Drive -->
<div class="modal fade" id="driveModal" tabindex="-1" aria-labelledby="driveModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title" id="driveModalLabel">
                    <i class="fab fa-google-drive me-2"></i>
                    Ø¥Ø¯Ø§Ø±Ø© Ù…Ù„ÙØ§Øª Google Drive
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{{ url_for('vehicles.update_drive_link', vehicle_id=vehicle.id) }}" id="driveForm">
                <div class="modal-body">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />

                    <div class="row">
                        <div class="col-md-12">
                            <div class="mb-3">
                                <label for="driveLink" class="form-label">
                                    <i class="fas fa-link me-1"></i>
                                    Ø±Ø§Ø¨Ø· Ù…Ø¬Ù„Ø¯ Google Drive
                                </label>
                                <input type="url" 
                                       class="form-control" 
                                       id="driveLink" 
                                       name="drive_link" 
                                       value="{{ vehicle.drive_folder_link or '' }}" 
                                       placeholder="https://drive.google.com/drive/folders/..." 
                                       dir="ltr">
                                <div class="form-text">
                                    Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ ÙÙŠ Google Drive ÙˆØ§Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ù‡Ù†Ø§
                                </div>
                            </div>

                            <div id="previewContainer" style="display: none" class="alert">
                                <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-info">
                        <h6>
                            <i class="fas fa-info-circle me-1"></i> ÙƒÙŠÙÙŠØ© Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Google Drive:
                        </h6>
                        <ol class="mb-0">
                            <li>
                                Ø§Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰
                                <a href="https://drive.google.com" target="_blank">Google Drive</a>
                            </li>
                            <li>Ø§Ù†Ù‚Ø± Ø¨Ø²Ø± Ø§Ù„Ù…Ø§ÙˆØ³ Ø§Ù„Ø£ÙŠÙ…Ù† ÙˆØ§Ø®ØªØ± "Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯"</li>
                            <li>
                                Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¨Ø§Ø³Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø©: "{{ vehicle.plate_number }} - {{ vehicle.make }} {{ vehicle.model }}"
                            </li>
                            <li>
                                Ø§Ù†Ù‚Ø± Ø¨Ø²Ø± Ø§Ù„Ù…Ø§ÙˆØ³ Ø§Ù„Ø£ÙŠÙ…Ù† Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø¬Ù„Ø¯ ÙˆØ§Ø®ØªØ± "Ù…Ø´Ø§Ø±ÙƒØ©"
                            </li>
                            <li>
                                ØºÙŠØ± Ø§Ù„Ø¥Ø°Ù† Ø¥Ù„Ù‰ "Ø£ÙŠ Ø´Ø®Øµ Ù„Ø¯ÙŠÙ‡ Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠÙ…ÙƒÙ†Ù‡ Ø§Ù„Ø¹Ø±Ø¶"
                            </li>
                            <li>Ø§Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ§Ù„ØµÙ‚Ù‡ Ù‡Ù†Ø§</li>
                        </ol>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="btn btn-info">
                        <i class="fas fa-save me-1"></i>
                        Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·
                    </button>
                    {% if vehicle.drive_folder_link %}
                    <button type="submit" name="action" value="remove" class="btn btn-danger">
                        <i class="fas fa-trash me-1"></i>
                        Ø­Ø°Ù Ø§Ù„Ø±Ø§Ø¨Ø·
                    </button>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

<!-- Vehicle Document Sharing JavaScript -->
<script src="{{ url_for('static', filename='js/vehicle_document_share.js') }}"></script>

<!-- Vehicle data for sharing -->
<div style="display: none;">
    <span data-plate-number="{{ vehicle.plate_number }}"></span>
    <span data-make="{{ vehicle.make }}"></span>
    <span data-model="{{ vehicle.model }}"></span>
    <span data-year="{{ vehicle.year }}"></span>
    <span data-current-driver="{{ current_driver.name if current_driver else 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}"></span>
    <span data-driver-phone="{{ current_driver.mobile if current_driver else '' }}"></span>
    <span data-registration-form="{{ request.url_root }}{{ vehicle.registration_form_image if vehicle.registration_form_image else '' }}"></span>
    <span data-insurance-file="{{ request.url_root }}{{ vehicle.insurance_file if vehicle.insurance_file else '' }}"></span>
</div>
</div>
{% endblock %}
<!-- JavaScript for handover records selection and bulk delete -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get elements
    const selectAllCheckbox = document.getElementById('select-all');
    const handoverCheckboxes = document.querySelectorAll('.handover-checkbox');
    const deleteSelectedBtn = document.getElementById('delete-selected-btn');
    const handoverDeleteForm = document.getElementById('handover-delete-form');

    // Function to update delete button state
    function updateDeleteButtonState() {
        const checkedBoxes = document.querySelectorAll('.handover-checkbox:checked');
        deleteSelectedBtn.disabled = checkedBoxes.length === 0;
        
        if (checkedBoxes.length > 0) {
            deleteSelectedBtn.classList.remove('btn-secondary');
            deleteSelectedBtn.classList.add('btn-danger');
        } else {
            deleteSelectedBtn.classList.remove('btn-danger');
            deleteSelectedBtn.classList.add('btn-secondary');
        }
    }

    // Select all functionality
    if (selectAllCheckbox) {
        selectAllCheckbox.addEventListener('change', function() {
            handoverCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
            updateDeleteButtonState();
        });
    }

    // Individual checkbox change
    handoverCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            // Update select all checkbox state
            if (selectAllCheckbox) {
                const checkedCount = document.querySelectorAll('.handover-checkbox:checked').length;
                selectAllCheckbox.checked = checkedCount === handoverCheckboxes.length;
                selectAllCheckbox.indeterminate = checkedCount > 0 && checkedCount < handoverCheckboxes.length;
            }
            updateDeleteButtonState();
        });
    });

    // Form submission validation
    if (handoverDeleteForm) {
        handoverDeleteForm.addEventListener('submit', function(e) {
            const checkedBoxes = document.querySelectorAll('.handover-checkbox:checked');
            if (checkedBoxes.length === 0) {
                e.preventDefault();
                alert('ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø³Ø¬Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø­Ø°Ù');
                return false;
            }
        });
    }

    // Initialize button state
    updateDeleteButtonState();
});
</script>
