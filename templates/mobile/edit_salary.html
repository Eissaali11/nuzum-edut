{% extends 'mobile/layout.html' %}

{% block title %}تعديل راتب {{ salary.employee.name }} - {{ month_name }} {{ salary.year }}{% endblock %}

{% block header_title %}تعديل الراتب{% endblock %}

{% block header_actions %}
<button class="mobile-menu-button" aria-label="رجوع" onclick="window.history.back()">
    <i class="fas fa-arrow-right"></i>
</button>
{% endblock %}

{% block content %}
{% include 'mobile/partials/edit_salary/_content.html' %}
{% endblock %}

{% block scripts %}
<script>
// حساب صافي الراتب تلقائياً
function calculateNetSalary() {
    const basic = parseFloat(document.getElementById('basic_salary').value) || 0;
    const allowances = parseFloat(document.getElementById('allowances').value) || 0;
    const bonus = parseFloat(document.getElementById('bonus').value) || 0;
    const deductions = parseFloat(document.getElementById('deductions').value) || 0;
    
    const netSalary = basic + allowances + bonus - deductions;
    
    // تحديث المعاينة
    document.getElementById('net-salary-amount').textContent = 
        new Intl.NumberFormat('ar-SA').format(netSalary) + ' ريال';
    
    // تحديث تفاصيل الحساب
    document.querySelector('.basic').textContent = new Intl.NumberFormat('ar-SA').format(basic);
    document.querySelector('.allowances').textContent = new Intl.NumberFormat('ar-SA').format(allowances);
    document.querySelector('.bonus').textContent = new Intl.NumberFormat('ar-SA').format(bonus);
    document.querySelector('.deductions').textContent = new Intl.NumberFormat('ar-SA').format(deductions);
}

// ربط الحدث بجميع حقول الإدخال
document.addEventListener('DOMContentLoaded', function() {
    const inputs = ['basic_salary', 'allowances', 'bonus', 'deductions'];
    inputs.forEach(id => {
        document.getElementById(id).addEventListener('input', calculateNetSalary);
    });
    
    // حساب أولي
    calculateNetSalary();
});
</script>
{% endblock %}