<style>
/* بطاقة الملف الشخصي */
.profile-banner {
    background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
    border-radius: 0 0 24px 24px;
    padding: 30px 20px 40px;
    margin: -20px -20px 20px -20px;
    position: relative;
    text-align: center;
}

.profile-avatar-wrapper {
    width: 100px;
    height: 100px;
    margin: 0 auto 15px;
    position: relative;
}

.profile-avatar {
    width: 100%;
    height: 100%;
    background: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    border: 4px solid white;
}

.profile-avatar i {
    font-size: 40px;
    color: #8e8e93;
}

.profile-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.profile-name {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin-bottom: 5px;
}

.profile-job-title {
    font-size: 15px;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 0;
}

/* نظام التابات */
.tabs-container {
    background: white;
    border-radius: 16px 16px 0 0;
    box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.05);
    position: sticky;
    top: 60px;
    z-index: 100;
    margin: 0 -20px;
    padding: 12px 20px 0;
}

.tabs-wrapper {
    display: flex;
    gap: 8px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 12px;
    scrollbar-width: none;
}

.tabs-wrapper::-webkit-scrollbar {
    display: none;
}

.tab-button {
    flex: 0 0 auto;
    padding: 10px 20px;
    background: #f5f5f7;
    color: #8e8e93;
    border: none;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 6px;
}

.tab-button.active {
    background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
    color: white;
    box-shadow: 0 2px 8px rgba(74, 144, 226, 0.3);
}

.tab-button i {
    font-size: 12px;
}

.tab-content {
    display: none;
    padding-bottom: 80px;
}

.tab-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* البطاقات */
.info-cards-wrapper {
    padding: 0 20px;
}

.info-card {
    background: white;
    border-radius: 16px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
    border: 1px solid #f0f0f5;
    margin-bottom: 16px;
    overflow: hidden;
}

.card-header {
    padding: 16px;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-bottom: 1px solid #f0f0f5;
    display: flex;
    align-items: center;
    gap: 10px;
}

.card-icon {
    width: 36px;
    height: 36px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

.card-icon.primary {
    background: rgba(74, 144, 226, 0.1);
    color: #4A90E2;
}

.card-icon.success {
    background: rgba(52, 199, 89, 0.1);
    color: #34C759;
}

.card-icon.warning {
    background: rgba(255, 149, 0, 0.1);
    color: #FF9500;
}

.card-icon.danger {
    background: rgba(255, 59, 48, 0.1);
    color: #FF3B30;
}

.card-icon.info {
    background: rgba(0, 122, 255, 0.1);
    color: #007AFF;
}

.card-icon.purple {
    background: rgba(102, 126, 234, 0.1);
    color: #667eea;
}

.card-title {
    font-size: 16px;
    font-weight: 700;
    color: #1a1a1a;
    margin: 0;
    flex: 1;
}

.card-content {
    padding: 16px;
}

.info-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid #f0f0f5;
}

.info-item:last-child {
    border-bottom: none;
}

.info-label {
    font-size: 14px;
    color: #8e8e93;
    font-weight: 500;
}

.info-value {
    font-size: 14px;
    color: #1a1a1a;
    font-weight: 600;
    text-align: left;
}

.info-value a {
    color: #4A90E2;
    text-decoration: none;
}

.status-badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.status-badge.active {
    background: rgba(52, 199, 89, 0.1);
    color: #34C759;
}

.status-badge.inactive {
    background: rgba(255, 59, 48, 0.1);
    color: #FF3B30;
}

/* Modal الصورة */
.image-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
}

.modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    cursor: pointer;
    z-index: 10001;
}

.modal-image {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 90%;
    max-height: 90%;
    border-radius: 8px;
}

/* قائمة الإجراءات */
.action-menu-overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
    animation: fadeIn 0.2s ease;
}

.action-menu-overlay.active {
    display: block;
}

.action-menu {
    position: fixed;
    bottom: -100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 24px 24px 0 0;
    padding: 24px 20px 40px;
    z-index: 1000;
    transition: bottom 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    max-height: 80vh;
    overflow-y: auto;
}

.action-menu.active {
    bottom: 0;
}

.action-menu-handle {
    width: 40px;
    height: 4px;
    background: #e5e5ea;
    border-radius: 2px;
    margin: 0 auto 20px;
}

.action-menu-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    border-radius: 12px;
    margin-bottom: 8px;
    cursor: pointer;
    transition: background 0.2s ease;
    text-decoration: none;
    color: inherit;
}

.action-menu-item:hover {
    background: #f5f5f7;
}

.action-menu-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.action-menu-icon.edit {
    background: rgba(74, 144, 226, 0.1);
    color: #4A90E2;
}

.action-menu-icon.share {
    background: rgba(0, 122, 255, 0.1);
    color: #007AFF;
}

.action-menu-icon.pdf {
    background: rgba(255, 59, 48, 0.1);
    color: #FF3B30;
}

.action-menu-icon.excel {
    background: rgba(52, 199, 89, 0.1);
    color: #34C759;
}

.action-menu-icon.back {
    background: rgba(142, 142, 147, 0.1);
    color: #8e8e93;
}

.action-menu-text {
    flex: 1;
}

.action-menu-label {
    font-size: 15px;
    font-weight: 500;
    color: #1a1a1a;
    display: block;
    margin-bottom: 2px;
}

.action-menu-desc {
    font-size: 12px;
    color: #8e8e93;
}

/* بطاقة السيارة */
.vehicle-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 16px;
    padding: 20px;
    color: white;
    margin-bottom: 16px;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.vehicle-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.vehicle-icon {
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.vehicle-info {
    flex: 1;
}

.vehicle-name {
    font-size: 16px;
    font-weight: 700;
    margin-bottom: 4px;
}

.vehicle-plate {
    font-size: 13px;
    opacity: 0.9;
}

.vehicle-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
}

.vehicle-detail-item {
    background: rgba(255, 255, 255, 0.15);
    padding: 12px;
    border-radius: 12px;
}

.vehicle-detail-label {
    font-size: 11px;
    opacity: 0.8;
    margin-bottom: 6px;
}

.vehicle-detail-value {
    font-size: 14px;
    font-weight: 600;
}

/* بطاقة التاريخ */
.history-card {
    background: white;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid #f0f0f5;
}

.history-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
}

.history-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 16px;
}

.history-info {
    flex: 1;
}

.history-vehicle {
    font-size: 15px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 4px;
}

.history-plate {
    font-size: 13px;
    color: #718096;
}

.history-badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
}

.history-badge.delivery {
    background: rgba(52, 199, 89, 0.1);
    color: #34C759;
}

.history-badge.receipt {
    background: rgba(255, 149, 0, 0.1);
    color: #FF9500;
}

.history-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 8px;
    font-size: 12px;
}

.history-detail-item {
    background: #f7fafc;
    padding: 8px;
    border-radius: 8px;
}

.history-detail-label {
    color: #718096;
    margin-bottom: 4px;
    font-size: 11px;
}

.history-detail-value {
    color: #2d3748;
    font-weight: 600;
}

/* رسالة فارغة */
.empty-state {
    text-align: center;
    padding: 40px 20px;
}

.empty-icon {
    width: 80px;
    height: 80px;
    background: #f5f5f7;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 32px;
    color: #c7c7cc;
}

.empty-text {
    font-size: 16px;
    font-weight: 600;
    color: #8e8e93;
    margin-bottom: 8px;
}

.empty-desc {
    font-size: 14px;
    color: #c7c7cc;
}
</style>

<!-- بطاقة الملف الشخصي -->
<div class="profile-banner">
    <div class="profile-avatar-wrapper">
        <div class="profile-avatar">
            {% if employee.profile_image %}
            <img src="{{ url_for('static', filename=employee.profile_image) }}" alt="{{ employee.name }}" class="profile-img">
            {% else %}
            <i class="fas fa-user"></i>
            {% endif %}
        </div>
    </div>
    <h1 class="profile-name">{{ employee.name }}</h1>
    <p class="profile-job-title">{{ employee.job_title }}</p>
</div>

<!-- نظام التابات -->
<div class="tabs-container">
    <div class="tabs-wrapper">
        <button class="tab-button active" onclick="switchTab('info')">
            <i class="fas fa-info-circle"></i> المعلومات
        </button>
        <button class="tab-button" onclick="switchTab('attendance')">
            <i class="fas fa-calendar-check"></i> الحضور
        </button>
        <button class="tab-button" onclick="switchTab('salary')">
            <i class="fas fa-money-bill-wave"></i> الراتب
        </button>
        <button class="tab-button" onclick="switchTab('vehicles')">
            <i class="fas fa-car"></i> السيارات
        </button>
        <button class="tab-button" onclick="switchTab('documents')">
            <i class="fas fa-file-alt"></i> الوثائق
        </button>
    </div>
</div>

<!-- تاب المعلومات -->
<div id="info-tab" class="tab-content active">
    <div class="info-cards-wrapper">
        <!-- بطاقة التصدير -->
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon info">
                    <i class="fas fa-download"></i>
                </div>
                <h2 class="card-title">تصدير البيانات</h2>
            </div>
            <div class="card-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <a href="{{ url_for('employees.basic_report', id=employee.id) }}" style="background: linear-gradient(135deg, #FF3B30 0%, #dc2626 100%); color: white; padding: 14px; border-radius: 12px; text-decoration: none; text-align: center; font-weight: 600; font-size: 14px; box-shadow: 0 2px 8px rgba(255, 59, 48, 0.2); display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-file-pdf"></i>
                        <span>تصدير PDF</span>
                    </a>
                    <a href="{{ url_for('employees.comprehensive_report_excel', id=employee.id) }}" style="background: linear-gradient(135deg, #34C759 0%, #28a745 100%); color: white; padding: 14px; border-radius: 12px; text-decoration: none; text-align: center; font-weight: 600; font-size: 14px; box-shadow: 0 2px 8px rgba(52, 199, 89, 0.2); display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <i class="fas fa-file-excel"></i>
                        <span>تصدير Excel</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- بطاقة المعلومات الأساسية -->
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon primary">
                    <i class="fas fa-id-card"></i>
                </div>
                <h2 class="card-title">المعلومات الأساسية</h2>
            </div>
            <div class="card-content">
                <div class="info-item">
                    <div class="info-label">الرقم الوظيفي</div>
                    <div class="info-value">{{ employee.employee_id }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">القسم</div>
                    <div class="info-value">{{ employee.department.name if employee.department else 'غير محدد' }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">المسمى الوظيفي</div>
                    <div class="info-value">{{ employee.job_title }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">تاريخ التعيين</div>
                    <div class="info-value">
                        {% if employee.hire_date %}
                        {{ employee.hire_date.strftime('%Y-%m-%d') }}
                        {% else %}
                        <span style="color: #c7c7cc;">غير متوفر</span>
                        {% endif %}
                    </div>
                </div>
                <div class="info-item">
                    <div class="info-label">الحالة</div>
                    <div class="info-value">
                        {% if employee.active %}
                        <span class="status-badge active">نشط</span>
                        {% else %}
                        <span class="status-badge inactive">غير نشط</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- بطاقة معلومات الاتصال -->
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon success">
                    <i class="fas fa-phone"></i>
                </div>
                <h2 class="card-title">معلومات الاتصال</h2>
            </div>
            <div class="card-content">
                <div class="info-item">
                    <div class="info-label">رقم الجوال</div>
                    <div class="info-value">
                        {% if employee.mobile %}
                        <a href="tel:{{ employee.mobile }}">
                            <i class="fas fa-phone"></i> {{ employee.mobile }}
                        </a>
                        {% else %}
                        <span style="color: #c7c7cc;">غير متوفر</span>
                        {% endif %}
                    </div>
                </div>
                {% if employee.mobilePersonal %}
                <div class="info-item">
                    <div class="info-label">الجوال الشخصي</div>
                    <div class="info-value">
                        <a href="tel:{{ employee.mobilePersonal }}">
                            <i class="fas fa-mobile-alt"></i> {{ employee.mobilePersonal }}
                        </a>
                    </div>
                </div>
                {% endif %}
                <div class="info-item">
                    <div class="info-label">البريد الإلكتروني</div>
                    <div class="info-value">
                        {% if employee.email %}
                        <a href="mailto:{{ employee.email }}">{{ employee.email }}</a>
                        {% else %}
                        <span style="color: #c7c7cc;">غير متوفر</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- بطاقة معلومات السكن -->
        {% if employee.residence_details or employee.residence_location_url or employee.housing_images %}
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon warning">
                    <i class="fas fa-home"></i>
                </div>
                <h2 class="card-title">معلومات السكن</h2>
            </div>
            <div class="card-content">
                {% if employee.residence_details %}
                <div class="info-item">
                    <div class="info-label">العنوان</div>
                    <div class="info-value">{{ employee.residence_details }}</div>
                </div>
                {% endif %}
                {% if employee.residence_location_url %}
                <div class="info-item" style="display: block;">
                    <div class="info-label" style="margin-bottom: 8px;">الموقع</div>
                    <a href="{{ employee.residence_location_url }}" target="_blank" style="color: #4A90E2; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; background: rgba(74, 144, 226, 0.1); border-radius: 12px; font-weight: 600; transition: all 0.3s ease;">
                        <i class="fas fa-map-marker-alt" style="font-size: 18px;"></i>
                        <span>فتح الموقع على خرائط جوجل</span>
                        <i class="fas fa-external-link-alt" style="font-size: 12px; opacity: 0.7;"></i>
                    </a>
                </div>
                {% endif %}
                {% if employee.housing_images %}
                <div class="info-item" style="display: block;">
                    <div class="info-label" style="margin-bottom: 12px;">صور السكن</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                        {% set housing_images_list = employee.housing_images.split(',') %}
                        {% for image in housing_images_list %}
                        {% if image.strip() %}
                        {% set image_path = '/' + image.strip() %}
                        <div style="position: relative; border-radius: 12px; overflow: hidden; aspect-ratio: 1; cursor: pointer; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);" onclick="openImageModal('{{ image_path }}')">
                            <img src="{{ image_path }}" 
                                 alt="صورة السكن" 
                                 style="width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s ease;">
                            <div style="position: absolute; top: 8px; right: 8px; background: rgba(0, 0, 0, 0.6); color: white; padding: 4px 8px; border-radius: 8px; font-size: 11px;">
                                <i class="fas fa-expand"></i>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- بطاقة المعلومات الشخصية -->
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon warning">
                    <i class="fas fa-user-circle"></i>
                </div>
                <h2 class="card-title">المعلومات الشخصية</h2>
            </div>
            <div class="card-content">
                <div class="info-item">
                    <div class="info-label">الجنسية</div>
                    <div class="info-value">{{ employee.nationality or 'غير محدد' }}</div>
                </div>
                <div class="info-item">
                    <div class="info-label">رقم الهوية</div>
                    <div class="info-value">{{ employee.national_id or 'غير متوفر' }}</div>
                </div>
                {% if employee.passport_number %}
                <div class="info-item">
                    <div class="info-label">رقم الجواز</div>
                    <div class="info-value">{{ employee.passport_number }}</div>
                </div>
                {% endif %}
                {% if employee.date_of_birth %}
                <div class="info-item">
                    <div class="info-label">تاريخ الميلاد</div>
                    <div class="info-value">{{ employee.date_of_birth.strftime('%Y-%m-%d') }}</div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- بطاقة الصور (الهوية + رخصة القيادة) -->
        {% if employee.national_id_image or employee.license_image %}
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon warning">
                    <i class="fas fa-images"></i>
                </div>
                <h2 class="card-title">المستندات المصورة</h2>
            </div>
            <div class="card-content" style="padding: 0;">
                <div style="display: flex; gap: 12px; overflow-x: auto; -webkit-overflow-scrolling: touch; padding: 16px;">
                    {% if employee.national_id_image %}
                    <div style="flex: 0 0 280px; max-width: 280px;">
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 12px; margin-bottom: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <i class="fas fa-id-card" style="color: #4A90E2; font-size: 16px;"></i>
                                <span style="font-size: 13px; font-weight: 600; color: #2d3748;">الهوية الوطنية</span>
                            </div>
                            <img src="{{ url_for('static', filename=employee.national_id_image) }}" 
                                 alt="الهوية الوطنية" 
                                 style="width: 100%; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);"
                                 onclick="openImageModal(this.src)">
                        </div>
                    </div>
                    {% endif %}
                    {% if employee.license_image %}
                    <div style="flex: 0 0 280px; max-width: 280px;">
                        <div style="background: #f8f9fa; border-radius: 12px; padding: 12px; margin-bottom: 8px;">
                            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                <i class="fas fa-car" style="color: #34C759; font-size: 16px;"></i>
                                <span style="font-size: 13px; font-weight: 600; color: #2d3748;">رخصة القيادة</span>
                            </div>
                            <img src="{{ url_for('static', filename=employee.license_image) }}" 
                                 alt="رخصة القيادة" 
                                 style="width: 100%; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);"
                                 onclick="openImageModal(this.src)">
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- تاب الحضور -->
<div id="attendance-tab" class="tab-content">
    <div class="info-cards-wrapper">
        {% if attendance_records %}
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon success">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <h2 class="card-title">سجلات الحضور</h2>
            </div>
            <div class="card-content" style="padding: 0;">
                {% for record in attendance_records %}
                <div style="padding: 16px; border-bottom: 1px solid #f0f0f5;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="font-size: 15px; font-weight: 600; color: #1a1a1a;">
                            <i class="fas fa-calendar" style="color: #4A90E2; margin-left: 6px;"></i>
                            {{ record.date.strftime('%Y-%m-%d') }}
                        </div>
                        <span class="status-badge active">
                            <i class="fas fa-check-circle"></i> حاضر
                        </span>
                    </div>
                    {% if record.notes %}
                    <div style="font-size: 13px; color: #718096; padding: 8px; background: #f7fafc; border-radius: 8px; margin-top: 8px;">
                        <i class="fas fa-comment" style="margin-left: 6px;"></i>
                        {{ record.notes }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-calendar-times"></i>
            </div>
            <div class="empty-text">لا توجد سجلات حضور</div>
            <div class="empty-desc">لم يتم تسجيل أي حضور بعد</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- تاب الراتب -->
<div id="salary-tab" class="tab-content">
    <div class="info-cards-wrapper">
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon warning">
                    <i class="fas fa-money-bill-wave"></i>
                </div>
                <h2 class="card-title">معلومات الراتب</h2>
            </div>
            <div class="card-content">
                <div class="info-item">
                    <div class="info-label">الأجر اليومي</div>
                    <div class="info-value">{{ "%.2f"|format(employee.basic_salary) }} ريال</div>
                </div>
                {% if salary %}
                <div class="info-item">
                    <div class="info-label">أيام الحضور</div>
                    <div class="info-value">{{ salary.present_days }} يوم</div>
                </div>
                <div class="info-item">
                    <div class="info-label">الراتب الصافي</div>
                    <div class="info-value" style="color: #34C759; font-size: 16px;">{{ "%.2f"|format(salary.net_salary) }} ريال</div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- تاب السيارات -->
<div id="vehicles-tab" class="tab-content">
    <div class="info-cards-wrapper">
        <!-- السيارة النشطة الحالية -->
        {% if current_vehicle %}
        <div class="vehicle-card">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 4px;">
                <div style="font-size: 12px; opacity: 0.8; text-transform: uppercase;">سيارة نشطة في المشروع</div>
                <span style="background: rgba(52, 199, 89, 0.3); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                    <i class="fas fa-check-circle"></i> نشط
                </span>
            </div>
            <div class="vehicle-header">
                <div class="vehicle-icon">
                    <i class="fas fa-car"></i>
                </div>
                <div class="vehicle-info">
                    <div class="vehicle-name">{{ current_vehicle.vehicle.make }} {{ current_vehicle.vehicle.model }}</div>
                    <div class="vehicle-plate">
                        <i class="fas fa-hashtag" style="font-size: 11px;"></i>
                        {{ current_vehicle.vehicle.plate_number }}
                    </div>
                </div>
            </div>
            <div class="vehicle-details">
                <div class="vehicle-detail-item">
                    <div class="vehicle-detail-label">الدور</div>
                    <div class="vehicle-detail-value">
                        {% if current_vehicle.employee_id == employee.id %}
                        <i class="fas fa-user"></i> سائق
                        {% else %}
                        <i class="fas fa-user-tie"></i> مشرف
                        {% endif %}
                    </div>
                </div>
                <div class="vehicle-detail-item">
                    <div class="vehicle-detail-label">تاريخ التسليم</div>
                    <div class="vehicle-detail-value">
                        <i class="fas fa-calendar"></i>
                        {{ current_vehicle.handover_date.strftime('%Y-%m-%d') if current_vehicle.handover_date else 'غير محدد' }}
                    </div>
                </div>
                {% if current_vehicle.vehicle.year %}
                <div class="vehicle-detail-item">
                    <div class="vehicle-detail-label">سنة الصنع</div>
                    <div class="vehicle-detail-value">
                        <i class="fas fa-calendar-alt"></i>
                        {{ current_vehicle.vehicle.year }}
                    </div>
                </div>
                {% endif %}
                {% if current_vehicle.project %}
                <div class="vehicle-detail-item">
                    <div class="vehicle-detail-label">المشروع</div>
                    <div class="vehicle-detail-value">
                        <i class="fas fa-project-diagram"></i>
                        {{ current_vehicle.project }}
                    </div>
                </div>
                {% endif %}
            </div>
            {% if current_vehicle.notes %}
            <div style="margin-top: 12px; padding: 10px; background: rgba(255, 255, 255, 0.15); border-radius: 10px; font-size: 13px;">
                <i class="fas fa-sticky-note" style="margin-left: 6px;"></i>
                {{ current_vehicle.notes }}
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- التاريخ الكامل للسيارات -->
        {% if all_vehicle_handovers %}
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon purple">
                    <i class="fas fa-history"></i>
                </div>
                <h2 class="card-title">التاريخ الكامل</h2>
            </div>
            <div class="card-content" style="padding: 12px;">
                {% for handover in all_vehicle_handovers %}
                <div class="history-card">
                    <div class="history-header">
                        <div class="history-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="history-info">
                            <div class="history-vehicle">{{ handover.vehicle.make }} {{ handover.vehicle.model }}</div>
                            <div class="history-plate">
                                <i class="fas fa-hashtag" style="font-size: 11px;"></i>
                                {{ handover.vehicle.plate_number }}
                            </div>
                        </div>
                        <span class="history-badge {{ 'delivery' if handover.handover_type == 'delivery' else 'receipt' }}">
                            {% if handover.handover_type == 'delivery' %}
                            <i class="fas fa-arrow-down"></i> تسليم
                            {% else %}
                            <i class="fas fa-arrow-up"></i> إرجاع
                            {% endif %}
                        </span>
                    </div>
                    <div class="history-details">
                        <div class="history-detail-item">
                            <div class="history-detail-label">الدور</div>
                            <div class="history-detail-value">
                                {% if handover.employee_id == employee.id %}
                                <i class="fas fa-user" style="color: #4A90E2;"></i> سائق
                                {% else %}
                                <i class="fas fa-user-tie" style="color: #34C759;"></i> مشرف
                                {% endif %}
                            </div>
                        </div>
                        <div class="history-detail-item">
                            <div class="history-detail-label">التاريخ</div>
                            <div class="history-detail-value">
                                <i class="fas fa-calendar" style="color: #667eea;"></i>
                                {{ handover.handover_date.strftime('%Y-%m-%d') if handover.handover_date else 'غير محدد' }}
                            </div>
                        </div>
                        {% if handover.vehicle.status %}
                        <div class="history-detail-item">
                            <div class="history-detail-label">حالة السيارة</div>
                            <div class="history-detail-value">
                                {% if handover.vehicle.status == 'نشط' %}
                                <i class="fas fa-check-circle" style="color: #34C759;"></i>
                                {% elif handover.vehicle.status == 'ورشة' %}
                                <i class="fas fa-tools" style="color: #FF9500;"></i>
                                {% else %}
                                <i class="fas fa-circle" style="color: #718096;"></i>
                                {% endif %}
                                {{ handover.vehicle.status }}
                            </div>
                        </div>
                        {% endif %}
                        {% if handover.project %}
                        <div class="history-detail-item">
                            <div class="history-detail-label">المشروع</div>
                            <div class="history-detail-value">
                                <i class="fas fa-project-diagram" style="color: #667eea;"></i>
                                {{ handover.project }}
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    {% if handover.notes %}
                    <div style="margin-top: 12px; padding: 8px; background: #fef3c7; border-radius: 8px; font-size: 12px; color: #92400e;">
                        <i class="fas fa-sticky-note" style="margin-left: 6px;"></i>
                        {{ handover.notes }}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% elif not current_vehicle %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-car"></i>
            </div>
            <div class="empty-text">لا توجد سيارات مرتبطة</div>
            <div class="empty-desc">لم يتم تسليم أي سيارة لهذا الموظف</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- تاب الوثائق -->
<div id="documents-tab" class="tab-content">
    <div class="info-cards-wrapper">
        {% if documents %}
        <div class="info-card">
            <div class="card-header">
                <div class="card-icon danger">
                    <i class="fas fa-file-alt"></i>
                </div>
                <h2 class="card-title">الوثائق</h2>
            </div>
            <div class="card-content" style="padding: 0;">
                {% for doc in documents %}
                <div style="padding: 16px; border-bottom: 1px solid #f0f0f5;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                        <div style="font-size: 15px; font-weight: 600; color: #1a1a1a;">
                            <i class="fas fa-file-alt" style="color: #FF3B30; margin-left: 6px;"></i>
                            {{ doc.document_type }}
                        </div>
                        {% if doc.expiry_date %}
                        <span style="font-size: 12px; color: #718096;">
                            <i class="fas fa-calendar-times" style="margin-left: 4px;"></i>
                            {{ doc.expiry_date.strftime('%Y-%m-%d') }}
                        </span>
                        {% endif %}
                    </div>
                    {% if doc.document_number %}
                    <div style="font-size: 13px; color: #718096; margin-bottom: 4px;">
                        <i class="fas fa-hashtag" style="font-size: 11px;"></i>
                        {{ doc.document_number }}
                    </div>
                    {% endif %}
                    {% if doc.file_path %}
                    <a href="{{ url_for('static', filename=doc.file_path) }}" 
                       target="_blank"
                       style="display: inline-flex; align-items: center; gap: 6px; margin-top: 8px; padding: 8px 12px; background: #f7fafc; border-radius: 8px; color: #4A90E2; text-decoration: none; font-size: 13px; font-weight: 600;">
                        <i class="fas fa-download"></i>
                        تحميل الوثيقة
                    </a>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="empty-text">لا توجد وثائق</div>
            <div class="empty-desc">لم يتم رفع أي وثائق بعد</div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Modal الصورة -->
<div id="imageModal" class="image-modal" onclick="closeImageModal()">
    <span class="modal-close">&times;</span>
    <img id="modalImage" class="modal-image" src="" alt="صورة مكبرة">
</div>

<!-- قائمة الإجراءات -->
<div class="action-menu-overlay" id="actionMenuOverlay" onclick="toggleActionMenu()"></div>
<div class="action-menu" id="actionMenu">
    <div class="action-menu-handle"></div>
    
    <a href="{{ url_for('mobile.edit_employee', employee_id=employee.id) }}" class="action-menu-item">
        <div class="action-menu-icon edit">
            <i class="fas fa-edit"></i>
        </div>
        <div class="action-menu-text">
            <span class="action-menu-label">تعديل الموظف</span>
            <span class="action-menu-desc">تحديث البيانات الشخصية</span>
        </div>
    </a>

    <a href="#" class="action-menu-item" onclick="shareEmployee(); return false;">
        <div class="action-menu-icon share">
            <i class="fas fa-share-alt"></i>
        </div>
        <div class="action-menu-text">
            <span class="action-menu-label">مشاركة</span>
            <span class="action-menu-desc">مشاركة بيانات الموظف</span>
        </div>
    </a>

    <a href="{{ url_for('employees.basic_report', id=employee.id) }}" class="action-menu-item">
        <div class="action-menu-icon pdf">
            <i class="fas fa-file-pdf"></i>
        </div>
        <div class="action-menu-text">
            <span class="action-menu-label">تصدير PDF</span>
            <span class="action-menu-desc">تنزيل تقرير PDF</span>
        </div>
    </a>

    <a href="{{ url_for('employees.comprehensive_report_excel', id=employee.id) }}" class="action-menu-item">
        <div class="action-menu-icon excel">
            <i class="fas fa-file-excel"></i>
        </div>
        <div class="action-menu-text">
            <span class="action-menu-label">تصدير Excel</span>
            <span class="action-menu-desc">تنزيل تقرير Excel</span>
        </div>
    </a>

    <a href="{{ url_for('mobile.employees') }}" class="action-menu-item">
        <div class="action-menu-icon back">
            <i class="fas fa-arrow-right"></i>
        </div>
        <div class="action-menu-text">
            <span class="action-menu-label">العودة</span>
            <span class="action-menu-desc">العودة لقائمة الموظفين</span>
        </div>
    </a>
</div>

<script>
// نظام التابات
function switchTab(tabName) {
    // إخفاء جميع التابات
    const allTabs = document.querySelectorAll('.tab-content');
    allTabs.forEach(tab => tab.classList.remove('active'));
    
    // إزالة التفعيل من جميع الأزرار
    const allButtons = document.querySelectorAll('.tab-button');
    allButtons.forEach(btn => btn.classList.remove('active'));
    
    // تفعيل التاب المطلوب
    const targetTab = document.getElementById(tabName + '-tab');
    if (targetTab) {
        targetTab.classList.add('active');
    }
    
    // تفعيل الزر المطلوب
    event.target.classList.add('active');
}

// قائمة الإجراءات
function toggleActionMenu() {
    const menu = document.getElementById('actionMenu');
    const overlay = document.getElementById('actionMenuOverlay');
    menu.classList.toggle('active');
    overlay.classList.toggle('active');
}

// Modal الصورة
function openImageModal(src) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    modal.style.display = 'block';
    modalImg.src = src;
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.style.display = 'none';
}

// مشاركة بيانات الموظف
async function shareEmployee() {
    const shareData = {
        title: 'بيانات الموظف - {{ employee.name }}',
        text: 'الاسم: {{ employee.name }}\nالمسمى الوظيفي: {{ employee.job_title }}\nالقسم: {{ employee.department.name if employee.department else "غير محدد" }}',
        url: window.location.href
    };

    try {
        if (navigator.share) {
            await navigator.share(shareData);
        } else {
            // Fallback: نسخ إلى الحافظة
            await navigator.clipboard.writeText(shareData.text + '\n' + shareData.url);
            alert('تم نسخ البيانات');
        }
    } catch (err) {
        console.error('خطأ في المشاركة:', err);
    }
}
</script>
