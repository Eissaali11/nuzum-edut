<style>
/* البطاقة الرئيسية */
.document-hero {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 0 0 32px 32px;
    padding: 40px 20px;
    margin: -20px -20px 24px -20px;
    text-align: center;
    position: relative;
    overflow: hidden;
}

.document-hero::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    animation: pulse 3s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 0.5; }
    50% { transform: scale(1.1); opacity: 0.3; }
}

.document-icon-wrapper {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto 20px;
}

.document-icon-circle {
    width: 100%;
    height: 100%;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    border: 3px solid rgba(255, 255, 255, 0.3);
}

.document-icon-circle i {
    font-size: 48px;
    color: white;
    z-index: 2;
}

.status-ring {
    position: absolute;
    top: -5px;
    right: -5px;
    width: 130px;
    height: 130px;
    border-radius: 50%;
}

.status-ring svg {
    transform: rotate(-90deg);
}

.status-circle-bg {
    fill: none;
    stroke: rgba(255, 255, 255, 0.2);
    stroke-width: 4;
}

.status-circle-progress {
    fill: none;
    stroke-width: 4;
    stroke-linecap: round;
    transition: stroke-dashoffset 1s ease;
}

.status-circle-progress.valid {
    stroke: #34C759;
}

.status-circle-progress.warning {
    stroke: #FF9500;
}

.status-circle-progress.expired {
    stroke: #FF3B30;
}

.document-title {
    font-size: 24px;
    font-weight: 700;
    color: white;
    margin-bottom: 8px;
    position: relative;
    z-index: 1;
}

.document-subtitle {
    font-size: 15px;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 16px;
    position: relative;
    z-index: 1;
}

.status-badge-large {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    position: relative;
    z-index: 1;
}

.status-badge-large.valid {
    background: rgba(52, 199, 89, 0.3);
    color: white;
    border: 2px solid rgba(52, 199, 89, 0.5);
}

.status-badge-large.warning {
    background: rgba(255, 149, 0, 0.3);
    color: white;
    border: 2px solid rgba(255, 149, 0, 0.5);
}

.status-badge-large.expired {
    background: rgba(255, 59, 48, 0.3);
    color: white;
    border: 2px solid rgba(255, 59, 48, 0.5);
}

/* البطاقات */
.info-cards-wrapper {
    padding: 0 20px 80px;
}

.info-card {
    background: white;
    border-radius: 20px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
    margin-bottom: 20px;
    overflow: hidden;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.card-header {
    padding: 20px;
    background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
    border-bottom: 1px solid #f0f0f5;
    display: flex;
    align-items: center;
    gap: 12px;
}

.card-icon {
    width: 44px;
    height: 44px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.card-icon.primary {
    background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(74, 144, 226, 0.3);
}

.card-icon.success {
    background: linear-gradient(135deg, #34C759 0%, #28a745 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
}

.card-icon.warning {
    background: linear-gradient(135deg, #FF9500 0%, #FF6B00 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 149, 0, 0.3);
}

.card-icon.danger {
    background: linear-gradient(135deg, #FF3B30 0%, #dc2626 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(255, 59, 48, 0.3);
}

.card-icon.purple {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.card-title {
    font-size: 18px;
    font-weight: 700;
    color: #1a1a1a;
    margin: 0;
    flex: 1;
}

.card-content {
    padding: 20px;
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 0;
    border-bottom: 1px solid #f0f0f5;
}

.info-row:last-child {
    border-bottom: none;
}

.info-label {
    font-size: 14px;
    color: #8e8e93;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
}

.info-label i {
    width: 20px;
    text-align: center;
}

.info-value {
    font-size: 15px;
    color: #1a1a1a;
    font-weight: 600;
    text-align: left;
}

.info-value.primary {
    color: #4A90E2;
}

.info-value.success {
    color: #34C759;
}

.info-value.warning {
    color: #FF9500;
}

.info-value.danger {
    color: #FF3B30;
}

/* بطاقة الموظف */
.employee-card {
    background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 20px;
    color: white;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: 0 4px 16px rgba(74, 144, 226, 0.3);
}

.employee-avatar {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    border: 3px solid rgba(255, 255, 255, 0.3);
}

.employee-info {
    flex: 1;
}

.employee-name {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 4px;
}

.employee-id {
    font-size: 13px;
    opacity: 0.9;
}

.employee-link {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
}

/* معاينة الوثيقة */
.document-preview-card {
    background: #f8f9fa;
    border-radius: 16px;
    padding: 20px;
    text-align: center;
}

.preview-placeholder {
    width: 100%;
    aspect-ratio: 1.4;
    background: white;
    border-radius: 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border: 2px dashed #d1d5db;
    margin-bottom: 16px;
}

.preview-placeholder i {
    font-size: 48px;
    color: #c7c7cc;
    margin-bottom: 12px;
}

.preview-placeholder p {
    color: #8e8e93;
    font-size: 14px;
    margin: 0;
}

.document-image {
    width: 100%;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    cursor: pointer;
    transition: transform 0.3s ease;
}

.document-image:hover {
    transform: scale(1.02);
}

/* أزرار الإجراءات */
.action-buttons-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 20px;
}

.action-btn {
    padding: 16px;
    border-radius: 16px;
    border: none;
    font-size: 15px;
    font-weight: 600;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.action-btn i {
    font-size: 24px;
}

.action-btn.primary {
    background: linear-gradient(135deg, #4A90E2 0%, #357ABD 100%);
    color: white;
}

.action-btn.success {
    background: linear-gradient(135deg, #34C759 0%, #28a745 100%);
    color: white;
}

.action-btn.danger {
    background: linear-gradient(135deg, #FF3B30 0%, #dc2626 100%);
    color: white;
}

.action-btn.secondary {
    background: #f5f5f7;
    color: #1a1a1a;
}

.action-btn:active {
    transform: scale(0.95);
}

/* المودال */
.image-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
}

.modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 24px;
    cursor: pointer;
    z-index: 10001;
    backdrop-filter: blur(10px);
}

.modal-image {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    max-width: 90%;
    max-height: 90%;
    border-radius: 8px;
}

/* Modal التحديث */
.update-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    animation: fadeIn 0.3s ease;
}

.update-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.update-modal-content {
    background: white;
    border-radius: 20px;
    width: 90%;
    max-width: 400px;
    max-height: 80vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from {
        transform: translateY(50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.update-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border-bottom: 1px solid #f0f0f5;
}

.modal-close-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #f5f5f7;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.modal-close-btn:active {
    transform: scale(0.9);
    background: #e5e5e7;
}

.update-form {
    padding: 20px;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    font-size: 14px;
    font-weight: 600;
    color: #1a1a1a;
    margin-bottom: 8px;
}

.form-input {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #f0f0f5;
    border-radius: 12px;
    font-size: 15px;
    transition: all 0.2s ease;
    box-sizing: border-box;
}

.form-input:focus {
    outline: none;
    border-color: #4A90E2;
    background: #f8f9fa;
}

.form-textarea {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid #f0f0f5;
    border-radius: 12px;
    font-size: 15px;
    font-family: inherit;
    resize: vertical;
    transition: all 0.2s ease;
    box-sizing: border-box;
}

.form-textarea:focus {
    outline: none;
    border-color: #4A90E2;
    background: #f8f9fa;
}

.form-actions {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 24px;
}

.btn-cancel {
    padding: 14px;
    border-radius: 12px;
    border: 2px solid #f0f0f5;
    background: white;
    color: #1a1a1a;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-cancel:active {
    transform: scale(0.95);
    background: #f5f5f7;
}

.btn-submit {
    padding: 14px;
    border-radius: 12px;
    border: none;
    background: linear-gradient(135deg, #34C759 0%, #28a745 100%);
    color: white;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 12px rgba(52, 199, 89, 0.3);
}

.btn-submit:active {
    transform: scale(0.95);
}
</style>

<!-- البطاقة الرئيسية -->
<div class="document-hero">
    <div class="document-icon-wrapper">
        {% set status_class = 'valid' %}
        {% set progress_percent = 100 %}
        {% if document.expiry_date %}
            {% if document.expiry_date < current_date %}
                {% set status_class = 'expired' %}
                {% set progress_percent = 0 %}
            {% elif days_remaining <= 30 %}
                {% set status_class = 'warning' %}
                {% set progress_percent = (days_remaining / 30 * 100)|int %}
            {% endif %}
        {% endif %}
        
        <div class="status-ring">
            <svg width="130" height="130">
                <circle class="status-circle-bg" cx="65" cy="65" r="60"></circle>
                <circle class="status-circle-progress {{ status_class }}" 
                        cx="65" cy="65" r="60"
                        stroke-dasharray="377"
                        stroke-dashoffset="{{ 377 - (377 * progress_percent / 100) }}"></circle>
            </svg>
        </div>
        
        <div class="document-icon-circle">
            {% if document.document_type == 'هوية وطنية' %}
            <i class="fas fa-id-card"></i>
            {% elif document.document_type == 'جواز سفر' %}
            <i class="fas fa-passport"></i>
            {% elif document.document_type == 'رخصة قيادة' %}
            <i class="fas fa-car"></i>
            {% elif document.document_type == 'إقامة' %}
            <i class="fas fa-home"></i>
            {% elif document.document_type == 'شهادة صحية' %}
            <i class="fas fa-heartbeat"></i>
            {% elif document.document_type == 'شهادة تأمين' %}
            <i class="fas fa-shield-alt"></i>
            {% else %}
            <i class="fas fa-file-alt"></i>
            {% endif %}
        </div>
    </div>
    
    <h1 class="document-title">{{ document.document_type }}</h1>
    <p class="document-subtitle">{{ document.document_number }}</p>
    
    {% if document.expiry_date %}
        {% if document.expiry_date < current_date %}
        <span class="status-badge-large expired">
            <i class="fas fa-times-circle"></i> منتهية الصلاحية
        </span>
        {% elif days_remaining <= 30 %}
        <span class="status-badge-large warning">
            <i class="fas fa-exclamation-triangle"></i> تنتهي قريباً
        </span>
        {% else %}
        <span class="status-badge-large valid">
            <i class="fas fa-check-circle"></i> سارية المفعول
        </span>
        {% endif %}
    {% endif %}
</div>

<div class="info-cards-wrapper">
    <!-- بطاقة الموظف -->
    <a href="{{ url_for('mobile.employee_details', employee_id=document.employee.id) }}" class="employee-card" style="text-decoration: none;">
        <div class="employee-avatar">
            <i class="fas fa-user"></i>
        </div>
        <div class="employee-info">
            <div class="employee-name">{{ document.employee.name }}</div>
            <div class="employee-id">رقم الموظف: {{ document.employee.employee_id }}</div>
        </div>
        <div class="employee-link">
            <i class="fas fa-arrow-left"></i>
        </div>
    </a>

    <!-- معلومات الوثيقة -->
    <div class="info-card">
        <div class="card-header">
            <div class="card-icon primary">
                <i class="fas fa-info-circle"></i>
            </div>
            <h2 class="card-title">معلومات الوثيقة</h2>
        </div>
        <div class="card-content">
            <div class="info-row">
                <div class="info-label">
                    <i class="fas fa-hashtag"></i> رقم الوثيقة
                </div>
                <div class="info-value">{{ document.document_number }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">
                    <i class="fas fa-file-alt"></i> نوع الوثيقة
                </div>
                <div class="info-value">{{ document.document_type }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">
                    <i class="fas fa-calendar-plus"></i> تاريخ الإصدار
                </div>
                <div class="info-value">{{ document.issue_date.strftime('%Y-%m-%d') if document.issue_date else 'غير محدد' }}</div>
            </div>
            
            <div class="info-row">
                <div class="info-label">
                    <i class="fas fa-calendar-times"></i> تاريخ الانتهاء
                </div>
                <div class="info-value {% if document.expiry_date and document.expiry_date < current_date %}danger{% elif document.expiry_date and days_remaining <= 30 %}warning{% else %}success{% endif %}">
                    {{ document.expiry_date.strftime('%Y-%m-%d') if document.expiry_date else 'غير محدد' }}
                </div>
            </div>
            
            {% if document.expiry_date %}
            <div class="info-row">
                <div class="info-label">
                    <i class="fas fa-hourglass-half"></i> المدة المتبقية
                </div>
                <div class="info-value {% if document.expiry_date < current_date %}danger{% elif days_remaining <= 30 %}warning{% else %}success{% endif %}">
                    {% if document.expiry_date < current_date %}
                    انتهت منذ {{ (current_date - document.expiry_date).days }} يوم
                    {% else %}
                    {{ days_remaining }} يوم
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>

    {% if document.notes %}
    <!-- الملاحظات -->
    <div class="info-card">
        <div class="card-header">
            <div class="card-icon warning">
                <i class="fas fa-sticky-note"></i>
            </div>
            <h2 class="card-title">ملاحظات</h2>
        </div>
        <div class="card-content">
            <div style="padding: 12px; background: #fef3c7; border-radius: 12px; color: #92400e; font-size: 14px; line-height: 1.6;">
                <i class="fas fa-info-circle" style="margin-left: 8px;"></i>
                {{ document.notes }}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- معاينة الملف -->
    {% if document.file_path %}
    <div class="info-card">
        <div class="card-header">
            <div class="card-icon purple">
                <i class="fas fa-file-image"></i>
            </div>
            <h2 class="card-title">معاينة الوثيقة</h2>
        </div>
        <div class="card-content">
            <div class="document-preview-card">
                {% if document.file_path.lower().endswith(('.jpg', '.jpeg', '.png', '.gif', '.webp')) %}
                <img src="{{ url_for('static', filename=document.file_path) }}" 
                     alt="{{ document.document_type }}" 
                     class="document-image"
                     onclick="openImageModal(this.src)">
                {% elif document.file_path.lower().endswith('.pdf') %}
                <div class="preview-placeholder">
                    <i class="fas fa-file-pdf"></i>
                    <p>ملف PDF</p>
                </div>
                <a href="{{ url_for('static', filename=document.file_path) }}" 
                   target="_blank"
                   class="action-btn danger"
                   style="width: 100%; margin-top: 12px;">
                    <i class="fas fa-download"></i>
                    <span>فتح الملف</span>
                </a>
                {% else %}
                <div class="preview-placeholder">
                    <i class="fas fa-file"></i>
                    <p>ملف مرفق</p>
                </div>
                <a href="{{ url_for('static', filename=document.file_path) }}" 
                   target="_blank"
                   class="action-btn primary"
                   style="width: 100%; margin-top: 12px;">
                    <i class="fas fa-download"></i>
                    <span>تحميل الملف</span>
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- أزرار الإجراءات -->
    <div class="action-buttons-grid">
        <a href="{{ url_for('mobile.documents') }}" class="action-btn secondary">
            <i class="fas fa-arrow-right"></i>
            <span>العودة</span>
        </a>
        <a href="{{ url_for('mobile.employee_details', employee_id=document.employee.id) }}" class="action-btn primary">
            <i class="fas fa-user"></i>
            <span>الموظف</span>
        </a>
        <button class="action-btn success" onclick="openUpdateExpiryModal()">
            <i class="fas fa-calendar-alt"></i>
            <span>تحديث التاريخ</span>
        </button>
    </div>
</div>

<!-- Modal تحديث تاريخ الانتهاء -->
<div id="updateExpiryModal" class="update-modal">
    <div class="update-modal-content">
        <div class="update-modal-header">
            <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: #1a1a1a;">
                <i class="fas fa-calendar-alt" style="margin-left: 8px; color: #34C759;"></i>
                تحديث تاريخ الانتهاء
            </h3>
            <button class="modal-close-btn" onclick="closeUpdateExpiryModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form method="POST" action="{{ url_for('mobile.update_document_expiry', document_id=document.id) }}" class="update-form">
            <div class="form-group">
                <label for="expiry_date">تاريخ الانتهاء الجديد</label>
                <input type="date" 
                       id="expiry_date" 
                       name="expiry_date" 
                       class="form-input"
                       value="{{ document.expiry_date.strftime('%Y-%m-%d') if document.expiry_date else '' }}"
                       required>
            </div>
            <div class="form-group">
                <label for="notes">ملاحظات (اختياري)</label>
                <textarea id="notes" 
                          name="notes" 
                          class="form-textarea"
                          rows="3"
                          placeholder="أضف ملاحظات حول التحديث..."></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn-cancel" onclick="closeUpdateExpiryModal()">
                    <i class="fas fa-times"></i> إلغاء
                </button>
                <button type="submit" class="btn-submit">
                    <i class="fas fa-check"></i> حفظ التحديث
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Modal الصورة -->
<div id="imageModal" class="image-modal" onclick="closeImageModal()">
    <span class="modal-close">&times;</span>
    <img id="modalImage" class="modal-image" src="" alt="صورة مكبرة">
</div>

<script>
function openImageModal(src) {
    const modal = document.getElementById('imageModal');
    const modalImg = document.getElementById('modalImage');
    modal.style.display = 'block';
    modalImg.src = src;
}

function closeImageModal() {
    const modal = document.getElementById('imageModal');
    modal.style.display = 'none';
}

function openUpdateExpiryModal() {
    const modal = document.getElementById('updateExpiryModal');
    modal.classList.add('active');
}

function closeUpdateExpiryModal() {
    const modal = document.getElementById('updateExpiryModal');
    modal.classList.remove('active');
}

// إغلاق المودال عند النقر خارجه
document.getElementById('updateExpiryModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
        closeUpdateExpiryModal();
    }
});
</script>
