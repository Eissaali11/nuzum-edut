<div class="mobile-section">
  <div class="mobile-section-header">
    <h2 class="mobile-section-title">
      <i class="fas fa-tools"></i>
      تفاصيل الصيانة
    </h2>
    <a href="{{ url_for('mobile.vehicles') }}" class="mobile-btn mobile-btn-secondary">
      <i class="fas fa-arrow-right"></i>
      عودة
    </a>
  </div>
  
  <!-- معلومات أساسية -->
  <div class="mobile-card mb-4">
    <div class="mobile-card-header">
      <div class="mobile-card-title">
        <i class="fas fa-info-circle"></i>
        معلومات الصيانة
      </div>
      <div class="mobile-maintenance-badge {{ maintenance.status_class }}">{{ maintenance.status }}</div>
    </div>
    <div class="mobile-card-body">
      <div class="maintenance-detail-header">
        <h3 class="maintenance-title">{{ maintenance.description }}</h3>
        <div class="maintenance-meta">
          <span class="maintenance-vehicle">
            <i class="fas fa-car"></i>
            {{ vehicle.make }} {{ vehicle.model }} - {{ vehicle.plate_number }}
          </span>
          <span class="maintenance-date">
            <i class="fas fa-calendar-alt"></i>
            {{ maintenance.date.strftime('%d/%m/%Y') }}
          </span>
        </div>
      </div>
      
      <div class="maintenance-info-grid">
        <div class="maintenance-info-item">
          <div class="info-label">نوع الصيانة</div>
          <div class="info-value">{{ maintenance.maintenance_type }}</div>
        </div>
        
        <div class="maintenance-info-item">
          <div class="info-label">اسم الفني</div>
          <div class="info-value">{{ maintenance.technician }}</div>
        </div>
        
        <div class="maintenance-info-item">
          <div class="info-label">التكلفة</div>
          <div class="info-value highlight">{{ "{:,.2f}".format(maintenance.cost) }} ريال</div>
        </div>
        
        <div class="maintenance-info-item">
          <div class="info-label">تاريخ الإضافة</div>
          <div class="info-value">{{ maintenance.created_at.strftime('%d/%m/%Y %H:%M') }}</div>
        </div>
      </div>
      
      {% if maintenance.receipt_image_url %}
      <div class="maintenance-receipt">
        <div class="receipt-title">
          <i class="fas fa-receipt"></i>
          صورة الإيصال
        </div>
        <div class="receipt-image-container">
          <img src="{{ maintenance.receipt_image_url }}" alt="صورة إيصال الصيانة" class="receipt-image" onclick="openImageViewer('{{ maintenance.receipt_image_url }}')">
        </div>
      </div>
      {% endif %}
      
      {% if maintenance.delivery_receipt_url %}
      <div class="maintenance-receipt">
        <div class="receipt-title">
          <i class="fas fa-file-export"></i>
          إيصال تسليم السيارة للورشة
        </div>
        <div class="receipt-image-container">
          <img src="{{ maintenance.delivery_receipt_url }}" alt="إيصال تسليم السيارة للورشة" class="receipt-image" onclick="openImageViewer('{{ maintenance.delivery_receipt_url }}')">
        </div>
      </div>
      {% endif %}
      
      {% if maintenance.pickup_receipt_url %}
      <div class="maintenance-receipt">
        <div class="receipt-title">
          <i class="fas fa-file-import"></i>
          إيصال استلام السيارة من الورشة
        </div>
        <div class="receipt-image-container">
          <img src="{{ maintenance.pickup_receipt_url }}" alt="إيصال استلام السيارة من الورشة" class="receipt-image" onclick="openImageViewer('{{ maintenance.pickup_receipt_url }}')">
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  
  <!-- تفاصيل إضافية -->
  <div class="mobile-card mb-4">
    <div class="mobile-card-header">
      <div class="mobile-card-title">
        <i class="fas fa-clipboard-list"></i>
        تفاصيل إضافية
      </div>
    </div>
    <div class="mobile-card-body">
      {% if maintenance.parts_replaced %}
      <div class="maintenance-detail-section">
        <h4 class="detail-title">
          <i class="fas fa-cogs"></i>
          قطع الغيار المستبدلة
        </h4>
        <div class="detail-content">
          {{ maintenance.parts_replaced|nl2br }}
        </div>
      </div>
      {% endif %}
      
      {% if maintenance.actions_taken %}
      <div class="maintenance-detail-section">
        <h4 class="detail-title">
          <i class="fas fa-tasks"></i>
          الإجراءات المتخذة
        </h4>
        <div class="detail-content">
          {{ maintenance.actions_taken|nl2br }}
        </div>
      </div>
      {% endif %}
      
      {% if maintenance.notes %}
      <div class="maintenance-detail-section">
        <h4 class="detail-title">
          <i class="fas fa-sticky-note"></i>
          ملاحظات
        </h4>
        <div class="detail-content">
          {{ maintenance.notes|nl2br }}
        </div>
      </div>
      {% endif %}
      
      {% if not maintenance.parts_replaced and not maintenance.actions_taken and not maintenance.notes %}
      <div class="mobile-empty-state">
        <div class="mobile-empty-icon">
          <i class="fas fa-clipboard"></i>
        </div>
        <p>لا توجد تفاصيل إضافية لهذه الصيانة.</p>
      </div>
      {% endif %}
    </div>
  </div>
  
  <!-- الصور -->
  {% if maintenance.images %}
  <div class="mobile-card">
    <div class="mobile-card-header">
      <div class="mobile-card-title">
        <i class="fas fa-images"></i>
        صور الصيانة
      </div>
    </div>
    <div class="mobile-card-body">
      <div class="maintenance-images-grid">
        {% for image in maintenance.images %}
        <div class="maintenance-image-item">
          <img src="{{ url_for('static', filename='uploads/' + image.image_path) }}" alt="{{ image.image_type }}" class="maintenance-image" onclick="openImageViewer(this.src)">
          <div class="image-type-label">{{ image.image_type }}</div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}
  
<!-- معلومات تصحيح -->
  <div style="background-color: #f8d7da; color: #721c24; padding: 10px; margin-top: 10px; border-radius: 5px;">
    <p><strong>معلومات تصحيح:</strong></p>
    <p>معرف الصيانة: {{ maintenance.id }}</p>
    <p>نوع الكائن: {{ maintenance.__class__.__name__ }}</p>
  </div>
  
  <!-- أزرار الإجراءات -->
  <div class="mobile-card mb-4">
    <div class="mobile-card-header">
      <div class="mobile-card-title">
        <i class="fas fa-cog"></i>
        الإجراءات
      </div>
    </div>
    <div class="mobile-card-body">
      <div class="mobile-actions-bar">
        <a href="{{ url_for('mobile.edit_maintenance', maintenance_id=maintenance.id) }}" class="mobile-btn mobile-btn-primary">
          <i class="fas fa-edit"></i>
          تعديل الصيانة ({{ maintenance.id }})
        </a>
        
        <button class="mobile-btn mobile-btn-danger" onclick="confirmDelete()">
          <i class="fas fa-trash-alt"></i>
          حذف
        </button>
      </div>
    </div>
  </div>
  
</div>

<!-- نافذة عرض الصور -->
<div id="imageViewer" class="image-viewer">
  <span class="close-viewer" onclick="closeImageViewer()">&times;</span>
  <img id="expandedImage" class="viewer-image" src="">
</div>
