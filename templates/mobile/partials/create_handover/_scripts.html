<script src="{{ url_for('static', filename='js/image-compression.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // تطبيق ضغط الصور على جميع حقول رفع الملفات
    applyImageCompression('input[type="file"]', {
        maxWidth: 1024,        // الحد الأقصى للعرض
        maxHeight: 1024,       // الحد الأقصى للارتفاع
        quality: 0.8,          // جودة الضغط (0-1)
        maxFileSize: 2 * 1024 * 1024, // 2MB - الحد الأقصى لحجم الملف قبل الضغط
        outputFormat: 'image/jpeg'     // صيغة الإخراج
    });
    
    // إضافة تحذير عند رفع ملفات كبيرة
    const fileInputs = document.querySelectorAll('input[type="file"]');
    fileInputs.forEach(input => {
        input.addEventListener('change', function() {
            const files = Array.from(this.files);
            const largeFiles = files.filter(file => file.size > 5 * 1024 * 1024); // أكبر من 5MB
            
            if (largeFiles.length > 0) {
                const message = largeFiles.length === 1 ? 
                    'الملف المحدد كبير الحجم وسيتم ضغطه تلقائياً.' :
                    `${largeFiles.length} ملفات كبيرة الحجم وسيتم ضغطها تلقائياً.`;
                    
                showCompressionNotice(message);
            }
        });
    });
    
    // تحسين تجربة إرسال النموذج
    const form = document.getElementById('handover-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            const submitButton = document.querySelector('.fixed-submit-button');
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="
                            width: 16px;
                            height: 16px;
                            border: 2px solid transparent;
                            border-top: 2px solid white;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                        "></div>
                        جاري الحفظ...
                    </div>
                `;
            }
        });
    }
});

/**
 * عرض إشعار ضغط الصور
 */
function showCompressionNotice(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 20px;
        right: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 16px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        z-index: 10001;
        font-size: 0.9rem;
        text-align: center;
        backdrop-filter: blur(10px);
        animation: slideDown 0.3s ease-out;
    `;
    notification.innerHTML = `
        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
            <i class="fas fa-compress-alt"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideUp 0.3s ease-in';
        setTimeout(() => notification.remove(), 300);
    }, 4000);
}

// إضافة CSS للرسوم المتحركة
const style = document.createElement('style');
style.textContent = `
    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes slideUp {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(-20px);
        }
    }
    
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
`;
document.head.appendChild(style);
</script>
