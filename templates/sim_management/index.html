{% extends "layout.html" %}

{% block title %}إدارة بطاقات SIM{% endblock %}

{% block extra_css %}
{% include 'sim_management/partials/index/_extra_css.html' %}
{% endblock %}

{% block content %}
{% include 'sim_management/partials/index/_content.html' %}
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // تحسين واجهة المستخدم
    $('[data-bs-toggle="tooltip"]').tooltip();
    
    // إضافة تأثيرات للجدول
    $('.table tbody tr').hover(function() {
        $(this).addClass('table-active');
    }, function() {
        $(this).removeClass('table-active');
    });

    // دالة العودة للأعلى
    window.scrollToTop = function() {
        window.scrollTo({
            top: 0,
            behavior: 'smooth'
        });
    }

    // إظهار/إخفاء زر العودة للأعلى
    $(window).scroll(function() {
        if ($(this).scrollTop() > 300) {
            $('.back-to-top').fadeIn();
        } else {
            $('.back-to-top').fadeOut();
        }
    });

    // إخفاء الزر في البداية
    $('.back-to-top').hide();

    // إصلاح مشكلة النوافذ المنبثقة
    $(document).on('click', '[data-bs-toggle="modal"]', function(e) {
        e.preventDefault();
        const targetModal = $($(this).data('bs-target'));
        
        // إزالة أي modal مفتوح
        $('.modal').modal('hide');
        
        // انتظار قصير ثم فتح النافذة الجديدة
        setTimeout(function() {
            targetModal.modal('show');
        }, 150);
    });

    // التأكد من إزالة backdrop عند إغلاق النافذة
    $(document).on('hidden.bs.modal', '.modal', function() {
        $('.modal-backdrop').remove();
        $('body').removeClass('modal-open');
        $('body').css('padding-right', '');
    });

    // إصلاح مشكلة التمرير
    $(document).on('shown.bs.modal', '.modal', function() {
        $('body').addClass('modal-open');
    });
});

// دوال تأكيد الحذف وفك الربط
function confirmDelete(simId, phoneNumber) {
    if (confirm('هل أنت متأكد من حذف رقم SIM: ' + phoneNumber + '؟')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/sim-management/delete/' + simId;
        document.body.appendChild(form);
        form.submit();
    }
}

function confirmUnassign(simId, phoneNumber) {
    if (confirm('هل أنت متأكد من فك ربط رقم SIM: ' + phoneNumber + '؟')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/sim-management/unassign-from-employee/' + simId;
        document.body.appendChild(form);
        form.submit();
    }
}
</script>
{% endblock %}