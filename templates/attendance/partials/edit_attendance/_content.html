<div class="container">
    <div class="edit-card">
        <div class="edit-header">
            <h2><i class="fas fa-edit me-2"></i>تعديل حالة الحضور</h2>
            <p>قم بتحديث حالة الحضور وأوقات الدخول والخروج</p>
        </div>
        
        <!-- معلومات السجل -->
        <div class="info-section">
            <div class="info-item">
                <span class="info-label">
                    <i class="fas fa-user"></i>
                    اسم الموظف
                </span>
                <span class="info-value">{{ attendance.employee.name }}</span>
            </div>
            
            <div class="info-item">
                <span class="info-label">
                    <i class="fas fa-id-card"></i>
                    الرقم الوظيفي
                </span>
                <span class="info-value">{{ attendance.employee.employee_id }}</span>
            </div>
            
            <div class="info-item">
                <span class="info-label">
                    <i class="fas fa-calendar"></i>
                    التاريخ
                </span>
                <span class="info-value">{{ attendance.date.strftime('%Y-%m-%d') }}</span>
            </div>
        </div>
        
        <!-- نموذج التعديل -->
        <form method="POST" action="{{ url_for('attendance.update_attendance_page', id=attendance.id) }}" enctype="multipart/form-data">
            <!-- حالة الحضور -->
            <div class="form-section">
                <h5><i class="fas fa-info-circle"></i>حالة الحضور</h5>
                <div class="status-options">
                    <div class="status-option present">
                        <input type="radio" name="status" value="present" id="status_present" 
                               {% if attendance.status == 'present' %}checked{% endif %}>
                        <label for="status_present">
                            <i class="fas fa-check-circle fa-2x mb-2"></i>
                            <div>حاضر</div>
                        </label>
                    </div>
                    
                    <div class="status-option absent">
                        <input type="radio" name="status" value="absent" id="status_absent" 
                               {% if attendance.status == 'absent' %}checked{% endif %}>
                        <label for="status_absent">
                            <i class="fas fa-times-circle fa-2x mb-2"></i>
                            <div>غائب</div>
                        </label>
                    </div>
                    
                    <div class="status-option leave">
                        <input type="radio" name="status" value="leave" id="status_leave" 
                               {% if attendance.status == 'leave' %}checked{% endif %}>
                        <label for="status_leave">
                            <i class="fas fa-calendar-minus fa-2x mb-2"></i>
                            <div>إجازة</div>
                        </label>
                    </div>
                    
                    <div class="status-option sick">
                        <input type="radio" name="status" value="sick" id="status_sick" 
                               {% if attendance.status == 'sick' %}checked{% endif %}>
                        <label for="status_sick">
                            <i class="fas fa-procedures fa-2x mb-2"></i>
                            <div>مرضي</div>
                        </label>
                    </div>
                </div>
            </div>
            
            <!-- أوقات الدخول والخروج -->
            <div class="form-section" id="timeSection">
                <h5><i class="fas fa-clock"></i>أوقات الدخول والخروج</h5>
                <div class="time-section">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="check_in" class="form-label">
                                <i class="fas fa-sign-in-alt"></i>
                                وقت الدخول
                            </label>
                            <input type="time" class="form-control" id="check_in" name="check_in" 
                                   value="{{ attendance.check_in.strftime('%H:%M') if attendance.check_in else '' }}">
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="check_out" class="form-label">
                                <i class="fas fa-sign-out-alt"></i>
                                وقت الخروج
                            </label>
                            <input type="time" class="form-control" id="check_out" name="check_out" 
                                   value="{{ attendance.check_out.strftime('%H:%M') if attendance.check_out else '' }}">
                        </div>
                    </div>
                    
                    <div class="alert alert-info mb-0" style="border-radius: 10px;">
                        <small>
                            <i class="fas fa-info-circle me-1"></i>
                            أوقات الدخول والخروج متاحة فقط لحالة "حاضر"
                        </small>
                    </div>
                </div>
            </div>
            
            <!-- الملاحظات -->
            <div class="form-section">
                <h5><i class="fas fa-comment-alt"></i>الملاحظات</h5>
                <div class="time-section">
                    <label for="notes" class="form-label">
                        <i class="fas fa-sticky-note"></i>
                        إضافة ملاحظة (اختياري)
                    </label>
                    <textarea class="form-control" id="notes" name="notes" rows="4" 
                              placeholder="اكتب أي ملاحظات إضافية هنا..."
                              style="resize: vertical;">{{ attendance.notes or '' }}</textarea>
                    <small class="text-muted mt-2 d-block">
                        <i class="fas fa-info-circle me-1"></i>
                        يمكنك إضافة ملاحظات توضيحية حول حالة الحضور
                    </small>
                </div>
            </div>
            
            <!-- ملف الإجازة المرضية -->
            <div class="form-section" id="sickLeaveSection" style="display: none;">
                <h5><i class="fas fa-file-medical"></i>ملف الإجازة المرضية</h5>
                <div class="time-section">
                    {% if attendance.sick_leave_file %}
                    <div class="alert alert-success mb-3" style="border-radius: 10px;">
                        <i class="fas fa-check-circle me-2"></i>
                        يوجد ملف مرفق:
                        <a href="{{ url_for('static', filename=attendance.sick_leave_file) }}" 
                           target="_blank" class="text-decoration-underline ms-2">
                            <i class="fas fa-external-link-alt me-1"></i>عرض الملف
                        </a>
                    </div>
                    {% endif %}
                    
                    <label for="sick_leave_file" class="form-label">
                        <i class="fas fa-upload"></i>
                        رفع ملف الإجازة المرضية (PDF أو صورة)
                    </label>
                    <input type="file" class="form-control" id="sick_leave_file" name="sick_leave_file" 
                           accept=".pdf,.jpg,.jpeg,.png,.heic">
                    <small class="text-muted mt-2 d-block">
                        <i class="fas fa-info-circle me-1"></i>
                        يمكنك رفع ملف PDF أو صورة للإجازة المرضية (الصيغ المدعومة: PDF, JPG, PNG, HEIC)
                    </small>
                </div>
            </div>
            
            <!-- أزرار الإجراءات -->
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-save me-3">
                    <i class="fas fa-save me-2"></i>حفظ التغييرات
                </button>
                <a href="{{ url_for('attendance.department_attendance_view', department_id=request.args.get('department_id', ''), start_date=request.args.get('start_date', ''), end_date=request.args.get('end_date', '')) }}" 
                   class="btn btn-cancel">
                    <i class="fas fa-times me-2"></i>إلغاء
                </a>
            </div>
        </form>
    </div>
</div>
