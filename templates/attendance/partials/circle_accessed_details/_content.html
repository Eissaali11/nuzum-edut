<div class="container-fluid py-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh;">
    <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h1 class="h2 mb-2" style="color: white; font-weight: 700;">
                        <i class="fas fa-map-marked-alt me-3"></i>
                        ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ÙˆØ§ØµÙ„ÙŠÙ† Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©
                    </h1>
                    <p style="color: rgba(255,255,255,0.8);">
                        <i class="fas fa-map-pin me-2"></i>
                        Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©: <strong>{{ circle_name }}</strong>
                    </p>
                    <p style="color: rgba(255,255,255,0.8);">
                        <i class="fas fa-building me-2"></i>
                        Ø§Ù„Ù‚Ø³Ù…: <strong>{{ department_name }}</strong>
                    </p>
                    <p style="color: rgba(255,255,255,0.8);">
                        <i class="fas fa-calendar me-2"></i>
                        Ø§Ù„ØªØ§Ø±ÙŠØ®: <strong>{{ selected_date_formatted }}</strong> | <strong style="color: #fbbf24;">{{ selected_date.strftime('%d/%m/%Y') }}</strong> | Ø§Ù„ØªÙˆÙ‚ÙŠØª: <strong>Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ (UTC+3)</strong>
                    </p>
                </div>
                <div class="d-flex gap-2 flex-column">
                    <button type="button" class="btn btn-primary" id="markAllBtn" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none;">
                        <i class="fas fa-check-double me-2"></i>
                        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙƒØ­Ø§Ø¶Ø±ÙŠÙ†
                    </button>
                    <a href="{{ url_for('attendance.export_circle_details_excel', department_id=department_id, circle_name=circle_name, date=selected_date.strftime('%Y-%m-%d'), type='all') }}" class="btn btn-success">
                        <i class="fas fa-file-excel me-2"></i>
                        ØªØµØ¯ÙŠØ± Ø§Ù„Ø¬Ù…ÙŠØ¹ (Excel)
                    </a>
                    <a href="{{ url_for('attendance.departments_circles_overview', date=selected_date.strftime('%Y-%m-%d'), department_id=department_id) }}" class="btn btn-light">
                        <i class="fas fa-arrow-left me-2"></i>
                        Ø§Ù„Ø¹ÙˆØ¯Ø©
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
    <div class="row">
        <div class="col-12">
            {% if employees_accessed %}
            <div class="row g-4">
                {% for emp in employees_accessed %}
                <div class="col-lg-6 col-xl-4">
                    <div class="card border-0 shadow-xl overflow-hidden" style="height: 100%; transition: all 0.3s ease; border-radius: 20px; background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);">
                        <!-- ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù - Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
                        <div style="height: 220px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); position: relative; overflow: hidden;">
                            {% if emp.profile_image %}
                            <img src="{{ url_for('static', filename=emp.profile_image) }}" alt="{{ emp.name }}" style="width: 100%; height: 100%; object-fit: cover;">
                            {% else %}
                            <div class="d-flex align-items-center justify-content-center h-100">
                                <i class="fas fa-user-circle fa-6x" style="color: rgba(255,255,255,0.3);"></i>
                            </div>
                            {% endif %}
                            <!-- Ø´Ø±ÙŠØ· Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙˆØ±Ø© -->
                            <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0)); padding: 15px; color: white;">
                                <h5 class="mb-1 fw-bold">{{ emp.name }}</h5>
                                <small style="opacity: 0.9;">{{ emp.employee_id }}</small>
                            </div>
                        </div>

                        <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© -->
                        <div class="card-body p-4">
                            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ²Ø± Ø§Ù„ØªØµØ¯ÙŠØ± -->
                            <div class="d-flex justify-content-between align-items-start mb-4">
                                <span class="badge" style="background: {% if emp.status == 'Ø­Ø§Ø¶Ø±' %}#10b981{% elif emp.status == 'ØºÙŠØ§Ø¨' %}#ef4444{% else %}#6b7280{% endif %}; padding: 8px 12px; font-size: 0.9rem;">
                                    {{ emp.status }}
                                </span>
                                <a href="{{ url_for('attendance.export_circle_details_excel', department_id=department_id, circle_name=circle_name, date=selected_date.strftime('%Y-%m-%d'), type='single', employee_id=emp.employee_id) }}" class="btn btn-sm btn-outline-success" title="ØªØµØ¯ÙŠØ± Ø¨ÙŠØ§Ù†Ø§Øª Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸Ù">
                                    <i class="fas fa-download"></i>
                                </a>
                            </div>

                            <!-- Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© -->
                            <div class="mb-4">
                                <p class="fw-bold text-muted mb-3" style="font-size: 0.85rem; text-transform: uppercase;">ğŸ“ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¯Ø§Ø¦Ø±Ø©</p>
                                <div class="row g-2">
                                    <div class="col-6">
                                        <div class="p-3" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.05) 100%); border-radius: 12px; border-right: 4px solid #22c55e;">
                                            <small class="text-muted d-block mb-1" style="font-size: 0.75rem; font-weight: 600;">Ø§Ù„Ø¯Ø®ÙˆÙ„</small>
                                            <div class="fw-bold text-success" style="font-size: 1.1rem;">
                                                {% if emp.circle_enter_time %}
                                                {{ emp.circle_enter_time }}
                                                {% else %}
                                                <span class="text-muted" style="font-size: 0.85rem;">-</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-3" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%); border-radius: 12px; border-right: 4px solid #ef4444;">
                                            <small class="text-muted d-block mb-1" style="font-size: 0.75rem; font-weight: 600;">Ø§Ù„Ø®Ø±ÙˆØ¬</small>
                                            <div class="fw-bold" style="font-size: 1.1rem; color: #ef4444;">
                                                {% if emp.circle_exit_time %}
                                                {{ emp.circle_exit_time }}
                                                {% else %}
                                                <span class="badge bg-success" style="font-size: 0.75rem;">Ù„Ø§ ÙŠØ²Ø§Ù„ Ø¯Ø§Ø®Ù„</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ© -->
                            <div class="alert mb-4" style="background: linear-gradient(135deg, rgba(96, 165, 250, 0.15) 0%, rgba(96, 165, 250, 0.05) 100%); border: 2px solid #60a5fa; border-radius: 12px;">
                                <div class="text-center">
                                    <i class="fas fa-hourglass-half" style="font-size: 1.5rem; color: #0284c7; margin-bottom: 8px;"></i>
                                    <div class="fw-bold" style="font-size: 1.8rem; color: #0284c7;">{{ emp.duration_display }}</div>
                                    <small class="text-muted">Ø§Ù„Ù…Ø¯Ø© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©</small>
                                </div>
                            </div>

                            <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± (Ø¯Ø®ÙˆÙ„ ÙˆØ®Ø±ÙˆØ¬ Ø§Ù„Ø¹Ù…Ù„) -->
                            <div class="mb-4">
                                <p class="fw-bold text-muted mb-3" style="font-size: 0.85rem; text-transform: uppercase;">ğŸ• Ø£ÙˆÙ‚Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙÙŠ Ø§Ù„Ø¹Ù…Ù„</p>
                                
                                <!-- Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„ØµØ¨Ø§Ø­ÙŠ -->
                                <p class="small fw-bold text-warning mb-2" style="font-size: 0.8rem;">â˜€ï¸ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØµØ¨Ø§Ø­ÙŠØ©</p>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <div class="p-2" style="background: #fef3c7; border-radius: 8px; border-right: 3px solid #f59e0b;">
                                            <small class="text-muted d-block mb-1" style="font-size: 0.7rem;">Ø¯Ø®ÙˆÙ„ ØµØ¨Ø§Ø­ÙŠ</small>
                                            <div class="fw-bold" style="color: #92400e; font-size: 0.95rem;">{{ emp.morning_check_in }}</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-2" style="background: #fef3c7; border-radius: 8px; border-right: 3px solid #f59e0b;">
                                            <small class="text-muted d-block mb-1" style="font-size: 0.7rem;">Ø®Ø±ÙˆØ¬ ØµØ¨Ø§Ø­ÙŠ</small>
                                            <div class="fw-bold" style="color: #92400e; font-size: 0.95rem;">{{ emp.morning_check_out }}</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠ -->
                                <p class="small fw-bold text-info mb-2" style="font-size: 0.8rem;">ğŸŒ™ Ø§Ù„ÙØªØ±Ø© Ø§Ù„Ù…Ø³Ø§Ø¦ÙŠØ©</p>
                                <div class="row g-2 mb-3">
                                    <div class="col-6">
                                        <div class="p-2" style="background: #dbeafe; border-radius: 8px; border-right: 3px solid #0284c7;">
                                            <small class="text-muted d-block mb-1" style="font-size: 0.7rem;">Ø¯Ø®ÙˆÙ„ Ù…Ø³Ø§Ø¦ÙŠ</small>
                                            <div class="fw-bold" style="color: #0c2d48; font-size: 0.95rem;">{{ emp.evening_check_in }}</div>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="p-2" style="background: #dbeafe; border-radius: 8px; border-right: 3px solid #0284c7;">
                                            <small class="text-muted d-block mb-1" style="font-size: 0.7rem;">Ø®Ø±ÙˆØ¬ Ù…Ø³Ø§Ø¦ÙŠ</small>
                                            <div class="fw-bold" style="color: #0c2d48; font-size: 0.95rem;">{{ emp.evening_check_out }}</div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙƒÙ„ÙŠØ© -->
                                {% if emp.work_hours_display != '-' %}
                                <div class="alert alert-info mb-0" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%); border: 2px solid #3b82f6; border-radius: 10px;">
                                    <div class="text-center">
                                        <i class="fas fa-clock" style="font-size: 1.2rem; color: #1e40af; margin-bottom: 5px;"></i>
                                        <div class="fw-bold" style="font-size: 1.3rem; color: #1e40af;">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙƒÙ„ÙŠØ©</div>
                                        <div class="fw-bold" style="font-size: 1.1rem; color: #1e40af;">{{ emp.work_hours_display }}</div>
                                        <small class="text-muted">Ù…Ù† {{ emp.morning_check_in }} Ø¥Ù„Ù‰ {{ emp.evening_check_out }}</small>
                                    </div>
                                </div>
                                {% endif %}
                            </div>

                            <!-- GPS -->
                            {% if emp.gps_latitude and emp.gps_longitude %}
                            <div style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(139, 92, 246, 0.05) 100%); padding: 12px; border-radius: 10px; border-right: 3px solid #8b5cf6;">
                                <small class="fw-bold text-muted d-block mb-2" style="font-size: 0.75rem; text-transform: uppercase;">ğŸ“¡ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª GPS</small>
                                <small class="text-monospace" style="font-size: 0.9rem; color: #4b5563; line-height: 1.6;">
                                    <i class="fas fa-location-dot me-2" style="color: #8b5cf6;"></i>{{ "%.4f"|format(emp.gps_latitude|float) }}<br>
                                    <i class="fas fa-location-dot me-2" style="color: #8b5cf6;"></i>{{ "%.4f"|format(emp.gps_longitude|float) }}
                                </small>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="card shadow-lg border-0 text-center py-5" style="border-radius: 15px;">
                <i class="fas fa-inbox fa-4x text-muted mb-3"></i>
                <p class="text-muted fw-bold fs-5">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§ØµÙ„ÙŠÙ† Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    html[dir="rtl"] {
        direction: rtl;
    }
    
    .card {
        transition: all 0.3s ease !important;
    }
    
    .card:hover {
        transform: translateY(-10px) !important;
        box-shadow: 0 20px 40px rgba(102, 126, 234, 0.2) !important;
    }
    
    .shadow-xl {
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
    }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var markAllBtn = document.getElementById('markAllBtn');
    
    if (markAllBtn) {
        markAllBtn.addEventListener('click', function() {
            var dateStr = "{{ selected_date.strftime('%Y-%m-%d') }}";
            var departmentId = {{ department_id }};
            var circleName = "{{ circle_name }}";
            
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø§Ù„ÙˆØ§ØµÙ„ÙŠÙ† Ù„Ù„Ø¯Ø§Ø¦Ø±Ø© ÙƒØ­Ø§Ø¶Ø±ÙŠÙ†ØŸ')) {
                // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
                markAllBtn.disabled = true;
                markAllBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...';
                
                fetch(`/attendance/mark-circle-employees-attendance/${departmentId}/${circleName}?date=${dateStr}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(data.message);
                        location.reload(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
                    } else {
                        alert('Ø®Ø·Ø£: ' + data.message);
                        markAllBtn.disabled = false;
                        markAllBtn.innerHTML = '<i class="fas fa-check-double me-2"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙƒØ­Ø§Ø¶Ø±ÙŠÙ†';
                    }
                })
                .catch(error => {
                    alert('Ø®Ø·Ø£: ' + error);
                    markAllBtn.disabled = false;
                    markAllBtn.innerHTML = '<i class="fas fa-check-double me-2"></i>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ù…ÙŠØ¹ ÙƒØ­Ø§Ø¶Ø±ÙŠÙ†';
                });
            }
        });
    }
});
</script>
