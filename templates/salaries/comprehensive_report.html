{% extends 'base.html' %}

{% block title %}التقرير الشامل للموظفين مع تفاصيل الرواتب{% endblock %}

{% block content %}
{% include 'salaries/partials/comprehensive_report/_content.html' %}
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    // تحديث قائمة الموظفين عند تغيير القسم
    $('#department_id').change(function() {
        const departmentId = $(this).val();
        
        // إعادة تعيين قائمة الموظفين
        $('#employee_id').empty().append('<option value="">جميع الموظفين</option>');
        
        // إذا تم اختيار قسم، جلب موظفي هذا القسم
        if (departmentId) {
            $.ajax({
                url: "{{ url_for('employees.get_employees_by_department') }}",
                type: 'GET',
                data: { department_id: departmentId },
                success: function(response) {
                    // إضافة الموظفين إلى القائمة
                    $.each(response.employees, function(index, employee) {
                        $('#employee_id').append(
                            $('<option></option>').val(employee.id).text(employee.name)
                        );
                    });
                },
                error: function(xhr, status, error) {
                    console.error('خطأ في جلب الموظفين:', error);
                }
            });
        }
    });
});
</script>
{% endblock %}