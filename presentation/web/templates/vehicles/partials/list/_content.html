<div class="page-header mb-4">
  <h1 class="theme-page-title">قائمة المركبات</h1>
  <p class="text-muted">عرض وفلترة المركبات حسب الحالة والشركة والمشروع ورقم اللوحة.</p>
</div>

<div class="card theme-card mb-4">
  <div class="card-header">
    <h2 class="h5 mb-0">تصفية</h2>
  </div>
  <div class="card-body">
    <form method="get" action="{{ url_for('vehicles_web.list_page') }}" class="row g-3 theme-vehicles-filters">
      <div class="col-md-2">
        <label for="status" class="form-label">الحالة</label>
        <select name="status" id="status" class="form-select">
          <option value="">الكل</option>
          {% for s in statuses %}
          <option value="{{ s }}" {% if current_status == s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <label for="make" class="form-label">الشركة المصنعة</label>
        <select name="make" id="make" class="form-select">
          <option value="">الكل</option>
          {% for m in makes %}
          <option value="{{ m }}" {% if current_make == m %}selected{% endif %}>{{ m }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <label for="project" class="form-label">المشروع</label>
        <select name="project" id="project" class="form-select">
          <option value="">الكل</option>
          {% for p in projects %}
          <option value="{{ p }}" {% if current_project == p %}selected{% endif %}>{{ p or '' }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <label for="search_plate" class="form-label">رقم اللوحة</label>
        <input type="text" name="search_plate" id="search_plate" class="form-control" value="{{ current_search_plate or '' }}" placeholder="بحث">
      </div>
      <div class="col-md-2 d-flex align-items-end">
        <button type="submit" class="btn btn-primary">تطبيق</button>
      </div>
    </form>
  </div>
</div>

<div class="card theme-card">
  <div class="card-header">
    <h2 class="h5 mb-0">المركبات</h2>
  </div>
  <div class="card-body p-0">
    <div class="table-responsive theme-vehicles-table-wrap">
      <table class="table table-hover table-striped align-middle mb-0 theme-vehicles-table">
        <thead class="theme-vehicles-thead">
          <tr>
            <th scope="col">رقم اللوحة</th>
            <th scope="col">الشركة / الموديل</th>
            <th scope="col">السنة</th>
            <th scope="col">الحالة</th>
            <th scope="col">القسم</th>
            <th scope="col" class="text-center">الإجراءات</th>
          </tr>
        </thead>
        <tbody>
          {% for vehicle in vehicles %}
          <tr class="theme-vehicles-row">
            <td><strong>{{ vehicle.plate_number }}</strong></td>
            <td>{{ vehicle.make }} {{ vehicle.model }}</td>
            <td>{{ vehicle.year }}</td>
            <td><span class="badge theme-badge-secondary">{{ vehicle.status_arabic }}</span></td>
            <td>{% if vehicle.department %}{{ vehicle.department.name }}{% else %}<span class="text-muted">-</span>{% endif %}</td>
            <td class="text-center">
              <a href="{{ url_for('vehicles.view', id=vehicle.id) }}" class="btn btn-sm theme-btn-info">عرض</a>
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="6" class="text-center text-muted py-4">لا توجد مركبات.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% if stats %}
<div class="mt-4">
  <p class="text-muted small">
    إحصائيات: الإجمالي {{ stats.total }} |
    متاحة {{ stats.available }} |
    مؤجرة {{ stats.rented }} |
    نشطة مع سائق {{ stats.in_project }} |
    في الورشة {{ stats.in_workshop }} |
    حادث {{ stats.accident }} |
    خارج الخدمة {{ stats.out_of_service }}
  </p>
</div>
{% endif %}

{% if expiring_documents %}
<div class="alert alert-warning mt-3" role="alert">
  <strong>وثائق قريبة من الانتهاء:</strong>
  <ul class="mb-0 mt-1">
    {% for doc in expiring_documents[:5] %}
    <li>{{ doc.plate_number }} — {{ doc.document_name }} ({{ doc.days_remaining }} يوم)</li>
    {% endfor %}
    {% if expiring_documents|length > 5 %}
    <li>و {{ expiring_documents|length - 5 }} أخرى.</li>
    {% endif %}
  </ul>
</div>
{% endif %}
