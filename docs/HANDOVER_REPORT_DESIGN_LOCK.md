# قفل تصميم تقرير التسليم/الاستلام (Design Lock)

## الهدف
هذه الوثيقة هي **المرجع الإلزامي** لشكل تقرير تسليم/استلام المركبة، لمنع فقدان التصميم الأصلي أو الانحراف عنه مستقبلًا.

## التصميم المعتمد (Source of Truth)
- القالب الأساسي المعتمد: `templates/vehicles/handover_report.html`
- نسخة الموديول المطابقة: `modules/vehicles/presentation/templates/vehicles/handovers/handover_report.html`
- نسخة أرشيف/توافق: `vehicles11/handover_report.html`

## القواعد غير القابلة للكسر
1. لا يتم استبدال القالب الأصلي بأي نموذج ReportLab مبسط عند الوصول لمسار التقرير العام.
2. عند تعذر WeasyPrint، يجب عرض **نفس القالب الأصلي** (HTML) للحفاظ على نفس التصميم.
3. الحفاظ على ترتيب قسم الفحص/الصورة كما هو مع نفس المقاسات:
   - `grid-template-columns: 52% 1fr`
   - ارتفاع حاوية صورة المخطط: `220px`
   - الصورة: `object-fit: contain`
4. عدم تغيير الألوان/الخطوط/الهوامش إلا بطلب تصميم واضح ومعتمد.

## المسارات الرسمية للتقرير
- المسار العام المعتمد: `/vehicles/handover/<id>/pdf/public`
- المسار الداخلي `/vehicles/handover/<id>/pdf` موجّه للمسار العام لتوحيد السلوك.

## ملفات التنفيذ المرتبطة
- `modules/vehicles/presentation/web/handover_routes.py`
- `presentation/web/vehicles/handover_routes.py`

## سلوك التوليد المعتمد
1. محاولة WeasyPrint أولًا.
2. إذا تعذر WeasyPrint بسبب مكتبات النظام (مثل GTK/Cairo)، يتم عرض نفس قالب `handover_report.html` بدل PDF بديل مختلف التصميم.

## قائمة تحقق قبل اعتماد أي تعديل
1. فتح الرابط: `http://127.0.0.1:5000/vehicles/handover/1/pdf/public`
2. التأكد بصريًا من:
   - وجود الشعار والهيدر الكامل.
   - الجدول الرئيسي الكامل.
   - قسم الفحص + مخطط المركبة بنفس الترتيب.
   - التواقيع والتذييل.
3. التحقق أن الصورة بالمقاس المعتمد (52% / 220px / contain).
4. منع ظهور نموذج مبسط مختلف (عنوان مثل "وثيقة تسليم واستلام المركبة" مع بنية مبسطة).

## آلية إدارة التغييرات مستقبلًا
- أي تغيير بصري في التقرير يتطلب:
  1) تحديث القالب الأساسي + نسخة الموديول معًا.
  2) تحديث هذه الوثيقة في نفس الطلب.
  3) إرفاق لقطة قبل/بعد في وصف التغيير.

## ملاحظات تشغيلية
- إذا ظهر تصميم مختلف رغم صحة المسار، فغالبًا يوجد سيرفر قديم ما زال يعمل. يلزم إعادة تشغيل نظيفة للتطبيق.
- تحذير WhatsApp في السجل لا يؤثر على تصميم التقرير.
